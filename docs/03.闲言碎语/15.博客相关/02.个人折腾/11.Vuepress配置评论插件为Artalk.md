---
title: Vuepressé…ç½®è¯„è®ºæ’ä»¶ä¸ºArtalk
date: 2022-11-27 17:33:19
permalink: /pages/b74c2b/
categories:
  - é—²è¨€ç¢è¯­
  - åšå®¢ç›¸å…³
  - ä¸ªäººæŠ˜è…¾
tags:
  -
feed:
  enable: true
description: æŠŠåšå®¢å¹³å°è¿ç§»åˆ° vuepress ä»¥æ¥ï¼Œä¹‹å‰æŠ˜è…¾è¿‡å¥½å‡ æ¬¡è¯„è®ºç³»ç»Ÿï¼Œå¤§å¤šæ˜¯ä¾èµ–ç¬¬ä¸‰æ–¹ä½œä¸ºåç«¯å­˜å‚¨ï¼Œå¯¼è‡´è¦ä¹ˆæ˜¯åŠ è½½é€Ÿåº¦ä¸ç†æƒ³ï¼Œè¦ä¹ˆæ˜¯é…ç½®è´¹åŠ²å„¿ï¼Œäºæ˜¯ï¼Œæˆ‘ç»ˆäºä¸‹å†³å¿ƒï¼Œè‡ªå»ºè¯„è®ºç³»ç»Ÿã€‚
---


## å‰è¨€

æŠŠåšå®¢å¹³å°è¿ç§»åˆ° vuepress ä»¥æ¥ï¼Œä¹‹å‰æŠ˜è…¾è¿‡å¥½å‡ æ¬¡è¯„è®ºç³»ç»Ÿï¼Œå¤§å¤šæ˜¯ä¾èµ–ç¬¬ä¸‰æ–¹ä½œä¸ºåç«¯å­˜å‚¨ï¼Œå¯¼è‡´è¦ä¹ˆæ˜¯åŠ è½½é€Ÿåº¦ä¸ç†æƒ³ï¼Œè¦ä¹ˆæ˜¯é…ç½®è´¹åŠ²å„¿ï¼Œäºæ˜¯ï¼Œæˆ‘ç»ˆäºä¸‹å†³å¿ƒï¼Œè‡ªå»ºè¯„è®ºç³»ç»Ÿã€‚

ç›®å‰å›½å†…æ¯”è¾ƒçŸ¥åçš„æœ‰ä¸¤ä¸ªå‰ç«¯è¯„è®ºç³»ç»Ÿï¼š

- [twikoo](https://github.com/imaegoo/twikoo)
- [Artalk](https://github.com/ArtalkJS/Artalk)

ä¸€å¼€å§‹æˆ‘æ˜¯èµ° twikoo çš„é…ç½®æµç¨‹è¿›è¡Œé…ç½®ï¼Œé…ç½®åˆ°æœ€åï¼Œå‘ç°è¿™ä¸ªç³»ç»ŸåŸæœ¬ä¾èµ–äº‘å¼€å‘ç³»ç»Ÿï¼Œå¯¹äºè‡ªå»ºéå¸¸ä¸å‹å¥½ï¼Œäºæ˜¯ç«‹é©¬æ”¾å¼ƒï¼Œæ°é€¢ vdoing ç¾¤é‡Œæœ‰ç¾¤å‹è¯´è‡ªå·±æŠ˜è…¾äº† artalk ç³»ç»Ÿçš„æ’ä»¶é›†æˆï¼Œç»è¿‡ä¸€ç•ªäº†è§£ï¼Œå‡†å¤‡è½¬æˆ˜ Artalkã€‚

## å®‰è£…

å®‰è£… artalk ä¹Ÿéå¸¸ç®€å•ï¼Œè¯¥ç³»ç»Ÿæä¾›äº† go è¯­è¨€ç‰ˆæœ¬çš„ï¼Œä½œè€…ä¹Ÿç»§æ‰¿å¥½äº†é•œåƒï¼Œæä¾›äº†å®¹å™¨éƒ¨ç½²çš„æ–¹æ¡ˆï¼Œäºæ˜¯ï¼Œæˆ‘ä½¿ç”¨ docker-compose è¿›è¡Œå¯åŠ¨ï¼Œé…ç½®ä¿¡æ¯å¦‚ä¸‹ï¼š

```yaml
version: "3.5"
services:
  artalk:
    container_name: artalk-go
    image: artalk/artalk-go
    restart: always
    ports:
      - 8070:23366
    volumes:
      - ./data:/data
```

æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤å¯åŠ¨æœåŠ¡ï¼š

```sh
$ docker-compose up -d
```

å¯åŠ¨å®Œæˆä¹‹åï¼Œä¼šåœ¨æœåŠ¡å™¨ç›‘å¬ 8070 ç«¯å£ï¼Œæ­¤æ—¶ç»™è¿™ä¸ªæœåŠ¡é…ç½®ä¸€ä¸ªåŸŸåï¼Œé…ç½®ä¿¡æ¯å¦‚ä¸‹ï¼š

```nginx
$cat /etc/nginx/vhost/comment.eryajf.net.conf

server {
    listen 80;
    listen 443 ssl;
    server_name comment.eryajf.net;

    ssl_certificate /etc/nginx/ssl/comment.eryajf.net.pem;
    ssl_certificate_key /etc/nginx/ssl/comment.eryajf.net.key;
    ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;
    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
    ssl_prefer_server_ciphers on;

    location / {
        proxy_set_header Host $host;
        proxy_set_header   X-Forwarded-Proto $scheme;
        proxy_set_header   X-Real-IP         $remote_addr;
        proxy_pass http://127.0.0.1:8070;
    }
}
```

ç„¶åè®¿é—® comment.eryajf.net èƒ½å¤Ÿè¿›å…¥åˆ°ç®¡ç†åå°ã€‚

## é…ç½®æœåŠ¡ç«¯


artalk çš„é…ç½®æ–‡ä»¶åœ¨ data ç›®å½•ä¸‹ï¼Œä½ å¯ä»¥é€šè¿‡ä¿®æ”¹é…ç½®æ–‡ä»¶æ ¹æ®è‡ªå·±çš„éœ€æ±‚è¿›è¡Œè°ƒæ•´ï¼Œä¹Ÿå¯ä»¥åœ¨ç®¡ç†åå°çš„é¡µé¢ä¸Šè¿›è¡Œé…ç½®ï¼Œå°½ç®¡ä¸¤ç§æ–¹å¼éƒ½ä¸å¤Ÿç¾å¥½ï¼Œä¸è¿‡èŠ±ç‚¹æ—¶é—´äº†è§£ä¸‹è¿™äº›é…ç½®ï¼Œå°±èƒ½å¤Ÿå¾ˆå¿«å®Œæˆè‡ªå·±çš„é…ç½®äº†ã€‚

ä¸‹è¾¹æ˜¯æˆ‘ä½¿ç”¨çš„é…ç½®ä¿¡æ¯ï¼Œå…¶ä¸­éƒ¨åˆ†ä¿¡æ¯åšäº†è„±æ•ï¼š

```yaml
# æœåŠ¡å™¨åœ°å€
host: "0.0.0.0"
# æœåŠ¡å™¨ç«¯å£
port: 23366
# åŠ å¯†å¯†é’¥
app_key: "eryajf"
# è°ƒè¯•æ¨¡å¼
debug: false
# æ—¶é—´åŒºåŸŸ
timezone: "Asia/Shanghai"
# é»˜è®¤ç«™ç‚¹å
site_default: "äºŒä¸«è®²æ¢µ"
# ç™»é™†æœ‰æ•ˆæ—¶é•¿ (å•ä½ï¼šç§’)
login_timeout: 259200
# æ•°æ®åº“
db:
  # æ•°æ®åº“ç±»å‹ ["sqlite", "mysql", "pgsql", "mssql"]
  type: "sqlite"
  # æ•°æ®åº“æ–‡ä»¶ (ä»… SQLite æ•°æ®åº“éœ€å¡«å†™)
  file: "./data/artalk-go.db"
  # æ•°æ®åº“åç§°
  name: "artalk"
  # æ•°æ®åº“åœ°å€
  host: "localhost"
  # æ•°æ®åº“ç«¯å£
  port: 3306
  # æ•°æ®åº“è´¦æˆ·
  user: "root"
  # æ•°æ®åº“å¯†ç 
  password: ""
  # ç¼–ç æ ¼å¼
  charset: "utf8mb4"
  # è¡¨å‰ç¼€ (ä¾‹å¦‚ï¼š"atk_")
  table_prefix: ""
# æ—¥å¿—
log:
  # å¯ç”¨æ—¥å¿—
  enabled: true
  # æ—¥å¿—æ–‡ä»¶è·¯å¾„
  filename: "./data/artalk-go.log"
# ç¼“å­˜
cache:
  # ç¼“å­˜ç±»å‹ ["redis", "memcache", "builtin"]
  type: "builtin"
  # ç¼“å­˜è¿‡æœŸæ—¶é—´ (å•ä½ï¼šåˆ†é’Ÿ)
  expires: 30
  # ç¼“å­˜å¯åŠ¨é¢„çƒ­ (ç¨‹åºå¯åŠ¨æ—¶é¢„çƒ­ç¼“å­˜)
  warm_up: false
  # ç¼“å­˜æœåŠ¡å™¨åœ°å€ (ä¾‹å¦‚ï¼š"localhost:6379")
  server: ""
  # Redis é…ç½®
  redis:
    # è¿æ¥æ–¹å¼ ["tcp", "unix"]
    network: "tcp"
    # ç”¨æˆ·å
    username: ""
    # å¯†ç 
    password: ""
    # æ•°æ®åº“ç¼–å· (ä¾‹å¦‚ä½¿ç”¨é›¶å·æ•°æ®åº“å¡«å†™ 0)
    db: 0
# å¯ä¿¡åŸŸå
trusted_domains:
  - https://wiki.eryajf.net
  - http://localhost:8080
  - https://eryajf.github.io
  - https://www.eryajf.net
  - https://eryajf.net
# SSL
ssl:
  # å¯ç”¨ SSL
  enabled: false
  # è¯ä¹¦æ–‡ä»¶è·¯å¾„
  cert_path: ""
  # å¯†é’¥æ–‡ä»¶è·¯å¾„
  key_path: ""
# ç®¡ç†å‘˜è´¦æˆ·
admin_users:
  - name: "eryajf"
    email: "xxxxxxxxxx"
    password: "xxxxxxxxxx" # æ”¯æŒ bcrypt æˆ– md5 åŠ å¯†ï¼Œå¦‚ï¼š"(md5)50c21190c6e4e5418c6a90d2b5031119"
    badge_name: "ç®¡ç†å‘˜"
    badge_color: "#FF6C00"
# è¯„è®ºå®¡æ ¸
moderator:
  # é»˜è®¤å¾…å®¡ (å‘è¡¨æ–°è¯„è®ºéœ€è¦åå°äººå·¥å®¡æ ¸åæ‰èƒ½æ˜¾ç¤º)
  pending_default: 1
  # API è¯·æ±‚é”™è¯¯æ—¶æ‹¦æˆª (å…³é—­æ­¤é¡¹å½“è¯·æ±‚é”™è¯¯æ—¶è®©è¯„è®ºæ”¾è¡Œ)
  api_fail_block: 1
  # Akismet Key
  # (Akismet ååƒåœ¾æœåŠ¡ï¼Œhttps://akismet.com)
  akismet_key: ""
  # è…¾è®¯äº‘æ–‡æœ¬å†…å®¹å®‰å…¨
  # (https://cloud.tencent.com/document/product/1124/64508)
  tencent:
    enabled: false
    secret_id: ""
    secret_key: ""
    region: "ap-guangzhou"
  # é˜¿é‡Œäº‘å†…å®¹å®‰å…¨
  # (https://help.aliyun.com/document_detail/28417.html)
  aliyun:
    enabled: false
    access_key_id: ""
    access_key_secret: ""
    region: "cn-shanghai"
  # å…³é”®è¯è¿‡æ»¤ (æœ¬åœ°ç¦»çº¿è¯åº“)
  keywords:
    enabled: false
    # åŒ¹é…æˆåŠŸè®¾ä¸ºå¾…å®¡çŠ¶æ€
    pending: false
    # è¯åº“æ–‡ä»¶ (æ”¯æŒå¤šä¸ªè¯åº“æ–‡ä»¶)
    files:
      - "./data/è¯åº“_1.txt"
    # è¯åº“æ–‡ä»¶å†…å®¹åˆ†å‰²ç¬¦ (ä¾‹å¦‚å¡«å†™ "\n" æ–‡ä»¶ä¸­ä¸€è¡Œä¸€ä¸ªå…³é”®è¯)
    file_sep: "\n"
    # æ›¿æ¢å­—ç¬¦
    replac_to: "x"
# éªŒè¯ç 
captcha:
  # å¯ç”¨éªŒè¯ç 
  enabled: true
  # æ€»æ˜¯éœ€è¦éªŒè¯ç 
  always: false
  # æ¿€æ´»éªŒè¯ç æ‰€éœ€æ“ä½œæ¬¡æ•°
  action_limit: 3
  # é‡ç½®æ“ä½œè®¡æ•°å™¨è¶…æ—¶ (å•ä½ï¼šs, è®¾ä¸º -1 ä¸é‡ç½®)
  action_reset: 60
  # Geetest æéªŒ (https://www.geetest.com)
  geetest:
    enabled: false
    captcha_id: ""
    captcha_key: ""
# é‚®ä»¶é€šçŸ¥
email:
  # å¯ç”¨é‚®ä»¶é€šçŸ¥
  enabled: 1
  # å‘é€æ–¹å¼ ["smtp", "ali_dm", "sendmail"]
  send_type: "smtp"
  # å‘ä¿¡äººæ˜µç§°
  send_name: "{{reply_nick}}"
  # å‘ä¿¡äººåœ°å€
  send_addr: "eryajf@163.com"
  # é‚®ä»¶æ ‡é¢˜
  mail_subject: "[{{site_name}}] æ‚¨æ”¶åˆ°äº†æ¥è‡ª @{{reply_nick}} çš„å›å¤"
  # é‚®ä»¶æ¨¡æ¿æ–‡ä»¶ (å¡«å…¥æ–‡ä»¶è·¯å¾„ä½¿ç”¨è‡ªå®šä¹‰æ¨¡æ¿)
  mail_tpl: "default"
  # SMTP å‘é€ (å¯ç”¨è¯·å°†å‘é€æ–¹å¼è®¾ä¸º "smtp")
  smtp:
    # å‘ä»¶åœ°å€
    host: "smtp.163.com"
    # å‘ä»¶ç«¯å£
    port: 465
    # ç”¨æˆ·å
    username: "eryajf@163.com"
    # å¯†ç 
    password: "xxxxxxxxxxx"
  # é˜¿é‡Œäº‘é‚®ä»¶æ¨é€
  # (å¯ç”¨è¯·å°†å‘é€æ–¹å¼è®¾ä¸º "ali_dm"ï¼›å‚è€ƒï¼šhttps://help.aliyun.com/document_detail/29444.html)
  ali_dm:
    access_key_id: ""
    access_key_secret: ""
    account_name: "noreply@example.com"
# å›¾ç‰‡ä¸Šä¼ 
img_upload:
  # å¯ç”¨å›¾ç‰‡ä¸Šä¼ 
  enabled: 0
  # å›¾ç‰‡å­˜æ”¾è·¯å¾„
  path: "./data/artalk-img/"
  # å›¾ç‰‡å¤§å°é™åˆ¶ (å•ä½ï¼šMB)
  max_size: 5
  # å›¾ç‰‡é“¾æ¥åŸºç¡€è·¯å¾„ (é»˜è®¤ä¸º "/static/images/")
  public_path: null
  # Upgit é…ç½®
  # (ä½¿ç”¨ Upgit å°†å›¾ç‰‡ä¸Šä¼ åˆ° GitHub æˆ–å›¾åºŠï¼šhttps://github.com/pluveto/upgit)
  upgit:
    # å¯ç”¨ Upgit
    enabled: false
    # å‘½ä»¤è¡Œå‚æ•°
    exec: "./upgit -c <upgité…ç½®æ–‡ä»¶è·¯å¾„> -t /artalk-img"
    # ä¸Šä¼ ååˆ é™¤æœ¬åœ°çš„å›¾ç‰‡
    del_local: true
# å¤šå…ƒæ¨é€
admin_notify:
  # é€šçŸ¥æ¨¡ç‰ˆ (å¡«å…¥æ–‡ä»¶è·¯å¾„ä½¿ç”¨è‡ªå®šä¹‰æ¨¡æ¿)
  notify_tpl: "default"
  # å˜ˆæ‚æ¨¡å¼
  noise_mode: false
  # é‚®ä»¶é€šçŸ¥ç®¡ç†å‘˜
  email:
    # å¼€å¯ (å½“ä½¿ç”¨å…¶ä»–æ¨é€æ–¹å¼æ—¶ï¼Œå¯ä»¥å…³é—­ç®¡ç†å‘˜é‚®ä»¶é€šçŸ¥)
    enabled: 0
    # é‚®ä»¶æ ‡é¢˜ (å‘é€ç»™ç®¡ç†å‘˜çš„é‚®ä»¶æ ‡é¢˜)
    mail_subject: "[{{site_name}}] æ‚¨çš„æ–‡ç« ã€Œ{{page_title}}ã€æœ‰æ–°å›å¤"
  # Telegram
  telegram:
    enabled: false
    api_token: ""
    receivers:
      - 7777777
  # Bark
  bark:
    enabled: false
    server: "http://day.app/xxxxxxx/"
  # é£ä¹¦
  lark:
    enabled: false
    webhook_url: ""
  # WebHook
  webhook:
    enabled: false
    url: ""
  # é’‰é’‰
  ding_talk:
    enabled: 1
    token: "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
    secret: "wiki"
  # Slack
  slack:
    enabled: false
    oauth_token: ""
    receivers:
      - "CHANNEL_ID"
  # LINE
  line:
    enabled: false
    channel_secret: ""
    channel_access_token: ""
    receivers:
      - "USER_ID_1"
      - "GROUP_ID_1"
# å‰ç«¯é…ç½®
frontend:
  # è¯„è®ºæ¡†å ä½æ–‡å­—
  placeholder: "è¯·æ­£ç¡®å¡«å†™é‚®ç®±ä»¥ä¾¿æ¥æ”¶å›å¤é€šçŸ¥,å¦‚éœ€æ·»åŠ å›¾ç‰‡,è¯·é€šè¿‡ç¬¬ä¸‰æ–¹å›¾åºŠå¼•ç”¨å›¾ç‰‡,è¯„è®ºæ”¯æŒMarkdownè¯­æ³•"
  # æ— è¯„è®ºæ˜¾ç¤ºæ–‡å­—
  noComment: "ã€Œæ­¤æ—¶æ— å£°èƒœæœ‰å£°ã€"
  # å‘é€æŒ‰é’®æ–‡å­—
  sendBtn: "æäº¤"
  # è¯„è®ºæ¡†æ—…è¡Œ
  editorTravel: 1
  # æš—é»‘æ¨¡å¼
  darkMode: false
  # è¡¨æƒ…åŒ…
  emoticons: "https://cdn.jsdelivr.net/gh/ArtalkJS/Emoticons/grps/default.json"
  # æŠ•ç¥¨æŒ‰é’®
  vote: true
  # åå¯¹æŒ‰é’®
  voteDown: false
  # ç”¨æˆ· UA å¾½æ ‡
  uaBadge: true
  # è¯„è®ºæ’åºåŠŸèƒ½
  listSort: true
  # é¡µé¢ PV ç»‘å®šå…ƒç´ 
  pvEl: "#ArtalkPV"
  # è¯„è®ºæ•°ç»‘å®šå…ƒç´ 
  countEl: "#ArtalkCount"
  # ç¼–è¾‘å™¨å®æ—¶é¢„è§ˆåŠŸèƒ½
  preview: true
  # å¹³é“ºæ¨¡å¼ ["auto", true, false]
  flatMode: "auto"
  # æœ€å¤§åµŒå¥—å±‚æ•°
  nestMax: 10
  # åµŒå¥—è¯„è®ºæ’åºè§„åˆ™ ["DATE_ASC", "DATE_DESC", "VOTE_UP_DESC"]
  nestSort: DATE_ASC
  # å¤´åƒ
  gravatar:
    # Gravatar é•œåƒåœ°å€
    mirror: "https://cravatar.cn/avatar/"
    # é»˜è®¤å¤´åƒ
    default: "mp"
  # è¯„è®ºåˆ†é¡µ
  pagination:
    # æ¯é¡µè¯„è®ºæ•°
    pageSize: 20
    # åŠ è½½æ›´å¤šæ¨¡å¼ (å…³é—­åˆ™ä½¿ç”¨åˆ†é¡µæ¡)
    readMore: true
    # æ»šåŠ¨åŠ è½½
    autoLoad: true
  # å†…å®¹é™é«˜
  heightLimit:
    # è¯„è®ºå†…å®¹é™é«˜ (å•ä½ï¼špx)
    content: 300
    # å­è¯„è®ºåŒºåŸŸé™é«˜ (å•ä½ï¼špx)
    children: 400
  # è¯·æ±‚è¶…æ—¶ (å•ä½ï¼šæ¯«ç§’)
  reqTimeout: 15000
  # ç‰ˆæœ¬æ£€æµ‹
  versionCheck: true
```

å› ä¸ºå®˜æ–¹æ–‡æ¡£å†™çš„å¾ˆè¯¦ç»†ï¼Œè¿™é‡Œå°±ä¸å¤šèµ˜è¿°äº†ã€‚

## é…ç½®é¡µé¢ç«¯

é¡µé¢ç«¯ï¼Œé€šè¿‡å¦‚ä¸‹æ’ä»¶æ¥å®Œæˆé…ç½®ï¼š

- [vuepress-plugin-vdoing-comment](https://github.com/terwer/vuepress-plugin-vdoing-comment)

### å®‰è£…

```sh
npm install --save vuepress-plugin-vdoing-comment --registry=https://registry.npmmirror.com
```

### é…ç½®

åœ¨è‡ªå·±çš„ vdoing å·¥ç¨‹é¡¹ç›®ä¸­ï¼Œæ’ä»¶é…ç½®æ–‡ä»¶ä¸­ `docs/.vuepress/config/plugins.js`  æ·»åŠ å¦‚ä¸‹é…ç½®ï¼š

```js
module.exports = {
  plugins: [
    [
      'vuepress-plugin-vdoing-comment',
      {
        choosen: 'artalk',
        options: {
            server: 'https://comment.eryajf.net', // ï¼ˆå¿…å¡«ï¼‰
            site: 'äºŒä¸«è®²æ¢µ', // ï¼ˆå¿…å¡«ï¼‰
            // disableEmotion: false, // æ˜¯å¦ç¦ç”¨è¡¨æƒ…ï¼ˆå¯é€‰ï¼‰
            // disablePicture: true, // æ˜¯å¦ç¦ç”¨å›¾ç‰‡ï¼ˆå¯é€‰ï¼‰
            // disablePreview: false // æ˜¯å¦ç¦ç”¨é¢„è§ˆï¼ˆå¯é€‰ï¼‰
        }
      }
    ]
  ]
}
```

ç›®å‰è¿™ä¸ªæ’ä»¶ä¸­çš„ç¦ç”¨å›¾ç‰‡å‚æ•°åœ¨æˆ‘è¿™é‡Œæµ‹è¯•æ²¡æœ‰ç”Ÿæ•ˆï¼Œå¦‚æœä½ æƒ³ç¦ç”¨è¯„è®ºåŒºä¸Šä¼ å›¾ç‰‡ï¼Œå¯ä»¥é€šè¿‡ä¸‹è¾¹ css ä¸­çš„æ–¹æ¡ˆå¯¹å›¾ç‰‡æŒ‰é’®è¿›è¡Œéšè—ã€‚

ç„¶ååœ¨è‡ªå®šä¹‰ css æ–‡ä»¶ `docs/.vuepress/styles/palette.styl` æœ€åæ·»åŠ å¦‚ä¸‹å†…å®¹è¿›è¡Œä¼˜åŒ–ï¼š

```css
// artalk è¯„è®ºæ¡† é€‚é…æš—é»‘æ¨¡å¼
.theme-mode-dark #vuepress-plugin-vdoing-comment {
  --at-color-bg: --bodyBg;
  color: #ffffff;
  --at-color-font: #ffffff;
  --at-color-bg-transl: --bodyBg;
  --at-color-bg-grey: #373a40
}
.theme-mode-dark #vuepress-plugin-vdoing-comment .atk-editor-plug-emoticons > .atk-grp-switcher > span:hover, .atk-editor-plug-emoticons > .atk-grp-switcher > span.active {
  background: var(--at-color-bg-grey);
}
.theme-mode-dark #vuepress-plugin-vdoing-comment .atk-editor-plug-emoticons > .atk-grp-switcher {
  background: var(--at-color-bg-grey)
}
```

ç„¶åå¯ä»¥å…ˆåœ¨æœ¬åœ° `yarn dev` å¯åŠ¨è°ƒè¯•ä¸€ä¸‹çœ‹çœ‹æ•ˆæœï¼Œæ²¡é—®é¢˜ä¹‹åï¼Œå†å‘å¸ƒåˆ°è¿œç«¯å³å¯ã€‚

çœ‹ä¸‹æˆ‘è¿™é‡Œé…ç½®å¥½ä¹‹åçš„æ•ˆæœï¼š

![](http://t.eryajf.net/imgs/2022/11/dc133db73e0b890e.png)

## è¿ç§»

å°†è¯„è®ºç³»ç»Ÿé…ç½®ä¸º artalk ä¹‹åï¼ŒåŠ è½½é€Ÿåº¦æ–¹é¢å®Œå…¨æ²¡äº†é—®é¢˜ï¼Œç°åœ¨éœ€è¦åšçš„ä¸€ä»¶äº‹å„¿å°±æ˜¯å°†åŸæ¥çš„è¯„è®ºåšä¸€ä¸ªè¿ç§»ã€‚

artalk å®˜æ–¹æ–‡æ¡£ä¸­ä»‹ç»çš„è¿ç§»å¾ˆè¯¦ç»†ï¼Œä¹Ÿæä¾›äº†è¿ç§»å·¥å…·ï¼Œä½†æˆ‘åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ä¹Ÿè¸©äº†ä¸€äº›å‘ï¼Œè¿™é‡Œåšä¸€ä¸‹è¿‡ç¨‹è®°å½•ã€‚

æˆ‘åŸæ¥è¯„è®ºç³»ç»Ÿä¾æ‰˜äº Vssueï¼Œæ•°æ®å­˜æ”¾åœ¨ GitHub Issueï¼Œæƒ³è¦æ‹¿åˆ°è¿™äº›æ•°æ®å¹¶ä¸éš¾ï¼Œå®˜æ–¹æ–‡æ¡£ä¸­ç»™åˆ°çš„è¯´æ˜å¦‚ä¸‹ï¼š

> Artran æ ¼å¼å®šä¹‰ï¼šæ¯ä¸€æ¡è¯„è®ºæ•°æ® (Object) ç§°ä¸º Artranï¼Œå¤šæ¡è¯„æ•°æ®è®ºç»„æˆä¸€ä¸ª Artran**s**Â (Array ç±»å‹)
>
> ```json
> {
>     "id": "123",
>     "rid": "233",
>     "content": "Hello Artalk",
>     "ua": "ArtalkGo/6.6",
>     "ip": "233.233.233.233",
>     "created_at": "2021-10-28 20:50:15 +0800 +0800",
>     "updated_at": "2021-10-28 20:50:15 +0800 +0800",
>     "is_collapsed": "false",
>     "is_pending": "false",
>     "vote_up": "666",
>     "vote_down": "0",
>     "nick": "qwqcode",
>     "email": "qwqcode@github.com",
>     "link": "https://qwqaq.com",
>     "password": "",
>     "badge_name": "ç®¡ç†å‘˜",
>     "badge_color": "#FF716D",
>     "page_key": "https://artalk.js.org/guide/transfer.html",
>     "page_title": "æ•°æ®è¿ç§»",
>     "page_admin_only": "false",
>     "site_name": "Artalk",
>     "site_urls": "http://localhost:3000/demo/,https://artalk.js.org"
> }
> ```

ç®€å•æ¥è¯´ï¼Œå¦‚ä¸Šå†…å®¹å°±æ˜¯ä¸€æ¡è¯„è®ºçš„è¯¦æƒ…ï¼Œå¦‚æœæƒ³è¦å¯¼å…¥å¤šæ¡ï¼Œå°±ç”¨ä¸€ä¸ªæ•°ç»„åŒ…è£¹ã€‚

åªæ˜¯ï¼Œè¿™é‡Œæœ‰å¿…è¦å¯¹å…¶ä¸­å‡ ä¸ªå­—æ®µåšä¸€ä¸ªè¯´æ˜ï¼š

- `ridï¼š`è¡¨ç¤ºè¿™æ˜¯å“ªæ¡è¯„è®ºçš„å›å¤ï¼Œå¦‚æœè¿™æ˜¯ç¬¬ä¸€æ¡è¯„è®ºï¼Œåˆ™ridä¸º0ï¼Œå¦‚æœæ˜¯å›å¤IDä¸º1çš„è¯„è®ºï¼Œåˆ™ridä¸º1ã€‚
- `page_keyï¼š`è¿™çš„ç¡®æ˜¯è¯„è®ºæ‰€å±çš„æ ‡è¯†é¡µé¢ï¼Œä½†å¯èƒ½æ˜¯å“ªé‡Œçš„é…ç½®åŸå› ï¼Œæˆ‘å‘ç°æˆ‘è¿™é‡Œè·å–åˆ°çš„ page_key ä¸å¸¦ä¸»åŸŸåï¼Œè¿™ä¹Ÿæ˜¯æˆ‘è¿ç§»è¿‡ç¨‹ä¸­è¸©å¾—ä¸€ä¸ªå‘ã€‚

æˆ‘çš„å»ºè®®æ˜¯ï¼Œè¯„è®ºç³»ç»Ÿé…ç½®å¥½ä¹‹åï¼Œæœ€å¥½å…ˆåœ¨è‡ªå·±çš„åšå®¢è¯„è®ºä¸€æ¡ï¼Œç„¶åæŠŠè¿™æ¡æ•°æ®æŸ¥å‡ºæ¥ï¼Œçœ‹çœ‹è¯¦æƒ…ï¼š

```sql
INSERT INTO "main"."comments" ("id", "created_at", "updated_at", "deleted_at", "content", "page_key", "site_name", "user_id", "ua", "ip", "rid", "is_collapsed", "is_pending", "is_pinned", "vote_up", "vote_down") VALUES (1, '2022-11-24 22:32:59.597873282+08:00', '2022-11-24 22:52:19.954473963+08:00', NULL, 'ä»Šå¤©ï¼Œç»ˆäºå†³å®šæŠŠè¯„è®ºç³»ç»Ÿä¹Ÿæ”¹ä¸ºè‡ªå»ºï¼Œå…œå…œè½¬è½¬ï¼Œä¸å¦‚è‡ªå»ºï¼Œæ— è®ºå›¾åºŠè¿˜æ˜¯è¯„è®ºç³»ç»Ÿã€‚ä»¥åå¤§å®¶å¯ä»¥æ„‰å¿«åœ°è¿›è¡Œè¯„è®ºå•¦ğŸ‰', '/about/', 'äºŒä¸«è®²æ¢µ', 2, 'Mozilla/5.0 (Macintosh; Intel Mac OS X 12_6_0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/107.0.0.0 Safari/537.36', '182.119.128.2', 0, 0, 0, 0, 1, 0);
```

æ ¹æ®å¦‚ä¸Šæƒ…å†µï¼Œæˆ‘çš„è„šæœ¬å†…å®¹å¦‚ä¸‹ï¼š

```go
package main

import (
	"context"
	"encoding/json"
	"fmt"
	"strings"

	"github.com/google/go-github/v47/github"
	"golang.org/x/oauth2"
)

var (
	client      *github.Client
	GtihubToken string = "ghp_7xxxxxxxxxxxxxxxxxxxxxxxxx"
)

func init() {
	ctx := context.Background()
	ts := oauth2.StaticTokenSource(
		&oauth2.Token{AccessToken: GtihubToken},
	)
	tc := oauth2.NewClient(ctx, ts)

	client = github.NewClient(tc)
}

type ArtalkComment struct {
	ID            string `json:"id"`
	Rid           string `json:"rid"`
	Content       string `json:"content"`
	Ua            string `json:"ua"`
	IP            string `json:"ip"`
	CreatedAt     string `json:"created_at"`
	UpdatedAt     string `json:"updated_at"`
	IsCollapsed   string `json:"is_collapsed"`
	IsPending     string `json:"is_pending"`
	VoteUp        string `json:"vote_up"`
	VoteDown      string `json:"vote_down"`
	Nick          string `json:"nick"`
	Email         string `json:"email"`
	Link          string `json:"link"`
	Password      string `json:"password"`
	BadgeName     string `json:"badge_name"`
	BadgeColor    string `json:"badge_color"`
	PageKey       string `json:"page_key"`
	PageTitle     string `json:"page_title"`
	PageAdminOnly string `json:"page_admin_only"`
	SiteName      string `json:"site_name"`
	SiteUrls      string `json:"site_urls"`
}

func main() {
	githubUser := "eryajf"
	githubRepo := "eryajf.github.io"

	issues, err := GetAllIssue(githubUser, githubRepo)
	if err != nil {
		fmt.Println(err)
	}
	var artalks []ArtalkComment
	for _, repo := range issues {
		if *repo.Comments > 0 {
			comments, err := GetAllComment(githubUser, githubRepo, repo.GetNumber())
			if err != nil {
				fmt.Printf("get all comments failed: %v\n", err)
			}
			for _, comment := range comments {

				user, err := GetUser(comment.User.GetLogin())
				if err != nil {
					fmt.Printf("get user failed: %v\n", err)
				}
				var email string
				if user.GetEmail() == "" {
					email = "empyt@github.com"
				} else {
					email = user.GetEmail()
				}

				artalks = append(artalks, ArtalkComment{
					ID:            fmt.Sprintf("%v", repo.GetNumber()),
					Rid:           "0",
					Content:       comment.GetBody(),
					Ua:            "",
					IP:            "",
					CreatedAt:     comment.GetCreatedAt().String(),
					UpdatedAt:     comment.GetUpdatedAt().String(),
					IsCollapsed:   "false",
					IsPending:     "false",
					VoteUp:        "0", // èµæˆ
					VoteDown:      "0",
					Nick:          comment.User.GetLogin(),   // è¯„è®ºè€…çš„æ˜µç§°
					Email:         email,                     // è¯„è®ºè€…çš„é‚®ç®±
					Link:          comment.User.GetHTMLURL(), // è¯„è®ºè€…çš„ç½‘ç«™
					Password:      "",
					BadgeName:     "",
					BadgeColor:    "",
					PageKey:       strings.Split(repo.GetBody(), "https://wiki.eryajf.net")[1], // é¡µé¢çš„url,åªå–åŸŸååçš„uri
					PageTitle:     "æ•°æ®è¿ç§»",
					PageAdminOnly: "false",
					SiteName:      "äºŒä¸«è®²æ¢µ",
					SiteUrls:      "https://comment.eryajf.net",
				})
			}
		}
	}
	str, err := json.Marshal(artalks)
	if err != nil {
		fmt.Printf("marshal failed: %v\n", err)
	}
	fmt.Println(string(str))
}

// è·å–ç”¨æˆ·ä¿¡æ¯
func GetUser(name string) (*github.User, error) {
	ctx := context.Background()
	user, _, err := client.Users.Get(ctx, name)
	if err != nil {
		fmt.Printf("get user info failed: %v\n", err)
	}
	return user, nil
}

// è·å–ä»“åº“æ‰€æœ‰çš„issue
func GetAllIssue(owner, repoName string) ([]*github.Issue, error) {
	ctx := context.Background()
	opt := &github.IssueListByRepoOptions{
		State:       "open",
		Labels:      []string{"Vssue"},
		ListOptions: github.ListOptions{PerPage: 10},
	}
	// get all pages of results
	var allIssues []*github.Issue
	for {
		repos, resp, err := client.Issues.ListByRepo(ctx, owner, repoName, opt)
		if err != nil {
			return nil, err
		}
		allIssues = append(allIssues, repos...)
		if resp.NextPage == 0 {
			break
		}
		opt.Page = resp.NextPage
	}
	return allIssues, nil
}

// è·å–å¯¹åº”issueçš„æ‰€æœ‰å¯¹è¯
func GetAllComment(owner, repoName string, number int) ([]*github.IssueComment, error) {
	ctx := context.Background()
	opt := &github.IssueListCommentsOptions{
		ListOptions: github.ListOptions{PerPage: 10},
	}
	// get all pages of results
	var allRepos []*github.IssueComment
	for {
		repos, resp, err := client.Issues.ListComments(ctx, owner, repoName, number, opt)
		if err != nil {
			return nil, err
		}
		allRepos = append(allRepos, repos...)
		if resp.NextPage == 0 {
			break
		}
		opt.Page = resp.NextPage
	}
	return allRepos, nil
}
```

å¦‚æœä½ ä¹Ÿæƒ³é€šè¿‡è¿™ä¸ªè„šæœ¬æ¥ç”Ÿæˆä½ çš„è¯„è®ºæ•°æ®ï¼Œå¯ä»¥é€‚å½“è°ƒæ•´å…¶ä¸­çš„ä¿¡æ¯ï¼Œå¦‚æœæœ‰ä¸äº†è§£çš„ï¼Œå¯ä»¥åœ¨è¯„è®ºåŒºä¸æˆ‘äº¤æµã€‚

å½“æˆ‘è¿è¡Œå®Œè„šæœ¬ä¹‹åï¼Œå°±è·å¾—äº†å¯¹åº”è¯„è®ºæ•°æ®çš„ä¸€ä¸ªå¤§æ•°ç»„ï¼Œå°†è¿™ä¸ªæ•°ç»„å†™å…¥åˆ°ä¸€ä¸ªåä¸º `art.json.artrans`(æ³¨æ„ï¼šåç¼€å¿…é¡»ä¸ºè¿™ä¸ªï¼Œè¿™æ˜¯å®˜æ–¹è¯†åˆ«çš„æ ¼å¼ã€‚)çš„æ–‡ä»¶ä¸­ï¼Œç„¶åæ¥åˆ°ç®¡ç†åå°ï¼Œé€šè¿‡é¡µé¢è¿›è¡Œå¯¼å…¥ï¼Œåœ¨æ§åˆ¶ä¸­å¿ƒ ==> è®¾ç½® ==> è¿ç§»ä¸­ï¼š

![](http://t.eryajf.net/imgs/2022/11/7870e3f4a8566c3f.png)

æœ€åç‚¹å‡»å¯¼å…¥ï¼Œå¯ä»¥çœ‹åˆ°æˆåŠŸå¯¼å…¥çš„æ•°æ®æ¡æ•°ã€‚

å½“æ•°æ®å¯¼å…¥æˆåŠŸï¼Œå°±å¯ä»¥åˆ°æ–‡ç« é¡µé¢ä¸Šçœ‹å¯¹åº”çš„è¯„è®ºä¿¡æ¯äº†ï¼Œæ­¤æ—¶æ•°æ®è¿˜æœ‰ä¸€äº›å°é—®é¢˜ï¼Œéœ€è¦è¿›è¡Œä¿®å¤ï¼Œå› ä¸ºæˆ‘è¿™è¾¹æ•°æ®é‡æ¯”è¾ƒå°ï¼Œå› æ­¤é€‰æ‹©äº†æ‰‹åŠ¨ä¿®å¤ã€‚

éœ€è¦ä¿®å¤çš„æ˜¯ rid è¿™ä¸ªå­—æ®µï¼Œéœ€è¦æ ¹æ®åŸæ¥å„æ¡è¯„è®ºçš„å¯¹åº”å…³ç³»æ¥ç»´æŠ¤ rid è¿™ä¸ªå­—æ®µã€‚

æˆ‘çš„æ“ä½œæ­¥éª¤æ˜¯ï¼šå…ˆæŠŠæ•°æ®æ–‡ä»¶ä¸‹è½½åˆ°æœ¬åœ°ï¼Œç„¶åä½¿ç”¨ Navicat æ‰“å¼€ï¼Œå¯¹æ•°æ®è¿›è¡Œä¿®å¤ï¼Œä¿®å¤å®Œæ¯•ä¹‹åï¼Œå†æŠŠæ•°æ®ä¸Šä¼ åˆ°æœåŠ¡å™¨çš„æ•°æ®ç›®å½•ä¸‹ï¼Œç„¶åé‡å¯ artalk-go æœåŠ¡ç«¯å³å¯ã€‚

æ¯”å¦‚æˆ‘çš„å…³äºé¡µé¢çš„è¯„è®ºä¿¡æ¯å¦‚ä¸‹ï¼š [https://github.com/eryajf/eryajf.github.io/issues/152](https://github.com/eryajf/eryajf.github.io/issues/152) ï¼Œå…³äºé¡µé¢çš„ URI ä¸º `/about/`ï¼Œæ‰§è¡Œå¦‚ä¸‹æŸ¥è¯¢ï¼š

```sql
$ SELECT id,content,rid FROM comments  WHERE "page_key"='/about/' ORDER BY created_at ASC;
```

ç„¶åå‚ç…§ GitHub ä¸­ issue çš„å†…å®¹å…³ç³»ï¼Œæ¥æ‰‹åŠ¨ä¿®å¤ rid å­—æ®µçš„å€¼ã€‚

ç»è¿‡ä¸€ç•ªè‰°è¾›çš„æ¢ç´¢ï¼Œæ€»ç®—æ˜¯æŠŠåŸæ¥çš„è¯„è®ºæ•°æ®è¿ç§»åˆ°æ–°çš„ç³»ç»Ÿä¸­äº†ã€‚
