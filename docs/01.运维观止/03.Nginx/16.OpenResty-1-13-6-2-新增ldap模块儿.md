---
title: OpenResty-1-13-6-2-æ–°å¢ldapæ¨¡å—å„¿
titleTag: åŸåˆ›
date: 2020-06-06 11:17:48
permalink: /pages/5019.html
categories: 
  - è¿ç»´è§‚æ­¢
  - Nginx
tags: 
  - openresty
  - ldap

description: 
---

ä¹‹å‰åœ¨ ldap çš„æ–‡ç« é‡Œæœ‰æåˆ° NGINX ç»“åˆ ldap è®¤è¯ä¸€äº›å…¬å…±æœåŠ¡çš„æ—¶å€™ï¼Œä¼šéå¸¸æ–¹ä¾¿ï¼Œé‚£ä¹ˆå¦‚ä½•å°†æˆ‘ä»¬éœ€è¦çš„ ldap æ¨¡å—å„¿æ·»åŠ åˆ°éƒ¨ç½²å¥½äº†çš„ openresty ä¸­å‘¢ï¼Œè¿™ç¯‡æ–‡ç« å°±æ¥è®²è§£ä¸€ä¸‹ã€‚



## 1ï¼Œä¸‹è½½ç›¸å…³åŒ…



å¦‚æœä¹‹å‰å®‰è£…ä¹‹åï¼Œåˆ é™¤äº†å®‰è£…åŒ…ï¼Œç°åœ¨æ‰¾ä¸åˆ°äº†ï¼Œé‚£ä¹ˆå¯ä»¥ä»å¦‚ä¸‹ç½‘ç«™ä¸‹è½½ä¸å½“å‰ä¸€è‡´çš„ç‰ˆæœ¬ã€‚



```sh
wget https://openresty.org/download/openresty-1.13.6.2.tar.gz
```



ä¸‹è½½æ‰€éœ€çš„ ldap æ¨¡å—å„¿ï¼Œé¡¹ç›®åœ°å€ä¸ºï¼šhttps://github.com/kvspb/nginx-auth-ldap.git è€ƒè™‘åˆ°ä¸å¥½ä¸‹è½½ï¼Œäºæ˜¯ç›´æ¥åœ¨å›½å†…åŒæ­¥äº†ä¸€ä»½ã€‚



```sh
cd /opt  # æ³¨æ„æ‹‰å–ä»£ç å­˜æ”¾ä½ç½®
git clone https://gitee.com/eryajf/nginx-auth-ldap.git
```



æ¥ä¸‹æ¥å°±è¿›å…¥æ­£å¼çš„ç¼–è¯‘å®‰è£…äº†ã€‚





![img](http://t.eryajf.net/imgs/2021/09/61fd0c1a6d17c72b.jpg)





## 2ï¼Œå®‰è£…ä¾èµ–



```sh
yum -y install gcc gcc-c++ pcre pcre-devel openldap-devel lua-devel systemtap-sdt-devel openssl-devel openssl
```



## 3ï¼Œè¿›è¡Œç¼–è¯‘



éœ€è¦æ³¨æ„`ç¼–è¯‘å¹¶ä¸èƒ½åœ¨ openresty æ ¹ç›®å½•è¿›è¡Œï¼Œå¦åˆ™å°†ä¼šå¤±è´¥ã€‚å·²ç»æœ‰åŒå­¦åœ¨è¿™é‡Œè¸©å‘äº†ğŸ¤£ğŸ¤£ğŸ¤£`



```sh
tar xf openresty-1.13.6.2.tar.gz
cd openresty-1.13.6.2/bundle/nginx-1.13.6/
```



ç„¶åå†è¿›è¡Œç¼–è¯‘ï¼š



```sh
./configure --prefix=/usr/local/openresty/nginx --with-cc-opt='-O2 -DNGX_LUA_ABORT_AT_PANIC -I/usr/local/openresty/zlib/include -I/usr/local/openresty/pcre/include -I/usr/local/openresty/openssl/include' --add-module=../ngx_devel_kit-0.3.0 --add-module=../echo-nginx-module-0.61 --add-module=../xss-nginx-module-0.06 --add-module=../ngx_coolkit-0.2rc3 --add-module=../set-misc-nginx-module-0.32 --add-module=../form-input-nginx-module-0.12 --add-module=../encrypted-session-nginx-module-0.08 --add-module=../srcache-nginx-module-0.31 --add-module=../ngx_lua-0.10.13 --add-module=../ngx_lua_upstream-0.07 --add-module=../headers-more-nginx-module-0.33 --add-module=../array-var-nginx-module-0.05 --add-module=../memc-nginx-module-0.19 --add-module=../redis2-nginx-module-0.15 --add-module=../redis-nginx-module-0.3.7 --add-module=../ngx_stream_lua-0.0.5 --with-ld-opt='-Wl,-rpath,/usr/local/openresty/luajit/lib -L/usr/local/openresty/zlib/lib -L/usr/local/openresty/pcre/lib -L/usr/local/openresty/openssl/lib -Wl,-rpath,/usr/local/openresty/zlib/lib:/usr/local/openresty/pcre/lib:/usr/local/openresty/openssl/lib' --with-pcre-jit --with-stream --with-stream_ssl_module --with-http_v2_module --without-mail_pop3_module --without-mail_imap_module --without-mail_smtp_module --with-http_stub_status_module --with-http_realip_module --with-http_addition_module --with-http_auth_request_module --with-http_secure_link_module --with-http_random_index_module --with-http_gzip_static_module --with-http_sub_module --with-http_dav_module --with-http_flv_module --with-http_mp4_module --with-http_gunzip_module --with-threads --with-file-aio --with-dtrace-probes --with-http_image_filter_module --with-stream --with-stream_ssl_module --with-http_ssl_module --add-module=/opt/nginx-auth-ldap
```



æ³¨æ„å¦‚ä¸Šæ­¥éª¤ï¼Œ`å¦‚æœåœ¨ä¸€ä¸ªå·²ç»å®‰è£…è¿‡openrestyçš„ç¯å¢ƒä¸­æ–°å¢ï¼Œåˆ™éœ€è¦å…ˆæŠŠåŸæ¥çš„å®‰è£…åŒ…ç§»èµ°`ï¼Œä¸ç„¶ä¸‹è¾¹ make çš„æ—¶å€™ä¼šæŠ¥å¦‚ä¸‹é”™è¯¯ï¼š



```sh
/bin/ld: warning: libssl.so.10, needed by /usr/lib/gcc/x86_64-redhat-linux/4.8.5/../../../../lib64/libldap.so, may conflict with libssl.so.1.1
/bin/ld: objs/src/event/ngx_event_openssl.o: undefined reference to symbol 'SSL_CTX_get_ex_new_index@@libssl.so.10'
/usr/lib64/libssl.so.10: error adding symbols: DSO missing from command line
collect2: error: ld returned 1 exit status
make[1]: *** [objs/nginx] Error 1
make[1]: Leaving directory `/usr/local/src/openresty-1.13.6.2/bundle/nginx-1.13.6'
make: *** [build] Error 2
```



å®‰è£…ï¼š



```sh
make
make install
```



å®‰è£…å®Œæˆä¹‹åï¼Œé‡æ–°è½¯é“¾ä¸€ä¸‹ nginx çš„ä¸»ç¨‹åºï¼Œå°±å¯ä»¥æŠ•å…¥ä½¿ç”¨äº†ã€‚



```sh
ln -snf /usr/local/openresty/nginx/sbin/nginx  /usr/sbin/
```



## 4ï¼Œé…ç½®å‚è€ƒ



å…·ä½“ NGINX é…ç½® ldap è®¤è¯ï¼Œå¯ä»¥å‚è€ƒå¦‚ä¸‹æ–‡ç« ï¼šhttps://wiki.eryajf.net/pages/3416.html#_6-nginx
