(window.webpackJsonp=window.webpackJsonp||[]).push([[359],{351:function(s,a,t){"use strict";t.r(a);var e=t(0),n=function(s){s.options.__data__block__={mermaid_382ee227:"stateDiagram\n\t[*] --\x3e branch\n\tbranch --\x3e deploy\n\tdeploy --\x3e rsync\n  rsync --\x3e\tkeepfive\n\tkeepfive --\x3e ln\n\n\tbranch --\x3e rollback\n\trollback --\x3e ID\n\tID --\x3e default\n\tdefault --\x3e lastbuild\n\tlastbuild --\x3e ln\n\n  ID --\x3e nodefault\n  nodefault --\x3e IDbuild\n  IDbuild --\x3e ln\n"}},r=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[s._v("上周在 Jenkins 中文社区做了一次关于回滚那些事儿的分享，因为要准备这样一次分享，所以很多以前放下的事情，又都捡拾起来了，瞬间又有了不少奇思妙想出来，这种收获，是不进行这次经历无法获取的，分享常常使我更加成长，尽管分享的东西，已经是自己所熟悉的，熟悉的东西多加巩固，就会有意外收获。")]),s._v(" "),a("p",[s._v("曾经我一直以为，Jenkins 对比所谓 Gitlab 的 cicd，以及 drone 等的发布工具，可能在对发布的历史版本回滚的操作上，有天生不足（前边提到的两者都是直接基于 git 自身的版本控制进行发布，回滚的时候也直接基于历史版本重新发布即可），我一度以为这是 Jenkins 无尽美好中的唯一缺憾。")]),s._v(" "),a("p",[s._v("后来工作中接触到 walle 的部署，当我了解了 walle 的发布思路之后，就像忽然打开了一扇大门一样，忽然觉得 Jenkins 同样可以借鉴这样一个思路来进行发布的工作，于是，在工作之余，我做了五大实验：")]),s._v(" "),a("ul",[a("li",[s._v("基于 freestyle 的定制化单机版本发布回滚配置管理")]),s._v(" "),a("li",[s._v("基于 pipeline 的定制化单机版本发布回滚配置管理")]),s._v(" "),a("li",[s._v("基于 freestyle 结合 ansible 的多主机批量发布回滚配置管理")]),s._v(" "),a("li",[s._v("基于 pipeline 结合 ansible 的多主机批量发布回滚配置管理")]),s._v(" "),a("li",[s._v("基于 pipeline 结合优化版 ansible 的多主机批量发布回滚配置管理")])]),s._v(" "),a("p",[s._v("今天将针对这些方案一一解析与分享，本文将分享 "),a("code",[s._v("基于freestyle的定制化单机版本发布回滚配置管理")]),s._v("和 "),a("code",[s._v("基于freestyle结合ansible的多主机批量发布回滚配置管理")]),s._v(" 这两种。")]),s._v(" "),a("p",[s._v("现在，进入正题。")]),s._v(" "),a("h2",{attrs:{id:"_1-思路整理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-思路整理"}},[s._v("#")]),s._v(" 1，思路整理")]),s._v(" "),a("p",[s._v("如果是发布 PHP 项目：")]),s._v(" "),a("ol",[a("li",[s._v("同步到远端的版本目录，目录使用"),a("code",[s._v("时间 + build id")]),s._v("命名")]),s._v(" "),a("li",[s._v("将新的应用版本软链到项目 root 目录")]),s._v(" "),a("li",[s._v("确保远程目录只保留五次(可自定义次数)历史")])]),s._v(" "),a("p",[s._v("如果是回滚：")]),s._v(" "),a("ol",[a("li",[s._v("构建参数当中添加一个回滚 ID，默认情况下，将回滚到上次构建")]),s._v(" "),a("li",[s._v("如果输入自定义 ID，则回滚到对应构建")]),s._v(" "),a("li",[s._v("支持灵活在五次构建内回滚")])]),s._v(" "),a("p",[s._v("这一思路的流程图大概如下：")]),s._v(" "),a("div",{staticClass:"center-container"},[a("Mermaid",{attrs:{id:"mermaid_382ee227",graph:s.$dataBlock.mermaid_382ee227}})],1),a("p",[s._v("现在通过实际例子来实现一下上边这个思路，大概将进行四个实验，或者更多，首先是类前端项目发布，静态部署，PHP 项目等都可采用这种方案。")]),s._v(" "),a("h2",{attrs:{id:"_2-自由风格单机部署回滚示例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-自由风格单机部署回滚示例"}},[s._v("#")]),s._v(" 2，自由风格单机部署回滚示例")]),s._v(" "),a("p",[s._v("创建一个自由风格的测试项目，核心当然是在参数化的配置，以及脚本的灵活定义，因此这里就展示这两个部分，先看参数化部分配置：")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://t.eryajf.net/imgs/2021/09/f4d16fe913a12936.jpg",alt:"image"}})]),s._v(" "),a("p",[s._v("定义三个参数，分别对应上边流程图中的三个节点，首先通过分支 branch 进行下发，接着通过 mode 进行部署或者回滚，如果是回滚，则再针对版本 ID 进行一下判断即可。")]),s._v(" "),a("p",[a("code",[s._v("脚本内容：")])]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/bash")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##set color##")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("echoRed")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("$'"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\e"}},[s._v("\\e")]),s._v("[0;31m'")]),s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"$'"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\e"}},[s._v("\\e")]),s._v("[0m'; }\nechoGreen() { echo $'"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\e"}},[s._v("\\e")]),s._v("[0;32m'\"")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"$'"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\e"}},[s._v("\\e")]),s._v("[0m'; }\nechoYellow() { echo $'"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\e"}},[s._v("\\e")]),s._v("[0;33m'\"")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"$'"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\e"}},[s._v("\\e")]),s._v("[0m'; }\n##set color##\nsource /etc/profile\nproject=\"")]),s._v("admin"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\nremote_port="')]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\nremote_user="')]),s._v("root"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\nremote_ip="')]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.3")]),s._v(".0.42"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\nDate='),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("date")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"+%Y%m%d%H%M%S"')]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v('\nproject_dir="')]),s._v("/data/www/"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${project}")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\nversion_dir="')]),s._v("/release/"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$project")]),s._v("/"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${Date}")]),s._v("_"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${BUILD_ID}")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"\ncat > keepfive.sh << 'EOF'\nfile_path=\"")]),s._v("/release/admin"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\nwhile true;do\nA='),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("file_path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wc")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\nB="),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-lrX")]),s._v(" $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("file_path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tail")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{print $9}'")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\nif [ "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$A")]),s._v(" -gt 5 ];then rm -rf "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${file_path}")]),s._v("/"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$B")]),s._v(";else break;fi;done\nEOF\nif [ "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$mode")]),s._v(' == "')]),s._v("deploy"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('" ];then\n    echoYellow "')]),s._v("创建远程主机上的版本目录 ："),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${version_dir}")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\n    ssh -p '),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_port")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_user")]),s._v("@"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_ip")]),s._v(' "')]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${version_dir}")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\n    [ '),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$?")]),s._v(' != 0 ] && echoRed "')]),s._v("请注意，在创建远程主机上的版本目录时出错，故而退出构建，可联系运维同学处理！"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('" && exit 1\n    echoYellow "')]),s._v("将代码同步到远程主机版本目录"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\n    rsync -az -e "')]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_port")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("\" --exclude='Jenkinsfile' --exclude='keepfive.sh' --delete "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${WORKSPACE}")]),s._v("/  "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_user")]),s._v("@"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_ip")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$version_dir")]),s._v("/\n    [ "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$?")]),s._v(' != 0 ] && echoRed "')]),s._v("请注意，在执行同步代码到版本目录时出错，故而退出构建，可联系运维同学处理！"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('" && exit 1\n    echoGreen "')]),s._v("将代码同步到远程主机版本目录成功！"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\n    echoYellow "')]),s._v("将项目部署到生产目录"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\n    ssh -p '),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_port")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_user")]),s._v("@"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_ip")]),s._v(' "')]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-snf")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$version_dir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$project_dir")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\n    [ '),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$?")]),s._v(' != 0 ] && echoRed "')]),s._v("请注意，在将项目部署到生产目录时出错，故而退出构建，可联系运维同学处理！"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('" && exit 1\n    echoGreen "')]),s._v("将项目部署到生产目录成功！"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\n    echoYellow "')]),s._v("使版本目录保持五个版本历史"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\n    ssh -p '),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_port")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_user")]),s._v("@"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_ip")]),s._v(" sh < keepfive.sh\n    [ "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$?")]),s._v(' != 0 ] && echoRed "')]),s._v("请注意，在执行版本清理时出错，将会影响回滚，故而退出构建，可联系运维同学处理！"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('" && exit 1\n    echoGreen "')]),s._v("执行版本清理成功！"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\n    echoYellow "')]),s._v("同步版本号到本地"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\n    [ ! -d /root/.jenkins/version/'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$project")]),s._v(" ] && mkdir -p /root/.jenkins/version/"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$project")]),s._v("\n    ssh -p "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_port")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_user")]),s._v("@"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_ip")]),s._v(' "')]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" /release/"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$project")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('" > /root/.jenkins/version/'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$project")]),s._v('/version.log\n    echoGreen "')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\n    echoGreen "')]),s._v("上线部署完成！"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\n    echoGreen "')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\nelse\n    if [ '),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${version_id}")]),s._v(' == "')]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('" ];then\n        echoYellow "')]),s._v("选择回滚的版本是默认，将回滚到上次制品，回滚即将进行"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\n        Version="')]),s._v("/release/"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$project")]),s._v("/"),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tail")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n2")]),s._v(" /root/.jenkins/version/$project/version.log "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("head")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n1")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\n        ssh -p '),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_port")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_user")]),s._v("@"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_ip")]),s._v(' "')]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-snf")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$Version")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$project_dir")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\n        [ '),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$?")]),s._v(' != 0 ] && echoRed "')]),s._v("请注意，在执行回滚时出错，故而退出构建，可立即联系运维同学处理！"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('" && exit 1\n        echoGreen "')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\n        echoGreen "')]),s._v("项目已回滚完成！"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\n        echoGreen "')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\n    else\n        echoYellow "')]),s._v("选择回滚的版本是："),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${version_id}")]),s._v("，将回滚到 "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${version_id}")]),s._v(" 的制品，回滚即将进行"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\n        Version="')]),s._v("/release/"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$project")]),s._v("/"),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"_'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$version_id")]),s._v('"')]),s._v(" /root/.jenkins/version/$project/version.log"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\n        ssh -p '),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_port")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_user")]),s._v("@"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_ip")]),s._v(' "')]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-snf")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$Version")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$project_dir")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\n        [ '),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$?")]),s._v(' != 0 ] && echoRed "')]),s._v("请注意，在执行回滚时出错，故而退出构建，可立即联系运维同学处理！"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('" && exit 1\n        echoGreen "')]),s._v("项目回滚到 "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${version_id}")]),s._v(' 完成！"\n    '),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br")])]),a("p",[s._v("核心部分也就是脚本内容了，以上即是脚本内容，采用的逻辑也都比较容易理解，只要读一下就能理解，可用于生产，可能只需要调整一下几个变量，或者路径就可以直接投入使用。")]),s._v(" "),a("h2",{attrs:{id:"_3-自由风格结合-ansible-多机批量部署回滚示例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-自由风格结合-ansible-多机批量部署回滚示例"}},[s._v("#")]),s._v(" 3，自由风格结合 ansible 多机批量部署回滚示例")]),s._v(" "),a("p",[s._v("自由风格之下，同样首先创建对应的参数用于传递，然后这里又新增了一个参数用于传递远程主机，以实现单机或者批量发布都可的功能。")]),s._v(" "),a("p",[s._v("依旧是先定于参数如下：")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://t.eryajf.net/imgs/2021/09/a2d1313601cbc5e3.jpg",alt:"image"}})]),s._v(" "),a("p",[s._v("然后定义脚本如下：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/bash")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##set color##")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("echoRed")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("$'"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\e"}},[s._v("\\e")]),s._v("[0;31m'")]),s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"$'"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\e"}},[s._v("\\e")]),s._v("[0m'; }\nechoGreen() { echo $'"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\e"}},[s._v("\\e")]),s._v("[0;32m'\"")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"$'"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\e"}},[s._v("\\e")]),s._v("[0m'; }\nechoYellow() { echo $'"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\e"}},[s._v("\\e")]),s._v("[0;33m'\"")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"$'"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\e"}},[s._v("\\e")]),s._v("[0m'; }\n##set color##\nsource /etc/profile\nproject=\"")]),s._v("tale"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\nremote_port="')]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\nremote_user="')]),s._v("root"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\nproject_dir="')]),s._v("/data/www/"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${project}")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\nversion_dir="')]),s._v("/release/"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$project")]),s._v("/"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${Date}")]),s._v("_"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${BUILD_ID}")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"\ncat > keepfive.sh << 'EOF'\nfile_path=\"")]),s._v("/release/tale"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\nwhile true;do\nA='),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("file_path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wc")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\nB="),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-lrX")]),s._v(" $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("file_path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tail")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{print $9}'")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\nif [ "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$A")]),s._v(" -gt 5 ];then rm -rf "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${file_path}")]),s._v("/"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$B")]),s._v(";else break;fi;done\nEOF\ncat > excludefile << EOF\nhosts.ini\ndeploy.yml\nJenkinsfile\nkeepfive.sh\nexcludefile\nEOF\nRs(){\nif [ "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_ip")]),s._v(' == "')]),s._v("all"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('" ];then\ncat > hosts.ini << EOF\n[remote]\n10.3.9.32 ansible_port=34222\n10.3.20.4 ansible_port=34222\nEOF\nelse\ncat > hosts.ini << EOF\n[remote]\n'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_ip")]),s._v(' ansible_port=34222\nEOF\nfi\n}\nRb(){\ncat > rollback.yml << EOF\n---\n- hosts: "')]),s._v("remote"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\n  remote_user: root\n  tasks:\n    - name: "')]),s._v("将项目回滚到对应期望的构建"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\n      file: path=/data/www/'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${project}")]),s._v(" state=link src="),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${Version}")]),s._v('\nEOF\n}\nRd(){\ncat > deploy.yml << EOF\n---\n- hosts: "')]),s._v("remote"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\n  remote_user: root\n  tasks:\n    - name: "')]),s._v("创建远程主机上的版本目录"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\n      file: path=/release/'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${project}")]),s._v("/"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${project}")]),s._v("_"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${BUILD_ID}")]),s._v(' state=directory\n    - name: "')]),s._v("将代码同步到远程主机版本目录"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\n      synchronize:\n        src: '),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${WORKSPACE}")]),s._v("/\n        dest: /release/"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${project}")]),s._v("/"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${project}")]),s._v("_"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${BUILD_ID}")]),s._v('/\n        rsync_opts: --exclude-from=excludefile\n    - name: "')]),s._v("将项目部署到生产目录"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\n      file: path=/data/www/'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${project}")]),s._v(" state=link src=/release/"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${project}")]),s._v("/"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${project}")]),s._v("_"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${BUILD_ID}")]),s._v('\n    - name: "')]),s._v("使版本目录保持五个版本历史"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\n      script: keepfive.sh\n    - name: "')]),s._v("生成远程版本号"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\n      shell: "')]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" /release/"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${project}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /release/version.log"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\n    - name: "')]),s._v("同步版本号到本地"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\n      synchronize: "')]),s._v("src"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/release/version.log "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dest")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/root/.jenkins/version/"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${project}")]),s._v("/version.log "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("mode")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("pull"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\nEOF\n}\nif [ '),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$mode")]),s._v(' == "')]),s._v("deploy"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('" ];then\n    Rs && Rd\n    ansible-playbook -i hosts.ini deploy.yml\nelse\n    if [ '),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${version_id}")]),s._v(' == "')]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('" ];then\n        Rs\n        echo "')]),s._v("选择回滚的版本是默认，将回滚到上次制品，回滚即将进行"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\n        Version="')]),s._v("/release/"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$project")]),s._v("/"),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tail")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n2")]),s._v(" /root/.jenkins/version/$project/version.log "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("head")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n1")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\n        Rb\n        ansible-playbook -i hosts.ini rollback.yml\n        echo "')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\n        echo "')]),s._v("项目已回滚完成！"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\n        echo "')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\n    else\n        Rs\n        echo "')]),s._v("选择回滚的版本是："),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${version_id}")]),s._v("，将回滚到 "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${version_id}")]),s._v(" 的制品，回滚即将进行"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\n        Version="')]),s._v("/release/"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$project")]),s._v("/"),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"_'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$version_id")]),s._v('"')]),s._v(" /root/.jenkins/version/$project/version.log"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\n        Rb\n        ansible-playbook -i hosts.ini rollback.yml\n        echo "')]),s._v("项目回滚到 "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${version_id}")]),s._v(' 完成！"\n    '),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br"),a("span",{staticClass:"line-number"},[s._v("68")]),a("br"),a("span",{staticClass:"line-number"},[s._v("69")]),a("br"),a("span",{staticClass:"line-number"},[s._v("70")]),a("br"),a("span",{staticClass:"line-number"},[s._v("71")]),a("br"),a("span",{staticClass:"line-number"},[s._v("72")]),a("br"),a("span",{staticClass:"line-number"},[s._v("73")]),a("br"),a("span",{staticClass:"line-number"},[s._v("74")]),a("br"),a("span",{staticClass:"line-number"},[s._v("75")]),a("br"),a("span",{staticClass:"line-number"},[s._v("76")]),a("br"),a("span",{staticClass:"line-number"},[s._v("77")]),a("br"),a("span",{staticClass:"line-number"},[s._v("78")]),a("br"),a("span",{staticClass:"line-number"},[s._v("79")]),a("br"),a("span",{staticClass:"line-number"},[s._v("80")]),a("br"),a("span",{staticClass:"line-number"},[s._v("81")]),a("br"),a("span",{staticClass:"line-number"},[s._v("82")]),a("br"),a("span",{staticClass:"line-number"},[s._v("83")]),a("br"),a("span",{staticClass:"line-number"},[s._v("84")]),a("br"),a("span",{staticClass:"line-number"},[s._v("85")]),a("br"),a("span",{staticClass:"line-number"},[s._v("86")]),a("br"),a("span",{staticClass:"line-number"},[s._v("87")]),a("br"),a("span",{staticClass:"line-number"},[s._v("88")]),a("br"),a("span",{staticClass:"line-number"},[s._v("89")]),a("br"),a("span",{staticClass:"line-number"},[s._v("90")]),a("br"),a("span",{staticClass:"line-number"},[s._v("91")]),a("br"),a("span",{staticClass:"line-number"},[s._v("92")]),a("br"),a("span",{staticClass:"line-number"},[s._v("93")]),a("br"),a("span",{staticClass:"line-number"},[s._v("94")]),a("br"),a("span",{staticClass:"line-number"},[s._v("95")]),a("br")])]),a("p",[s._v("这里把所有内容都集成到一个脚本，便于维护管理。这是我现在比较推崇的一种配置习惯，日常使用过程中，可能我们经常需要调试一些东西，如果一个构建调用的脚本要放好几个地方，那么维护起来是非常痛苦的，莫不如直接全部都集成在 Jenkins 当中，任何时候需要排查某个项目，直接到 Jenkins 中打开配置查看即可，而不需要再找几个地方。")]),s._v(" "),a("p",[s._v("如上两种方式都是紧贴合文章开头的流程图所为，也就几个大佬口中简单的 if/else 而已，但是就已经足够满足并实现我们的需求了。")])])}),[],!1,null,null,null);"function"==typeof n&&n(r);a.default=r.exports}}]);