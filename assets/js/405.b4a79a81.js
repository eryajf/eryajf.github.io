(window.webpackJsonp=window.webpackJsonp||[]).push([[405],{747:function(s,t,e){"use strict";e.r(t);var a=e(0),n=Object(a.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("p",[s._v("上面的那一堆都是准备工作，下面开始正式部署 kubernetes 了。")]),s._v(" "),t("p",[s._v("本节在 master 节点进行部署。")]),s._v(" "),t("h2",{attrs:{id:"_1-下载安装文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-下载安装文件"}},[s._v("#")]),s._v(" 1，下载安装文件")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# wget https://dl.k8s.io/v1.8.6/kubernetes-server-linux-amd64.tar.gz")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tar -xzvf kubernetes-server-linux-amd64.tar.gz")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cp -r kubernetes/server/bin/{kube-apiserver,kube-controller-manager,kube-scheduler,kubectl,kube-proxy,kubelet} /usr/local/bin/")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h2",{attrs:{id:"_2-配置和启动-kube-apiserver"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-配置和启动-kube-apiserver"}},[s._v("#")]),s._v(" 2，配置和启动 kube-apiserver")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" kube-apiserver.service "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF\n[Unit]\nDescription=Kubernetes API Server\nDocumentation=https://github.com/GoogleCloudPlatform/kubernetes\nAfter=network.target\nAfter=etcd.service\n\n[Service]\nExecStart=/usr/local/bin/kube-apiserver "),t("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --logtostderr=true "),t("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --admission-control=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota,NodeRestriction "),t("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --advertise-address=192.168.106.3 "),t("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --bind-address=192.168.106.3 "),t("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --insecure-bind-address=127.0.0.1 "),t("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --authorization-mode=Node,RBAC "),t("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --runtime-config=rbac.authorization.k8s.io/v1alpha1 "),t("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --kubelet-https=true "),t("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --enable-bootstrap-token-auth "),t("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --token-auth-file=/etc/kubernetes/token.csv "),t("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --service-cluster-ip-range=10.254.0.0/16 "),t("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --service-node-port-range=8400-10000 "),t("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --tls-cert-file=/etc/kubernetes/ssl/kubernetes.pem "),t("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --tls-private-key-file=/etc/kubernetes/ssl/kubernetes-key.pem "),t("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --client-ca-file=/etc/kubernetes/ssl/ca.pem "),t("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --service-account-key-file=/etc/kubernetes/ssl/ca-key.pem "),t("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --etcd-cafile=/etc/kubernetes/ssl/ca.pem "),t("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --etcd-certfile=/etc/kubernetes/ssl/kubernetes.pem "),t("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --etcd-keyfile=/etc/kubernetes/ssl/kubernetes-key.pem "),t("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --etcd-servers=https://192.168.106.3:2379,https://192.168.106.4:2379,https://192.168.106.5:2379 "),t("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --enable-swagger-ui=true "),t("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --allow-privileged=true "),t("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --apiserver-count=3 "),t("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --audit-log-maxage=30 "),t("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --audit-log-maxbackup=3 "),t("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --audit-log-maxsize=100 "),t("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --audit-log-path=/var/lib/audit.log "),t("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --event-ttl=1h "),t("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --v=2\nRestart=on-failure\nRestartSec=5\nType=notify\nLimitNOFILE=65536\n\n[Install]\nWantedBy=multi-user.target\nEOF")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br")])]),t("p",[s._v("注意：更换成自己的 IP。")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("--authorization-mode"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("RBAC ：指定在安全端口使用 RBAC 授权模式，拒绝未通过授权的请求；\nkube-scheduler、kube-controller-manager ：一般和 kube-apiserver 部署在同一台机器上，它们使用非安全端口和 kube-apiserver通信"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nkubelet、kube-proxy、kubectl ：部署在其它 Node 节点上，如果通过安全端口访问 kube-apiserver，则必须先通过 TLS 证书认证，再通过 RBAC 授权；\nkube-proxy、kubectl ：通过在使用的证书里指定相关的 User、Group 来达到通过 RBAC 授权的目的；\n如果使用了 kubelet TLS Boostrap 机制，则不能再指定 –kubelet-certificate-authority、–kubelet-client-certificate 和 –kubelet-client-key 选项，否则后续 kube-apiserver 校验 kubelet 证书时出现 ”x509: certificate signed by unknown authority“ 错误；\n--admission-control ：值必须包含 ServiceAccount，否则部署集群插件时会失败；\n--bind-address ：不能为 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1；\n--runtime-config：配置为rbac.authorization.k8s.io/v1beta1，表示运行时的apiVersion；\n--service-cluster-ip-range： 指定 Service Cluster IP 地址段，该地址段不能路由可达；\n--service-node-port-range ：指定 NodePort 的端口范围；\n缺省情况下 kubernetes 对象保存在 etcd /registry 路径下，可以通过 –etcd-prefix 参数进行调整；\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("h2",{attrs:{id:"_3-启动-kube-apiserver"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-启动-kube-apiserver"}},[s._v("#")]),s._v(" 3，启动 kube-apiserver")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cp kube-apiserver.service /etc/systemd/system/")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl daemon-reload")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl enable kube-apiserver")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl start kube-apiserver")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl status kube-apiserver")]),s._v("\n\n\nkube-apiserver.service - Kubernetes API Server\n   Loaded: loaded "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("/etc/systemd/system/kube-apiserver.service"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" enabled"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" vendor preset: disabled"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n   Active: active "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("running"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" since 一 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("-03-19 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":26:03 CST"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" 19s ago\n     Docs: https://github.com/GoogleCloudPlatform/kubernetes\n Main PID: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5948")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("kube-apiserver"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n   CGroup: /system.slice/kube-apiserver.service\n           └─5948 /usr/local/bin/kube-apiserver "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--logtostderr")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true --admission-control"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota,NodeRestriction --advertise-address"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("月 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":26:05 master1 kube-apiserver"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5948")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": I0319 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":26:05.901059    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5948")]),s._v(" wrap.go:42"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" POST /api/v1/namespaces: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(".166039ms"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("409")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("kube-apiserver/v1.8.6 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("linux/amd64"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" kubernetes/6260bb0"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".161.161:60460"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("月 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":26:05 master1 kube-apiserver"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5948")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": I0319 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":26:05.914750    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5948")]),s._v(" wrap.go:42"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" POST /apis/rbac.authorization.k8s.io/v1beta1/namespaces/kube-system/rolebindings: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(".722228ms"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("201")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("kub"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".161.161:60460"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("月 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":26:05 master1 kube-apiserver"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5948")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": I0319 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":26:05.915229    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5948")]),s._v(" storage_rbac.go:287"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" created rolebinding.rbac.authorization.k8s.io/system:controller:token-cleaner "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" kube-system\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("月 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":26:05 master1 kube-apiserver"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5948")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": I0319 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":26:05.929618    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5948")]),s._v(" wrap.go:42"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" GET /apis/rbac.authorization.k8s.io/v1beta1/namespaces/kube-public/rolebindings/system:controller:bootst"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".161.161:60460"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("月 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":26:05 master1 kube-apiserver"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5948")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": I0319 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":26:05.935152    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5948")]),s._v(" wrap.go:42"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" POST /api/v1/namespaces: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(".882855ms"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("409")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("kube-apiserver/v1.8.6 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("linux/amd64"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" kubernetes/6260bb0"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("161.161")]),s._v(":60460"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("月 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":26:05 master1 kube-apiserver"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5948")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": I0319 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":26:05.965294    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5948")]),s._v(" wrap.go:42"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" POST /apis/rbac.authorization.k8s.io/v1beta1/namespaces/kube-public/rolebindings: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(".302393ms"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("201")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("ku"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".161.161:60460"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("月 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":26:05 master1 kube-apiserver"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5948")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": I0319 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":26:05.965805    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5948")]),s._v(" storage_rbac.go:287"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" created rolebinding.rbac.authorization.k8s.io/system:controller:bootstrap-signer "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" kube-public\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("月 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":26:13 master1 kube-apiserver"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5948")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": I0319 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":26:13.776733    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5948")]),s._v(" wrap.go:42"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" GET /api/v1/namespaces/default: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".511793ms"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("kube-apiserver/v1.8.6 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("linux/amd64"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" kubernetes/6260bb"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".161.161:60460"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("月 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":26:13 master1 kube-apiserver"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5948")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": I0319 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":26:13.780367    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5948")]),s._v(" wrap.go:42"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" GET /api/v1/namespaces/default/services/kubernetes: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".593409ms"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("kube-apiserver/v1.8.6 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("linux/amd6"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".161.161:60460"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("月 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":26:13 master1 kube-apiserver"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5948")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": I0319 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":26:13.784057    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5948")]),s._v(" wrap.go:42"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" GET /api/v1/namespaces/default/endpoints/kubernetes: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".67392ms"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("kube-apiserver/v1.8.6 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("linux/amd6"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".161.161:60460"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nHint: Some lines were ellipsized, use "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),s._v(" to show "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" full.\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br")])]),t("h2",{attrs:{id:"_4-配置和启动-kube-controller-manager"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-配置和启动-kube-controller-manager"}},[s._v("#")]),s._v(" 4，配置和启动 kube-controller-manager")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" kube-controller-manager.service "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF\n[Unit]\nDescription=Kubernetes Controller Manager\nDocumentation=https://github.com/GoogleCloudPlatform/kubernetes\n\n[Service]\nExecStart=/usr/local/bin/kube-controller-manager "),t("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --logtostderr=true  "),t("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --address=127.0.0.1 "),t("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --master=http://127.0.0.1:8080 "),t("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --allocate-node-cidrs=true "),t("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --service-cluster-ip-range=10.254.0.0/16 "),t("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --cluster-cidr=172.30.0.0/16 "),t("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --cluster-name=kubernetes "),t("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --cluster-signing-cert-file=/etc/kubernetes/ssl/ca.pem "),t("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --cluster-signing-key-file=/etc/kubernetes/ssl/ca-key.pem "),t("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --service-account-private-key-file=/etc/kubernetes/ssl/ca-key.pem "),t("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --root-ca-file=/etc/kubernetes/ssl/ca.pem "),t("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --leader-elect=true "),t("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --v=2\nRestart=on-failure\nLimitNOFILE=65536\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\nEOF")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br")])]),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--address")]),s._v(" ：值必须为 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1，因为当前 kube-apiserver 期望 scheduler 和 controller-manager 在同一台机器；\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--master")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("MASTER_IP"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(":8080：使用非安全 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v(" 端口与 kube-apiserver 通信；\n--cluster-cidr： 指定 Cluster 中 Pod 的 CIDR 范围，该网段在各 Node 间必须路由可达"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("flanneld保证"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("；\n--service-cluster-ip-range： 参数指定 Cluster 中 Service 的CIDR范围，该网络在各 Node 间必须路由不可达，必须和 kube-apiserver 中的参数一致；\n--cluster-signing-*： 指定的证书和私钥文件用来签名为 TLS BootStrap 创建的证书和私钥；\n--root-ca-file ：用来对 kube-apiserver 证书进行校验，指定该参数后，才会在Pod 容器的 ServiceAccount 中放置该 CA 证书文件；\n--leader-elect"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true： 部署多台机器组成的 master 集群时选举产生一处于工作状态的 kube-controller-manager 进程；\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("h2",{attrs:{id:"_5-启动-kube-controller-manager"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-启动-kube-controller-manager"}},[s._v("#")]),s._v(" 5，启动 kube-controller-manager")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cp kube-controller-manager.service /etc/systemd/system/")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl daemon-reload")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl enable kube-controller-manager")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl start kube-controller-manager")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl status kube-controller-manager")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("h2",{attrs:{id:"_6-配置和启动-kube-scheduler"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-配置和启动-kube-scheduler"}},[s._v("#")]),s._v(" 6，配置和启动 kube-scheduler")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" kube-scheduler.service "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF\n[Unit]\nDescription=Kubernetes Scheduler\nDocumentation=https://github.com/GoogleCloudPlatform/kubernetes\n\n[Service]\nExecStart=/usr/local/bin/kube-scheduler "),t("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --logtostderr=true "),t("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --address=127.0.0.1 "),t("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --master=http://127.0.0.1:8080 "),t("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --leader-elect=true "),t("span",{pre:!0,attrs:{class:"token entity",title:"\\\\"}},[s._v("\\\\")]),s._v("\n  --v=2\nRestart=on-failure\nLimitNOFILE=65536\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\nEOF")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br")])]),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--address")]),s._v(" 值必须为 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1，因为当前 kube-apiserver 期望 scheduler 和 controller-manager 在同一台机器；\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--master")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("MASTER_IP"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(":8080：使用非安全 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v(" 端口与 kube-apiserver 通信；\n--leader-elect"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true 部署多台机器组成的 master 集群时选举产生一处于工作状态的 kube-controller-manager 进程；\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h2",{attrs:{id:"_7-启动-kube-scheduler"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7-启动-kube-scheduler"}},[s._v("#")]),s._v(" 7，启动 kube-scheduler")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cp kube-scheduler.service /etc/systemd/system/")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl daemon-reload")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl enable kube-scheduler")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl start kube-scheduler")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl status kube-scheduler")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("h2",{attrs:{id:"_8-验证-master-节点功能"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_8-验证-master-节点功能"}},[s._v("#")]),s._v(" 8，验证 master 节点功能")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get cs")]),s._v("\nNAME                 STATUS    MESSAGE              ERROR\nscheduler            Healthy   ok\ncontroller-manager   Healthy   ok\netcd-0               Healthy   "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"health"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"true"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\netcd-2               Healthy   "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"health"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"true"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\netcd-1               Healthy   "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"health"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"true"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])])])}),[],!1,null,null,null);t.default=n.exports}}]);