(window.webpackJsonp=window.webpackJsonp||[]).push([[393],{734:function(s,a,t){"use strict";t.r(a);var n=t(0),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[s._v("2019 年 5 月 21 日，Elastic 官方发布消息： Elastic Stack 新版本 6.8.0 和 7.1.0 的核心安全功能现免费提供。")]),s._v(" "),a("p",[s._v("这意味着用户现在能够对网络流量进行加密、创建和管理用户、定义能够保护索引和集群级别访问权限的角色，并且使用 Spaces 为 Kibana 提供全面保护。 免费提供的核心安全功能如下：")]),s._v(" "),a("ul",[a("li",[s._v("TLS 功能。 可对通信进行加密")]),s._v(" "),a("li",[s._v("文件和原生 Realm。 可用于创建和管理用户")]),s._v(" "),a("li",[s._v("基于角色的访问控制。 可用于控制用户对集群 API 和索引的访问权限")]),s._v(" "),a("li",[s._v("通过针对 Kibana Spaces 的安全功能，还可允许在 Kibana 中实现多租户")])]),s._v(" "),a("h2",{attrs:{id:"_1、x-pack-演变"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、x-pack-演变"}},[s._v("#")]),s._v(" 1、x-pack 演变")]),s._v(" "),a("ul",[a("li",[s._v("5.X 版本之前：没有 x-pack，是独立的：security 安全,watch 查看，alert 警告等独立单元。")]),s._v(" "),a("li",[s._v("5.X 版本：对原本的安全，警告，监视，图形和报告做了一个封装，形成了 x-pack。")]),s._v(" "),a("li",[s._v("6.3 版本之前：需要额外安装。")]),s._v(" "),a("li",[s._v("6.3 版本及之后：已经集成在一起发布，无需额外安装，基础安全属于付费黄金版内容。 7 .1 版本：基础安全免费。")])]),s._v(" "),a("h2",{attrs:{id:"_2、安全部分免费之前-大家怎么保证基础安全"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、安全部分免费之前-大家怎么保证基础安全"}},[s._v("#")]),s._v(" 2、安全部分免费之前，大家怎么保证基础安全？")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("场景一：全部“裸奔”，相信这在国内占据了非常大的比重。\n内网部署，不对外提供服务。或者 ES 作为业务基础支撑，不公网开放 9200 等常用端口，开放的是业务的服务端口。\n可能暴露问题：公司或团队内部开放 9200、5601 端口，基本 head 插件、kibana 都能连接，极易导致线上索引或数据可能被误删。")])]),s._v(" "),a("li",[a("p",[s._v("场景二：加了简单防护。\n一般使用 Nginx 身份认证+防火墙策略控制。")])]),s._v(" "),a("li",[a("p",[s._v("场景三：整合使用了第三方安全认证方案。\n比如：SearchGuard、ReadonlyREST。")])]),s._v(" "),a("li",[a("p",[s._v("场景四：付费购买了 Elastic-Xpack 黄金版或白金版服务。\n一般是银行等土豪大客户，对安全、预警、机器学习等付费功能需求迫切，如：宁波银行付费购买白金服务。")])])]),s._v(" "),a("p",[s._v("以上内容摘自：https://blog.csdn.net/laoyang360/article/details/90554761")]),s._v(" "),a("blockquote",[a("p",[s._v("既然新版本的 es 已经提供了基础的用户认证，那么多一层总比没有要强，因此接下来就实际配置一下单机版的 elk 和集群版的认证，两个稍微有一些不同，因此区分对待。")]),s._v(" "),a("p",[s._v("因为主要体现在 es 与 kibana 的认证，因此这里就只展现这两者的配置，其他 logstash 方面的，后续再完善。")])]),s._v(" "),a("h2",{attrs:{id:"_3-单机版-elk-认证"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-单机版-elk-认证"}},[s._v("#")]),s._v(" 3，单机版 elk 认证")]),s._v(" "),a("p",[s._v("本次实验 elk 全系版本都是基于"),a("code",[s._v("7.4.0")]),s._v("进行。")]),s._v(" "),a("p",[s._v("安装过程略过，直接来到配置阶段。")]),s._v(" "),a("h3",{attrs:{id:"_1-配置-es。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-配置-es。"}},[s._v("#")]),s._v(" 1，配置 es。")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" elasticsearch.yml\n\ncluster.name: eryajf-search\nnode.name: ops-eryajf-test-1\npath.data: /data/elasticsearch7/data\npath.logs: /data/elasticsearch7/log\nnetwork.host: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0\nhttp.port: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9200")]),s._v("\nxpack.security.enabled: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这条配置表示开启xpack认证机制")]),s._v("\nxpack.security.transport.ssl.enabled: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\ncluster.initial_master_nodes: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10.3.7.7"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("ul",[a("li",[a("code",[s._v("xpack.security.enabled")]),s._v("：表示开启 xpack 认证机制。")]),s._v(" "),a("li",[a("code",[s._v("xpack.security.transport.ssl.enabled")]),s._v("：这条如果不配，es 将起不来，会报如下错误:"),a("code",[s._v("Transport SSL must be enabled if security is enabled on a [basic] license. Please set [xpack.security.transport.ssl.enabled] to [true] or disable security by setting [xpack.security.enabled] to [false]")])])]),s._v(" "),a("p",[s._v("配置完成，记得创建配置中涉及到的目录并授权，然后启动 es。启动成功之后，再次访问 es，就需要基于用户来访问了，但是在这之前，需要先给对应的用户创建密码才行。")]),s._v(" "),a("h3",{attrs:{id:"_2-为内置账号添加密码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-为内置账号添加密码"}},[s._v("#")]),s._v(" 2，为内置账号添加密码")]),s._v(" "),a("p",[s._v("ES 中内置了几个管理其他集成组件的账号即："),a("code",[s._v("apm_system")]),s._v(", "),a("code",[s._v("beats_system")]),s._v(", "),a("code",[s._v("elastic")]),s._v(", "),a("code",[s._v("kibana")]),s._v(", "),a("code",[s._v("logstash_system")]),s._v(", "),a("code",[s._v("remote_monitoring_user")]),s._v("，使用之前，首先需要添加一下密码。")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ /usr/share/elasticsearch/bin/elasticsearch-setup-passwords interactive\nInitiating the setup of passwords "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" reserved "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("users")]),s._v(" elastic,apm_system,kibana,logstash_system,beats_system,remote_monitoring_user.\nYou will be prompted to enter passwords as the process progresses.\nPlease confirm that you would like to "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("continue")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("y/N"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("y\n\n\nEnter password "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("elastic"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":\nReenter password "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("elastic"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":\nEnter password "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("apm_system"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":\nReenter password "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("apm_system"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":\nEnter password "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("kibana"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":\nReenter password "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("kibana"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":\nEnter password "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("logstash_system"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":\nReenter password "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("logstash_system"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":\nEnter password "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("beats_system"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":\nReenter password "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("beats_system"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":\nEnter password "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("remote_monitoring_user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":\nReenter password "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("remote_monitoring_user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":\nChanged password "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" user "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("apm_system"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nChanged password "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" user "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("kibana"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nChanged password "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" user "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("logstash_system"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nChanged password "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" user "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("beats_system"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nChanged password "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" user "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("remote_monitoring_user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nChanged password "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" user "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("elastic"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br")])]),a("ul",[a("li",[s._v("interactive：给用户一一设置密码。")]),s._v(" "),a("li",[s._v("auto：自动生成密码。")])]),s._v(" "),a("p",[s._v("如果这个地方报如下错误：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("Failed to determine the health of the cluster running at http://10.3.7.7:9200\nUnexpected response code "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("503")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" from calling GET http://10.3.7.7:9200/_cluster/health?pretty\nCause: master_not_discovered_exception\n\nIt is recommended that you resolve the issues with your cluster before running elasticsearch-setup-passwords.\nIt is very likely that the password changes will fail when run against an unhealthy cluster.\n\nDo you want to "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("continue")]),s._v(" with the password setup process "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("y/N"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("y\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("可能是有脏数据导致，此时可以停掉 es，删除 data 数据目录，然后重新启动在进行操作。")]),s._v(" "),a("p",[s._v("配置完毕之后，可以通过如下方式访问 es 服务：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-XGET")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-u")]),s._v(" elastic "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'localhost:9200/_xpack/security/user?pretty'")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:9200 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-u")]),s._v(" elastic\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h3",{attrs:{id:"_3-配置-kibana-连接。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-配置-kibana-连接。"}},[s._v("#")]),s._v(" 3，配置 kibana 连接。")]),s._v(" "),a("p",[s._v("开启了安全认证之后，kibana 连接 es 以及访问 es 都需要认证。")]),s._v(" "),a("p",[s._v("变更 kibana 的配置，一共有两种方法，一种明文的，一种密文的。")]),s._v(" "),a("h4",{attrs:{id:"_1-明文配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-明文配置"}},[s._v("#")]),s._v(" 1，明文配置")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("server.port: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5601")]),s._v("\nserver.host: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0.0.0.0"')]),s._v("\nserver.name: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"es-node1"')]),s._v("\nelasticsearch.hosts: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://10.3.0.42:9200"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nkibana.index: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('".kibana"')]),s._v("\ni18n.locale: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"zh-CN"')]),s._v("\nelasticsearch.username: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kibana"')]),s._v("\nelasticsearch.password: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kibana_passwd"')]),s._v("\nxpack.reporting.encryptionKey: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"a_random_string"')]),s._v("\nxpack.security.encryptionKey: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"something_at_least_32_characters"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("ul",[a("li",[s._v("elasticsearch.username：连接 es 的用户名。")]),s._v(" "),a("li",[a("code",[s._v("elasticsearch.password")]),s._v("：连接 es 的密码。")]),s._v(" "),a("li",[a("code",[s._v("xpack.reporting.encryptionKey")]),s._v("：如果不添加这条配置，将会报错 "),a("code",[s._v("Generating a random key for xpack.reporting.encryptionKey. To prevent pending reports from failing on restart, please set xpack.reporting.encryptionKey in kibana.yml")]),s._v("。")]),s._v(" "),a("li",[a("code",[s._v("xpack.security.encryptionKey")]),s._v("：如果不配置这条，将会报错 "),a("code",[s._v("Generating a random key for xpack.security.encryptionKey. To prevent sessions from being invalidated on restart, please set xpack.security.encryptionKey in kibana.yml")]),s._v("。")])]),s._v(" "),a("h4",{attrs:{id:"_2-密文配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-密文配置"}},[s._v("#")]),s._v(" 2，密文配置")]),s._v(" "),a("p",[s._v("当然肯定推荐使用这种密文的方式进行认证，认证之前，需要首先将用户名密码保存到内置的 ketstore 里。")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("/usr/share/kibana/bin/kibana-keystore --allow-root create\n/usr/share/kibana/bin/kibana-keystore --allow-root "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" elasticsearch.username\n/usr/share/kibana/bin/kibana-keystore --allow-root "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" elasticsearch.password\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("原封不动执行如上三条命令，用户名的时候输入 kibana，密码写入对应密码，接着调整 kibana 的配置：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("server.port: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5601")]),s._v("\nserver.host: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0.0.0.0"')]),s._v("\nserver.name: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"es-node1"')]),s._v("\nelasticsearch.hosts: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://10.3.0.42:9200"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nkibana.index: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('".kibana"')]),s._v("\ni18n.locale: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"zh-CN"')]),s._v("\nxpack.reporting.encryptionKey: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"a_random_string"')]),s._v("\nxpack.security.encryptionKey: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"something_at_least_32_characters"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("然后重启 kibana 即可访问，访问的时候使用 elastic 的用户密码登入，将是全局管理权限，如果需要创建 kibana 的只读用户，则可以通过管理--用户--新建用户，对用户进行角色授权即可。")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://t.eryajf.net/imgs/2021/09/f7c1561668a5a7af.jpg",alt:"image"}})]),s._v(" "),a("h3",{attrs:{id:"_3-logstash-配置认证。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-logstash-配置认证。"}},[s._v("#")]),s._v(" 3，logstash 配置认证。")]),s._v(" "),a("p",[s._v("打开自定义的 logstash 的配置文件 logstash.conf，在 output 中增加 elasticsearch 的用户名和密码")]),s._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ELK1 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# vim /home/elk/logstash"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("-7.2")]),s._v("."),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/config/logstash.conf\n\ninput "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  beats "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    port => "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5044")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\noutput "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  stdout "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    codec => rubydebug\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  elasticsearch "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    hosts => "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.3.181:9200"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.3.182:9200"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.3.183:9200"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    user => "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"elastic"')]),s._v("\n    password => "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"123456"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br")])]),a("h2",{attrs:{id:"_4-集群配置。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-集群配置。"}},[s._v("#")]),s._v(" 4，集群配置。")]),s._v(" "),a("p",[s._v("在我配置过程中，发现集群认证需要首先配置秘钥才行，否则在给内置用户创建秘钥的时候将会报错。")]),s._v(" "),a("h3",{attrs:{id:"_1-证书。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-证书。"}},[s._v("#")]),s._v(" 1，证书。")]),s._v(" "),a("p",[s._v("如下操作在其中一个 node 节点执行即可，生成完证书传到集群其他节点即可。")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("/usr/share/elasticsearch/bin/elasticsearch-certutil ca\n/usr/share/elasticsearch/bin/elasticsearch-certutil cert "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--ca")]),s._v(" elastic-stack-ca.p12\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[a("code",[s._v("两条命令均一路回车即可")]),s._v("，不需要给秘钥再添加密码。")]),s._v(" "),a("p",[s._v("证书创建完成之后，默认在 es 的数据目录，这里统一放到 etc 下：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" /usr/share/elasticsearch/elastic-*\nelastic-certificates.p12  elastic-stack-ca.p12\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" /usr/share/elasticsearch/elastic-* /etc/elasticsearch/\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" elasticsearch.elasticsearch elastic-*\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("同样，将如上命令生成的两个证书文件拷贝到另外两台机器作为通信依据，要注意调整权限，否则服务无法启动。")]),s._v(" "),a("h3",{attrs:{id:"_2-配置。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-配置。"}},[s._v("#")]),s._v(" 2，配置。")]),s._v(" "),a("p",[s._v("三台机器配置文件如下：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("cluster.name: db-search\nnode.name: dc-search-es7-1\npath.data: /data/elasticsearch/data\npath.logs: /data/elasticsearch/log\nnetwork.host: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0\nhttp.port: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9200")]),s._v("\ntransport.tcp.port: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9300")]),s._v("\n\ndiscovery.seed_hosts: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10.3.23.249:9300"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10.3.23.48:9300"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10.3.23.191:9300"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\ncluster.initial_master_nodes: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10.3.23.249:9300"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10.3.23.48:9300"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10.3.23.191:9300"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\nxpack.security.enabled: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\nxpack.security.transport.ssl.enabled: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\nxpack.security.transport.ssl.verification_mode: certificate\nxpack.security.transport.ssl.keystore.path: /etc/elasticsearch/elastic-certificates.p12\nxpack.security.transport.ssl.truststore.path: /etc/elasticsearch/elastic-certificates.p12\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("p",[s._v("除了 node.name 使用各自主机名之外，其他配置都一样。")]),s._v(" "),a("p",[s._v("如上配置无误，则可以启动 es。")]),s._v(" "),a("h3",{attrs:{id:"_3-为内置账号添加密码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-为内置账号添加密码"}},[s._v("#")]),s._v(" 3，为内置账号添加密码")]),s._v(" "),a("p",[s._v("ES 中内置了几个管理其他集成组件的账号即："),a("code",[s._v("apm_system")]),s._v(", "),a("code",[s._v("beats_system")]),s._v(", "),a("code",[s._v("elastic")]),s._v(", "),a("code",[s._v("kibana")]),s._v(", "),a("code",[s._v("logstash_system")]),s._v(", "),a("code",[s._v("remote_monitoring_user")]),s._v("，使用之前，首先需要添加一下密码。")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ /usr/share/elasticsearch/bin/elasticsearch-setup-passwords interactive\nInitiating the setup of passwords "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" reserved "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("users")]),s._v(" elastic,apm_system,kibana,logstash_system,beats_system,remote_monitoring_user.\nYou will be prompted to enter passwords as the process progresses.\nPlease confirm that you would like to "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("continue")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("y/N"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("y\n\n\nEnter password "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("elastic"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":\nReenter password "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("elastic"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":\nEnter password "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("apm_system"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":\nReenter password "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("apm_system"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":\nEnter password "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("kibana"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":\nReenter password "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("kibana"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":\nEnter password "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("logstash_system"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":\nReenter password "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("logstash_system"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":\nEnter password "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("beats_system"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":\nReenter password "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("beats_system"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":\nEnter password "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("remote_monitoring_user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":\nReenter password "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("remote_monitoring_user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":\nChanged password "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" user "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("apm_system"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nChanged password "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" user "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("kibana"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nChanged password "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" user "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("logstash_system"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nChanged password "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" user "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("beats_system"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nChanged password "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" user "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("remote_monitoring_user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nChanged password "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" user "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("elastic"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br")])]),a("ul",[a("li",[s._v("interactive：给用户一一设置密码。")]),s._v(" "),a("li",[s._v("auto：自动生成密码。")])]),s._v(" "),a("p",[s._v("配置完毕之后，可以通过如下方式访问 es 服务：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-XGET")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-u")]),s._v(" elastic "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'localhost:9200/_xpack/security/user?pretty'")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:9200 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-u")]),s._v(" elastic\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("剩下的就是与上边的使用方式一致了，kibana 的认证，logstash 的认证等等。")]),s._v(" "),a("p",[s._v("其中 kibana 通过密文认证之后，配置如下：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("server.port: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5601")]),s._v("\nserver.host: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0.0.0.0"')]),s._v("\nserver.name: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"es-node3"')]),s._v("\nelasticsearch.hosts: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://10.3.6.30:9208"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nkibana.index: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('".kibana"')]),s._v("\ni18n.locale: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"zh-CN"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[a("strong",[s._v("参考：")])]),s._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://blog.51cto.com/luweiv998/2352541",target:"_blank",rel:"noopener noreferrer"}},[s._v("ELK 6.6.0 集群部署以及体验使用插件 X-pack"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://s0www0elastic0co.icopy.site/guide/en/elasticsearch/reference/7.0/certutil.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("elasticsearch-certutil 官方文档"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://www.uckendo.com/?p=1409",target:"_blank",rel:"noopener noreferrer"}},[s._v("ELASTICSEARCH 错误列表"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/elastic/elasticsearch-js/issues/196",target:"_blank",rel:"noopener noreferrer"}},[s._v("No Living Connections"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://www.jianshu.com/p/c2fdd01a0abe",target:"_blank",rel:"noopener noreferrer"}},[s._v("基于 centos 7 的 elasticsearch 7 + kibana + xpack 集群搭建"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/elastic/kibana/issues/40952",target:"_blank",rel:"noopener noreferrer"}},[s._v("Kibana 7.2.0 installed from rpm package does not start with error Error code EACCES: Insufficient permissions for extracting the browser archive"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://www.jianshu.com/p/23dbe4cc638e",target:"_blank",rel:"noopener noreferrer"}},[s._v("ELK 集群 x-pack 权限控制"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://www.jianshu.com/p/e714dc7e1546",target:"_blank",rel:"noopener noreferrer"}},[s._v("ELK 7.2 单节点开启安全认证"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://www.sojson.com/blog/213.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("Elasticsearch 教程，Elasticsearch 安全篇，通过 Nginx http basic 限制访问"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://blog.csdn.net/laoyang360/article/details/90554761",target:"_blank",rel:"noopener noreferrer"}},[s._v("Elasticsearch 7.1 免费安全功能全景认知"),a("OutboundLink")],1)])])])}),[],!1,null,null,null);a.default=e.exports}}]);