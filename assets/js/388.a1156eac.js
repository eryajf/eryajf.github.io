(window.webpackJsonp=window.webpackJsonp||[]).push([[388],{729:function(s,t,a){"use strict";a.r(t);var n=a(0),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("p",[s._v("logstash 的时间格式问题，是一个老大难，当然，这种难往往来自于那种日志输出不规范的情况，尤其是时间戳，各种各样的，最终来到配置这一环节的时候，就要费很大的劲儿来调配这个东东。")]),s._v(" "),t("p",[s._v("所以，在立项新项目的时候，首先就需要约束好日志的格式，严格按照日志规范来走。")]),s._v(" "),t("p",[s._v("本文就来整理一下在配置 logstash 的时候，遇到时间格式的问题，所需要用到的，注意到的配置细节。")]),s._v(" "),t("h2",{attrs:{id:"_1-date-filter-插件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-date-filter-插件"}},[s._v("#")]),s._v(" 1，Date Filter 插件")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://www.elastic.co/guide/en/logstash/current/plugins-filters-date.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("日期过滤器"),t("OutboundLink")],1),s._v("用于分析字段中的日期，然后使用该日期或时间戳作为事件的 logstash 时间戳。")]),s._v(" "),t("h2",{attrs:{id:"_2-配置项"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-配置项"}},[s._v("#")]),s._v(" 2，配置项")]),s._v(" "),t("p",[s._v("该插件支持以下配置选项：")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",{staticStyle:{"text-align":"center"}},[s._v("Setting")]),s._v(" "),t("th",{staticStyle:{"text-align":"center"}},[s._v("Input type")]),s._v(" "),t("th",{staticStyle:{"text-align":"center"}},[s._v("Required")]),s._v(" "),t("th",{staticStyle:{"text-align":"center"}},[s._v("Default")])])]),s._v(" "),t("tbody",[t("tr",[t("td",{staticStyle:{"text-align":"center"}},[s._v("locale")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("string")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("No")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("No")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"center"}},[s._v("match")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("array")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("No")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("[]")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"center"}},[s._v("tag_on_failure")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("array")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("No")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v('["_dateparsefailure"]')])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"center"}},[s._v("target")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("string")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("No")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v('"@timestamp"')])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"center"}},[s._v("timezone")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("string")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("No")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("No")])])])]),s._v(" "),t("p",[s._v("接下来逐一详解各配置含义。")]),s._v(" "),t("h3",{attrs:{id:"_1-locate"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-locate"}},[s._v("#")]),s._v(" 1，locate")]),s._v(" "),t("p",[s._v("值类型是字符串,这个设置没有默认值。使用 IETF-BCP47 或 POSIX 语言标记指定用于日期分析的区域设置。 简单的例子是 en，美国的 BCP47 或者 en_US 的 POSIX。大多数情况下需要设置语言环境来解析月份名称（MMM 模式）和星期几名称（EEE 模式）。如果未指定，则将使用平台默认值，但对于非英文平台默认情况下，英文解析器也将用作回退机制。")]),s._v(" "),t("h3",{attrs:{id:"_2-match"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-match"}},[s._v("#")]),s._v(" 2，match")]),s._v(" "),t("p",[s._v("用于配置具体的匹配内容规则，前半部分内容表示匹配实际日志当中的时间戳的名称，后半部分则用于匹配实际日志当中的时间戳格式，这个地方是整条配置的核心内容，如果此处规则匹配是无效的，则生成后的日志时间戳将会被读取的时间替代。")]),s._v(" "),t("p",[s._v("这里列出一些常见的日志中时间格式的匹配规则，亲测可以直接放到实际中使用：")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",{staticStyle:{"text-align":"center"}},[s._v("时间戳")]),s._v(" "),t("th",{staticStyle:{"text-align":"center"}},[s._v("match")])])]),s._v(" "),t("tbody",[t("tr",[t("td",{staticStyle:{"text-align":"center"}},[s._v("2018-06-01T01:23:05+08:00")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("yyyy-MM-dd'T'HH:mm:ss+08:00")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"center"}},[s._v("2018-06-01T01:23:05Z")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("yyyy-MM-dd'T'HH:mm:ssZ")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"center"}},[s._v("Jun 07 2018 01:23:05")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v('MMM dd yyyy HH:mm:ss (注: locale => "en")')])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"center"}},[s._v("Jun 7 2018 01:23:05")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v('MMM d yyyy HH:mm:ss (注: locale => "en")')])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"center"}},[s._v("1529122935988")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("UNIX_MS")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"center"}},[s._v("1529122935")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("UNIX")])])])]),s._v(" "),t("p",[s._v("这块儿内容在最后会专门用实际例子进行说明。")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("date 插件支持五种时间格式")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("ISO8601")]),s._v("\n属于标准格式，类似 "),t("code",[s._v('"2018-06-17T03:44:01.103Z"')]),s._v(" 这样的格式。具体 Z 后面可以有 "),t("code",[s._v('"08:00"')]),s._v("也可以没有，"),t("code",[s._v('".103"')]),s._v("这个也可以没有。常用场景里来说，"),t("code",[s._v("Nginx")]),s._v(" 的 "),t("code",[s._v("log_format")]),s._v(" 配置里就可以使用 "),t("code",[s._v("$time_iso8601")]),s._v(" 变量来记录请求时间成这种格式。")]),s._v(" "),t("li",[t("code",[s._v("UNIX")]),s._v("\nUNIX 时间戳格式，记录的是从 1970 年起始至今的总秒数。Squid 的默认日志格式中就使用了这种格式。")]),s._v(" "),t("li",[t("code",[s._v("UNIX_MS")]),s._v("\n这个时间戳则是从 1970 年起始至今的总毫秒数。据我所知，JavaScript 里经常使用这个时间格式。")]),s._v(" "),t("li",[t("code",[s._v("TAI64N")]),s._v("\nTAI64N 格式比较少见，是这个样子的：@4000000052f88ea32489532c。我目前只知道常见应用中，qmail 会用这个格式。")]),s._v(" "),t("li",[t("code",[s._v("Joda-Time 库")]),s._v("\nLogstash 内部使用了 Java 的 "),t("a",{attrs:{href:"http://joda-time.sourceforge.net/apidocs/org/joda/time/format/DateTimeFormat.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("Joda 时间库"),t("OutboundLink")],1),s._v("来作时间处理。所以我们可以使用 Joda 库所支持的时间格式来作具体定义。")])])]),s._v(" "),t("li",[t("p",[s._v("时间戳详解")]),s._v(" "),t("p",[s._v("用于解析日期和时间文本的语法使用字母来指示时间值（月，分等）的类型，以及重复的字母来表示该值的形式（2 位月份，全月份名称等）。以下是可用于解析日期和时间的内容：")]),s._v(" "),t("ul",[t("li",[t("p",[t("code",[s._v("y")]),s._v("(year)")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("yyyy  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#全年号码。 例如：2015。")]),s._v("\nyy    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#两位数年份。 例如：2015年的15。")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])])]),s._v(" "),t("li",[t("p",[t("code",[s._v("M")]),s._v(" (month of the year)")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("M     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#最小数字月份。 例如：1 for January and 12 for December.。")]),s._v("\nMM    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#两位数月份。 如果需要，填充零。 例如：01 for January  and 12 for Decembe")]),s._v("\nMMM   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#缩短的月份文本。 例如： Jan for January。 注意：使用的语言取决于您的语言环境。 请参阅区域设置以了解如何更改语言。")]),s._v("\nMMMM  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#全月文本，例如：January。 注意：使用的语言取决于您的语言环境。")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])])]),s._v(" "),t("li",[t("p",[t("code",[s._v("d")]),s._v(" (day of the month)")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("d   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#最少数字的一天。 例如：1月份的第一天1。")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("dd")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#两位数的日子，如果需要的话可以填零.例如：01 for the 1st of the month。")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])])]),s._v(" "),t("li",[t("p",[t("code",[s._v("H")]),s._v(" (hour of the day (24-hour clock))")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("H   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#最小数字小时。 例如:0表示午夜。")]),s._v("\nHH  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#两位数小时，如果需要填零。 例如：午夜00。")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])])]),s._v(" "),t("li",[t("p",[t("code",[s._v("m")]),s._v(" (minutes of the hour (60 minutes per hour))")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("m   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#最小的数字分钟。 例如：0。")]),s._v("\nmm  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#两位数分钟，如果需要填零。 例如：00。")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])])]),s._v(" "),t("li",[t("p",[t("code",[s._v("s")]),s._v(" (seconds of the minute (60 seconds per minute) )")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("s    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#最小数字秒。 例如：0。")]),s._v("\nss   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#两位数字，如果需要填零。 例如：00。")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])])]),s._v(" "),t("li",[t("p",[t("code",[s._v("S")]),s._v(" 秒的小数部分最大精度是毫秒（SSS）。 除此之外，零附加。")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("S    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#十分之一秒。例如：0为亚秒值012")]),s._v("\nSS   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#百分之一秒 例如：01为亚秒值01")]),s._v("\nSSS  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#千分之一秒 例如：012为亚秒值012")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("Z 时区偏移或身份")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("Z   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#时区偏移，结构为HHmm（Zulu/UTC的小时和分钟偏移量）。例如：-0700。")]),s._v("\nZZ  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#时区偏移结构为HH:mm（小时偏移和分钟偏移之间的冒号）。 例如：-07：00。")]),s._v("\nZZZ  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#时区身份。 例如：America/Los_Angeles。 注意：有效的ID在列表中列出http://joda-time.sourceforge.net/timezones.html")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])])])])])]),s._v(" "),t("p",[s._v("其他不常用的就不再详录了，诸上之外的，可参考：http://www.joda.org/joda-time/key_format.html")]),s._v(" "),t("h3",{attrs:{id:"_3-tag-on-failure"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-tag-on-failure"}},[s._v("#")]),s._v(" 3，tag_on_failure")]),s._v(" "),t("p",[s._v("如果匹配失败，将值附加到 tag 字段，字段值为 "),t("code",[s._v("_dateparsefailure")]),s._v("，有时候我们在 kibana 当中看到日志会有这个字段，那么不用多想了，一定是时间格式匹配失败了，需要重新检查上边的 match 配置解析是否正确。")]),s._v(" "),t("h3",{attrs:{id:"_4-target"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-target"}},[s._v("#")]),s._v(" 4，target")]),s._v(" "),t("p",[s._v("将匹配的时间戳存储到给定的目标字段中。如果未提供，则默认更新事件的@timestamp 字段。一般情况下，我们用的配置如下：")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("filter "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n   date "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      match        => "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"timestamp"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dd/MMM/YYYY:HH:mm:ss Z"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"UNIX"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"yyyy-MM-dd HH:mm:ss"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dd-MMM-yyyy HH:mm:ss"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n      target       => "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"@timestamp"')]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("此处配置的意思是，match 对原始日志时间格式进行解析，解析之后，存储到下边定义的 target 定义的字段中，一般这个字段肯定是 "),t("code",[s._v("@timestamp")]),s._v("，而又因为默认字段就是"),t("code",[s._v("@timestamp")]),s._v("，因此这个字段可以省略，配置如下，效果一样。")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("filter "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n   date "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      match        => "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"timestamp"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dd/MMM/YYYY:HH:mm:ss Z"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"UNIX"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"yyyy-MM-dd HH:mm:ss"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dd-MMM-yyyy HH:mm:ss"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h3",{attrs:{id:"_5-timezone"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-timezone"}},[s._v("#")]),s._v(" 5，timezone")]),s._v(" "),t("p",[s._v("当需要配置的 date 里面没有时区信息,而且不是 UTC 时间,需要设置 timezone 参数。\n比如匹配北京时间 "),t("code",[s._v('"2018-06-18 11:10:00"')]),s._v("，则需要设置")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("date "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("    match => "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"logdate"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"yyyy-MM-dd HH:mm:ss"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("    timezone => "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Asia/Chongqing"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ul",[t("li",[s._v("东八区")])]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",{staticStyle:{"text-align":"center"}},[s._v("Standard Offset")]),s._v(" "),t("th",{staticStyle:{"text-align":"center"}},[s._v("Canonical ID")]),s._v(" "),t("th",{staticStyle:{"text-align":"center"}},[s._v("Aliases")])])]),s._v(" "),t("tbody",[t("tr",[t("td",{staticStyle:{"text-align":"center"}},[s._v("+08:00")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("Asia/Chongqing")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("Asia/Chungking")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"center"}},[s._v("+08:00")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("Asia/Hong_Kong")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("Hongkong")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"center"}},[s._v("+08:00")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("Asia/Shanghai")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("PRC")])])])]),s._v(" "),t("p",[s._v("附: "),t("a",{attrs:{href:"http://joda-time.sourceforge.net/timezones.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("timezone 列表"),t("OutboundLink")],1)]),s._v(" "),t("p",[t("img",{attrs:{src:"http://t.eryajf.net/imgs/2021/09/e3337746c7035bdb.jpg",alt:""}})]),s._v(" "),t("h2",{attrs:{id:"_3-几个解析实战-重点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-几个解析实战-重点"}},[s._v("#")]),s._v(" 3，几个解析实战（重点）")]),s._v(" "),t("h3",{attrs:{id:"_1-标准格式iso8601"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-标准格式iso8601"}},[s._v("#")]),s._v(" 1，标准格式"),t("code",[s._v("ISO8601")])]),s._v(" "),t("p",[s._v("如果日志的格式是如上说明的这种标准格式，那么这种日志出来是最省事儿的，不需要进行额外的解析，直接拿来使用即可，最常见的案例就是 NGINX 的日志了。")]),s._v(" "),t("h4",{attrs:{id:"_1-原始日志。"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-原始日志。"}},[s._v("#")]),s._v(" 1，原始日志。")]),s._v(" "),t("p",[s._v("一般情况下，我们会把 NGINX 日志 json 化，关于时间戳的配置，都是这样：")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"@timestamp"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"$time_iso8601"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("然后输出的日志如下：")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"@timestamp"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2019-10-12T21:57:40+08:00"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"host"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"172.16.241.250"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"request_method"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GET"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"clientip"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"42.236.99.65"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"size"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("26977")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"responsetime"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.258")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"upstreamtime"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0.258"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"upstreamhost"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"unix:/tmp/php-cgi.sock"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"http_host"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"wiki.eryajf.net"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"url"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/index.php"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"xff"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"referer"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://wiki.eryajf.net/pages/2217.html"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"agent"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/50.4.2661.102 Safari/537.36; 360Spider"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"status"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"200"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br")])]),t("p",[s._v("那么这种日志，就不需要添加 data 插件进行解析，刨除其他特殊解析之外，直接进行输入输出即可，测试效果如下。")]),s._v(" "),t("h4",{attrs:{id:"_2-配置文件。"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-配置文件。"}},[s._v("#")]),s._v(" 2，配置文件。")]),s._v(" "),t("p",[s._v("此时可用如下配置文件：")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("input "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\tfile "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\tpath \t\t\t=> "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/data/log/test.log"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\t\tcodec \t\t\t=> "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"json"')]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\noutput "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\tstdout "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\tcodec => rubydebug\n\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("h4",{attrs:{id:"_3-测试效果。"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-测试效果。"}},[s._v("#")]),s._v(" 3，测试效果。")]),s._v(" "),t("p",[s._v("此时利用 rubydebug，查看控制台输出效果：")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("$ /usr/share/logstash/bin/logstash -f /usr/share/logstash/test.conf\n\n。。。。。。\n打印信息忽略\n。。。。。。\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n           "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"referer"')]),s._v(" => "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://wiki.eryajf.net/pages/2217.html"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n              "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"host"')]),s._v(" => "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"172.16.241.250"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n             "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"agent"')]),s._v(" => "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/50.4.2661.102 Safari/537.36; 360Spider"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"@timestamp"')]),s._v(" => "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2019")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("-10")]),s._v("-12T13"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("57")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("40")]),s._v(".000Z"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n               "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"xff"')]),s._v(" => "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"clientip"')]),s._v(" => "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"42.236.99.65"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n               "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"url"')]),s._v(" => "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/index.php"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"upstreamtime"')]),s._v(" => "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0.258"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n              "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"path"')]),s._v(" => "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/data/log/test.log"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n              "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"size"')]),s._v(" => "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("26977")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http_host"')]),s._v(" => "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"wiki.eryajf.net"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"@version"')]),s._v(" => "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"status"')]),s._v(" => "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"200"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"request_method"')]),s._v(" => "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GET"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"responsetime"')]),s._v(" => "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.258")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"upstreamhost"')]),s._v(" => "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"unix:/tmp/php-cgi.sock"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br")])]),t("p",[s._v("此时可以看到，我们没有针对原始日志进行任何解析操作，原始日志中的"),t("code",[s._v("@timestamp")]),s._v("字段就自动被 logstash 识别作为了日志的"),t("code",[s._v("@timestamp")]),s._v("，非常方便便捷，而且在这一层也少了解析的步骤，对 logstash 负载是大有好处的，因此我们鼓励开发者使用这种标准格式进行日志的输出打印，当这成为一个标准之后，一切就显得优雅了。")]),s._v(" "),t("h3",{attrs:{id:"_2-带-t模式。"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-带-t模式。"}},[s._v("#")]),s._v(" 2，带 "),t("code",[s._v("T")]),s._v("模式。")]),s._v(" "),t("p",[s._v("我也不知道这种日志具体的格式名称，总之它的特征就是在时间戳里边有一个 "),t("code",[s._v("T")]),s._v("，这个"),t("code",[s._v("T")]),s._v("并不代表任何含义，仅仅作为一个时间戳隔离的无含义字段，因此我们在解析的时候，也可以将其无含义对待，直接套用即可。")]),s._v(" "),t("h4",{attrs:{id:"_1-原始日志。-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-原始日志。-2"}},[s._v("#")]),s._v(" 1，原始日志。")]),s._v(" "),t("p",[s._v("这个一般是开发者定义时间格式，然后输出的日志如下：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('{"timestamp":"2019-10-10T15:37:08+08:00","level":"info","message":"这是一条测试日志"}\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("套用上边表格里边的内容，直接引用后边的 match 配置即可。")]),s._v(" "),t("h4",{attrs:{id:"_2-配置文件。-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-配置文件。-2"}},[s._v("#")]),s._v(" 2，配置文件。")]),s._v(" "),t("p",[s._v("此时可用如下配置文件：")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("input "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\tfile "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\tpath \t\t\t=> "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/data/log/test.log"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\t\tcodec \t\t\t=> "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"json"')]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\nfilter "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\tdate "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\t# 直接将T作为一个占位符，后边的时间也是，不过可以用Z代替\n\t\tmatch => "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"timestamp"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"yyyy-MM-dd'T'HH:mm:ss+08:00\"")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\noutput "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\tstdout "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\tcodec => rubydebug\n\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br")])]),t("h4",{attrs:{id:"_3-测试效果。-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-测试效果。-2"}},[s._v("#")]),s._v(" 3，测试效果。")]),s._v(" "),t("p",[s._v("此时利用 rubydebug，查看控制台输出效果：")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("$ /usr/share/logstash/bin/logstash -f /usr/share/logstash/test.conf\n\n。。。。。。\n打印信息忽略\n。。。。。。\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"@version"')]),s._v(" => "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"path"')]),s._v(" => "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/data/log/test.log"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"host"')]),s._v(" => "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"localhost.localdomain"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"level"')]),s._v(" => "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"info"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n     "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"timestamp"')]),s._v(" => "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2019-10-10T15:37:08+08:00"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"@timestamp"')]),s._v(" => "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2019")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("-10")]),s._v("-10T07"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("37")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("08")]),s._v(".000Z"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n       "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"message"')]),s._v(" => "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"这是一条测试日志"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("p",[s._v("生产当中，如果日志格式与上边例子一致，那么配置也是可以直接复用的，如果有出入，则应该根据实际情况进行特殊配置。")]),s._v(" "),t("h3",{attrs:{id:"_3-业务日志。"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-业务日志。"}},[s._v("#")]),s._v(" 3，业务日志。")]),s._v(" "),t("p",[s._v("有一些应用的日志，或者业务的日志，时间格式极其不标准，各有各的想法，各有各的的模样，就像西游记里边长的各色各样的小妖一般，这种的处理起来就有点棘手了，需要借助于 grok 插件来进行处理。")]),s._v(" "),t("h4",{attrs:{id:"_1-原始日志。-3"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-原始日志。-3"}},[s._v("#")]),s._v(" 1，原始日志。")]),s._v(" "),t("p",[s._v("这种就千奇百怪了，这里举一个例子，算是抛砖引玉，遇到一些相对特殊的，可以自行匹配转换，输出的日志如下：")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2019")]),s._v("-09-17 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(":35:30"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" ---.INFO: "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(":"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"code"')]),s._v(":0,"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"msg"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nowTime"')]),s._v(":1565948130,"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"data"')]),s._v(":0"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h4",{attrs:{id:"_2-配置文件。-3"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-配置文件。-3"}},[s._v("#")]),s._v(" 2，配置文件。")]),s._v(" "),t("p",[s._v("此时可用如下配置文件：")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("input "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    path        "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/data/log/test.log"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    codec       "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"json"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\nfilter "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  grok "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    match         "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"message"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\\[%{YEAR:year}-%{MONTHNUM:month}-%{MONTHDAY:day} %{TIME:time}\\]%{GREEDYDATA}"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    add_field     "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"timestamp"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%{year}-%{month}-%{day} %{time}"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    remove_field  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"day"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"month"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"year"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"time"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("date")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    match         "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"timestamp"')]),s._v(" , "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dd/MMM/YYYY:HH:mm:ss Z"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"UNIX"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"yyyy-MM-dd HH:mm:ss"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dd-MMM-yyyy HH:mm:ss"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    target        "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"@timestamp"')]),s._v("\n    remove_field  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"timestamp"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\noutput "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  stdout "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    codec "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" rubydebug\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br")])]),t("p",[s._v("说明，这个地方，有必要用我个人理解到的，进行一下讲解，很多人都在分享着各种各样的配置，几乎从来没有人用通俗的话讲配置解析一下，而这样的事儿，恰恰又是我喜欢做的，因为这样在别人看到这里的时候，会更加容易有真实的收获。")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("grok")]),s._v(" "),t("p",[s._v("将非结构化事件数据分析到字段中。 这个工具非常适用于系统日志，Apache 和其他网络服务器日志，MySQL 日志，以及通常为人类而不是计算机消耗的任何日志格式。")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("match")]),s._v(" "),t("p",[s._v("这个概念不必介绍了，但是内部的意思值得说明一下，表示将整条日志放入到 message 这一字段中，其中，时间戳逐个匹配，匹配到的赋值给 "),t("code",[s._v('"day", "month", "year", "time"')]),s._v("。")])]),s._v(" "),t("li",[t("p",[s._v("add_field")]),s._v(" "),t("p",[s._v("添加一个字段 timestamp，来承接刚刚解析的时间戳。即将"),t("code",[s._v('"day", "month", "year", "time"')]),s._v("赋值 g 诶 timestamp。")])]),s._v(" "),t("li",[t("p",[s._v("remove_field")]),s._v(" "),t("p",[s._v("当解析到的字段已经赋值给了新的字段，那么原来解析到的"),t("code",[s._v('"day", "month", "year", "time"')]),s._v("就可以丢掉了。")])])])]),s._v(" "),t("li",[t("p",[s._v("date")]),s._v(" "),t("p",[s._v("再往下就比较熟悉了，不必多介绍了，也是本文一直在讲解的内容。")])])]),s._v(" "),t("h4",{attrs:{id:"_3-测试效果。-3"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-测试效果。-3"}},[s._v("#")]),s._v(" 3，测试效果。")]),s._v(" "),t("p",[s._v("此时利用 rubydebug，查看控制台输出效果：")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("$ /usr/share/logstash/bin/logstash "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" /usr/share/logstash/test.conf\n\n。。。。。。\n打印信息忽略\n。。。。。。\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"@version"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1"')]),s._v(",\n          "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"host"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"localhost.localdomain"')]),s._v(",\n       "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"message"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"[2019-09-17 17:35:30] ---.INFO: ===:{'),t("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v("code"),t("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v(":0,"),t("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v("msg"),t("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v(":"),t("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),t("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v("nowTime"),t("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v(":1565948130,"),t("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v("data"),t("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v(':0}"')]),s._v(",\n          "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"path"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/data/log/test.log"')]),s._v(",\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"@timestamp"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2019")]),s._v("-09-17T09:35:30.000Z\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br")])]),t("p",[s._v("这里的输出中，我们可以清晰看到，"),t("code",[s._v("timestamp")]),s._v("输出的时间，与原始日志中的时间是一致的，而且没有"),t("code",[s._v("_dateparsefailure")]),s._v("这个出现，说明解析规则是成功的。")]),s._v(" "),t("h3",{attrs:{id:"_4-系统日志-message。"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-系统日志-message。"}},[s._v("#")]),s._v(" 4，系统日志 message。")]),s._v(" "),t("p",[s._v("有时候可能还需要采集系统的 message 日志，用于记录一些与系统相关的日志记录。")]),s._v(" "),t("h4",{attrs:{id:"_1-原始日志。-4"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-原始日志。-4"}},[s._v("#")]),s._v(" 1，原始日志。")]),s._v(" "),t("p",[s._v("Linux 系统日志输出如下：")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("Oct "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(":01:01 localhost systemd: Starting Session "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(" of user root.\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h4",{attrs:{id:"_2-配置文件。-4"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-配置文件。-4"}},[s._v("#")]),s._v(" 2，配置文件。")]),s._v(" "),t("p",[s._v("此时可用如下配置文件：")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("input "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\tfile "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\tpath \t\t\t=> "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/data/log/test.log"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\nfilter "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\tgrok "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\tmatch  => "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"message"')]),s._v(" => "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%{SYSLOGLINE}"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\tdate "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\tmatch => "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"timestamp"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"MMM dd HH:mm:ss"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\tmutate "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\tremove_field => "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"timestamp"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\noutput "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\tstdout "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\tcodec => rubydebug\n\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br")])]),t("h4",{attrs:{id:"_3-测试效果。-4"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-测试效果。-4"}},[s._v("#")]),s._v(" 3，测试效果。")]),s._v(" "),t("p",[s._v("此时利用 rubydebug，查看控制台输出效果：")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("$ /usr/share/logstash/bin/logstash "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" /usr/share/logstash/test.conf\n\n。。。。。。\n打印信息忽略\n。。。。。。\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n       "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"message"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Oct 10 23:01:01 localhost systemd: Starting Session 9 of user root."')]),s._v(",\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Starting Session 9 of user root."')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n       "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"program"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"systemd"')]),s._v(",\n          "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"path"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/data/log/test.log"')]),s._v(",\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"@timestamp"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2019")]),s._v("-10-10T15:01:01.000Z,\n          "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"host"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"localhost.localdomain"')]),s._v(",\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"@version"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1"')]),s._v(",\n     "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"logsource"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"localhost"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br")])]),t("p",[s._v("这个配置，是借助于 elk 已经给出的一个插件 "),t("code",[s._v("%{SYSLOGLINE}")]),s._v("来完成，配置起来还是比较简便的。")]),s._v(" "),t("p",[s._v("好了，实际生产中实战的例子就举这么几个吧，常规的基本上都可用，如有其它比较特殊的，那么结合 grok 进行匹配即可。")]),s._v(" "),t("h2",{attrs:{id:"_4-时区问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-时区问题"}},[s._v("#")]),s._v(" 4，时区问题")]),s._v(" "),t("p",[s._v("很多中国用户经常提一个问题：为什么 "),t("code",[s._v("@timestamp")]),s._v(" 比我们早了 8 个小时？怎么修改成北京时间？")]),s._v(" "),t("p",[s._v("其实，Elasticsearch 内部(有相当多的软件，都是)，对时间类型字段，是统一采用 UTC 时间，存成 long 长整形数据的！对日志统一采用 UTC 时间存储，是国际安全/运维界的一个通识——欧美公司的服务器普遍广泛分布在多个时区里——不像中国，地域横跨五个时区却只用北京时间。")]),s._v(" "),t("p",[s._v("对于页面查看，ELK 的解决方案是在 Kibana 上，读取浏览器的当前时区，然后在页面上转换时间内容的显示。")]),s._v(" "),t("p",[s._v('所以，建议大家接受这种设定。否则，即便你用 .getLocalTime 修改，也还要面临在 Kibana 上反过去修改，以及 Elasticsearch 原有的 ["now-1h" TO "now"] 这种方便的搜索语句无法正常使用的尴尬。')])])}),[],!1,null,null,null);t.default=e.exports}}]);