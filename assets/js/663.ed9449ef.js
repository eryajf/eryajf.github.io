(window.webpackJsonp=window.webpackJsonp||[]).push([[663],{1005:function(a,s,e){"use strict";e.r(s);var t=e(0),r=Object(t.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h2",{attrs:{id:"项目一-cloudctl"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#项目一-cloudctl"}},[a._v("#")]),a._v(" 项目一： cloudctl")]),a._v(" "),s("p",[a._v("项目地址： "),s("a",{attrs:{href:"https://github.com/eryajf/cloudctl",target:"_blank",rel:"noopener noreferrer"}},[a._v("cloudctl"),s("OutboundLink")],1)]),a._v(" "),s("p",[a._v("运维也可以如此优雅！")]),a._v(" "),s("h3",{attrs:{id:"如何使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#如何使用"}},[a._v("#")]),a._v(" 如何使用")]),a._v(" "),s("p",[a._v("先拷贝配置文件，然后正确配置里边的内容：")]),a._v(" "),s("div",{staticClass:"language-sh line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("cp")]),a._v(" config.example.yml config.yml\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("执行如下指令，查询某日志主题前天单日费用：")]),a._v(" "),s("div",{staticClass:"language-sh line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 你也可以直接在release下载二进制来执行")]),a._v("\n$ cloudctl cls getlogcost "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-l")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"xxxxxxxxxxxxxxxxxx"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-r")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"ap-shanghai"')]),a._v("\n\n前天的花费为: "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("174")]),a._v("元\n日志主题为: xxxxxxxxxxxxxxxxxx\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br")])]),s("p",[a._v("查询某个应用在一个大日志主题中花费的费用。")]),a._v(" "),s("div",{staticClass:"language-sh line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[a._v("$ cloudctl cls getprojectcost "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-b")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"bot_webhook"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-k")]),a._v(" k8s "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-l")]),a._v(" xxxxxxxxxxxxxxxxxxxxxxx "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" testeryajf "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-r")]),a._v(" ap-shanghai\n\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" 应用名称："),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")]),a._v("testeryajf"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")])]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" 应用在主题日志占比： "),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("10")]),a._v("%"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")])]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" 应用单月费用预计： "),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("3000")]),a._v("元"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")])]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("该主题前天单日的费用为: "),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1000")]),a._v("元"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")])]),a._v("\n该主题的ID为: "),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")]),a._v("xxxxxxxxxxxxxxxxxxxxxxx"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")])]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br")])]),s("p",[a._v("通知到群里的消息大概长这样：")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/eryajf/tu/img/image_20230605_184855.png",alt:""}})]),a._v(" "),s("blockquote",[s("p",[a._v("我们的应用场景是，生产环境中，有两个日志主题，一个采集所有 CVM 主机应用的日志，一个采集所有部署在 tke 之中的日志。所以在一个日志主题中，会有许多个应用，每个应用对应了一组服务器。当然在 k8s 中对应的名字就是 deployment 的名字。")])]),a._v(" "),s("p",[a._v("上边所有的参数都比较容易理解，示例当中也给出了明确的解析。这里单独把 project 的参数拿出来说一说。传递应用的名字，程序会首先拼接出如下语句，查询应用在整个日志主题中的日志量占比：")]),a._v(" "),s("ul",[s("li",[a._v("CVM："),s("code",[a._v("* | SELECT ROUND(COUNT(*) * 100.0 / (SELECT COUNT(*)), 2) AS percentage WHERE \"__HOSTNAME__\" like 'testeryajf%'")])]),a._v(" "),s("li",[a._v("K8S: "),s("code",[a._v("* | SELECT ROUND(COUNT(*) * 100.0 / (SELECT COUNT(*)), 2) AS percentage WHERE \"__TAG__.pod_label_app\" 'testeryajf'")])])]),a._v(" "),s("p",[a._v("所以你在运行项目之前，应该先确认如上语句，在你的日志主题当中，能够正常拿到该应用在主题中的日志量百分比。这是算出应用一个月成本评估的基础。")]),a._v(" "),s("p",[a._v("如果你有多个项目想要共同关注，则可以参照 project_list.example.yml 文件，对内容进行配置，运行命令如下：")]),a._v(" "),s("div",{staticClass:"language-sh line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[a._v("$ cloudctl cls getprojectcost "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f")]),a._v(" project_list.example.yml\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("你也可以使用 docker 镜像来运行服务。")]),a._v(" "),s("div",{staticClass:"language-sh line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[a._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-it")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("TC_SERCRET_ID")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"xxxxx"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("TC_SERCRET_KEY")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"xxxxxxxxxx"')]),a._v(" dockerproxy.com/eryajf/cloudctl /app/cloudctl cls getlogcost  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-l")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"222345432454425"')]),a._v("\n\n前天的花费为: "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1000")]),a._v("元\n日志主题为: "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("222345432454425")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br")])]),s("h3",{attrs:{id:"感谢开源"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#感谢开源"}},[a._v("#")]),a._v(" 感谢开源")]),a._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://github.com/eryajf/eryajfctl",target:"_blank",rel:"noopener noreferrer"}},[a._v("eryajfctl"),s("OutboundLink")],1)])]),a._v(" "),s("p",[a._v("如果觉得项目不错，请别忘了一键三连，给个 star。")]),a._v(" "),s("hr"),a._v(" "),s("h2",{attrs:{id:"项目二-eryajfctl"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#项目二-eryajfctl"}},[a._v("#")]),a._v(" 项目二： eryajfctl")]),a._v(" "),s("p",[a._v("项目地址： "),s("a",{attrs:{href:"https://github.com/eryajf/eryajfctl",target:"_blank",rel:"noopener noreferrer"}},[a._v("eryajfctl"),s("OutboundLink")],1)]),a._v(" "),s("p",[a._v("运维也可以如此优雅！快用这个框架打造一个专属于你的工具箱吧！")]),a._v(" "),s("p",[a._v("通过这个框架，你可以快速上手，直接构建你想要的运维工具，而不必再考虑配置，框架设计等内容。")]),a._v(" "),s("h3",{attrs:{id:"如何使用-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#如何使用-2"}},[a._v("#")]),a._v(" 如何使用")]),a._v(" "),s("p",[a._v("先拷贝配置文件:")]),a._v(" "),s("div",{staticClass:"language-sh line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("cp")]),a._v(" config.example.yml config.yml\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("执行如下指令，运行示例参数：")]),a._v(" "),s("div",{staticClass:"language-sh line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[a._v("$ go run main.go ex getconfig "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-w")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"hello, This is eryajfctl"')]),a._v("\n通过配置文件获取到的用户名: eryajf\n通过配置文件获取到的密码: "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("123456")]),a._v("\n通过命令行获取到的内容是: hello, This is eryajfctl\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br")])]),s("blockquote",[s("p",[a._v("其中 ex 为一级参数，getconfig 为二级参数，大多数场景下，分两个层级就够用了，你可以把一级参数当做归类，比如 jenkins, gitlab，二级参数当做功能参数，再往后的参数则是该二级参数所需要的运行时参数。")])]),a._v(" "),s("p",[a._v("也可以编译成二进制，然后通过如下方式查看帮助信息：")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('# 编译\n$ make build\n\n#运行测试\n$ ./eryajfctl ex getconfig -h\n通过命令行获取配置信息\n\nUsage:\n  eryajfctl ex getconfig [flags]\n\nFlags:\n  -h, --help          help for getconfig\n  -w, --word string   测试参数 (default "你好，这是测试")\n')])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br")])]),s("h3",{attrs:{id:"开始开发"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#开始开发"}},[a._v("#")]),a._v(" 开始开发")]),a._v(" "),s("p",[a._v("你可以直接参考 ex 参数的流程，开发新的参数，从而满足实际使用需求。")]),a._v(" "),s("p",[a._v("如果你的配置文件中有敏感数据，可以考虑结合 go-bindata 来使用，通过执行：")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("go-bindata -o=./public/bindata_config.go -pkg=public config.yml\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("然后更改 "),s("a",{attrs:{href:"https://github.com/eryajf/eryajfctl/blob/4cd30714062e5b65746bdb5f100f19bfe38ed52e/public/config.go#L28",target:"_blank",rel:"noopener noreferrer"}},[a._v("public/config.go"),s("OutboundLink")],1),a._v(" 中的配置信息读取方式，接着进入开发即可。")]),a._v(" "),s("p",[a._v("如果后续本地的 config.yml 配置有更新，则再次执行上边的命令，将配置文件注入到 "),s("code",[a._v("bindata_config.go")]),a._v(" 即可。")]),a._v(" "),s("p",[a._v("这样做的一个好处是，你的二进制放到服务器等地运行的时候，既不需要添加 config.yml 文件，也能防止文件中的敏感信息暴漏出去。")]),a._v(" "),s("h3",{attrs:{id:"感谢开源-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#感谢开源-2"}},[a._v("#")]),a._v(" 感谢开源")]),a._v(" "),s("p",[a._v("此框架建立在如下几个优秀的开源项目之上：")]),a._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://github.com/go-yaml/yaml",target:"_blank",rel:"noopener noreferrer"}},[a._v("gopkg.in/yaml.v3 v3.0.1"),s("OutboundLink")],1)]),a._v(" "),s("li",[s("a",{attrs:{href:"https://github.com/spf13/cobra",target:"_blank",rel:"noopener noreferrer"}},[a._v("github.com/spf13/cobra v1.2.1"),s("OutboundLink")],1)])]),a._v(" "),s("h3",{attrs:{id:"其他参考"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#其他参考"}},[a._v("#")]),a._v(" 其他参考")]),a._v(" "),s("p",[a._v("如果你想熟悉了解此框架的详细用法，还可以参考我的如下两篇文章：")]),a._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://wiki.eryajf.net/pages/2bf6c3/",target:"_blank",rel:"noopener noreferrer"}},[a._v("使用 go-bindata 将文件编译进二进制"),s("OutboundLink")],1)]),a._v(" "),s("li",[s("a",{attrs:{href:"https://wiki.eryajf.net/pages/5c4163/",target:"_blank",rel:"noopener noreferrer"}},[a._v("利用 cobra 库快速开发类似 kubectl 一样的命令行工具"),s("OutboundLink")],1)])])])}),[],!1,null,null,null);s.default=r.exports}}]);