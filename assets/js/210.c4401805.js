(window.webpackJsonp=window.webpackJsonp||[]).push([[210],{554:function(s,a,n){"use strict";n.r(a);var t=n(0),e=Object(t.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"_1-基础部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-基础部署"}},[s._v("#")]),s._v(" 1，基础部署")]),s._v(" "),a("p",[s._v("通过如下脚本一键启动 ldap 服务端以及管理端。")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" start.sh\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#!/bin/bash -e")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SERVICE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ldap-service\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("HOST_NAME")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ldap-server\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("LDAP_DOMAIN")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("eryajf.net\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("LDAP_DC")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("eryajf\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("LDAP_DC_ORG")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("net\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("NETWORK_ADAPTER")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("eth0\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PASSWORD")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("123465")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("OPENLDAP")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1.3.0"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PHPLDAPADMIN")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0.9.0"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("HTTPS_PORT")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("88")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("OPENLDAP_PORT")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("389")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${OPENLDAP_PORT}")]),s._v(":389 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${SERVICE}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--hostname")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${HOST_NAME}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--env")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("LDAP_ORGANISATION")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"WPT-Group"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--env")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("LDAP_DOMAIN")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${LDAP_DOMAIN}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--env")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("LDAP_ADMIN_PASSWORD")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${PASSWORD}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--detach")]),s._v(" osixia/openldap:"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${OPENLDAP}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${HTTPS_PORT}")]),s._v(":80 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${SERVICE}")]),s._v("-admin "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--hostname")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${HOST_NAME}")]),s._v("-admin "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--link")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${SERVICE}")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${HOST_NAME}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--env")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PHPLDAPADMIN_LDAP_HOSTS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${HOST_NAME}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--env")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PHPLDAPADMIN_HTTPS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("false "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--detach")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    osixia/phpldapadmin:"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${PHPLDAPADMIN}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-----------------------------------"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PHPLDAP_IP")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" inspect "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{{ .NetworkSettings.IPAddress }}"')]),s._v(" $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("SERVICE"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${SERVICE}")]),s._v(" ldapsearch "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-x")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-H")]),s._v(" ldap://"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${PHPLDAP_IP}")]),s._v(":389 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-b")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dc='),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${LDAP_DC}")]),s._v(",dc="),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${LDAP_DC_ORG}")]),s._v('"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-D")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cn=admin,dc='),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${LDAP_DC}")]),s._v(",dc="),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${LDAP_DC_ORG}")]),s._v('"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-w")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${PASSWORD}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-----------------------------------"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PUB_IP")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ifconfig")]),s._v(" $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("NETWORK_ADAPTER"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"inet"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{print $2}'")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Go to: https://'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${PUB_IP}")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${HTTPS_PORT}")]),s._v('"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Login DN: cn=admin,dc='),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${LDAP_DC}")]),s._v(",dc="),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${LDAP_DC_ORG}")]),s._v('"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Password: '),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${PASSWORD}")]),s._v('"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br")])]),a("p",[s._v("这个脚本会创建一个 ldap 服务，并创建一个 admin 用户，启动之后，访问 "),a("code",[s._v("10.3.0.42:88")]),s._v("，输入用户名密码，得到如下效果：")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://t.eryajf.net/imgs/2021/09/d7b83a519feded65.jpg",alt:"image"}})]),s._v(" "),a("p",[s._v("现在还是一穷二白，什么都没有的状态，接下来，就要进入正式操作了，从创建第一个用户开始，一步一步往前操作。")]),s._v(" "),a("h2",{attrs:{id:"_2-创建两个基本组织"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-创建两个基本组织"}},[s._v("#")]),s._v(" 2，创建两个基本组织")]),s._v(" "),a("p",[s._v("ldap 本质上就是轻量目录协议，那么接下来创建的东西也都可以按目录层级的概念来理解，现在需要先创建两个最外层目录，一个作为人员的所有代理目录，一个作为分组的目录，创建方式如下：")]),s._v(" "),a("p",[a("code",[s._v("注意需要进入到ldap-server的容器内部执行如下命令")])]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF"),a("span",{pre:!0,attrs:{class:"token bash punctuation"}},[s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" ldapadd "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-x")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-D")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cn=admin,dc=eryajf,dc=net"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-w")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("123465")])]),s._v("\ndn: ou=People,dc=eryajf,dc=net\nobjectClass: organizationalUnit\nou: people\n\ndn: ou=Group,dc=eryajf,dc=net\nobjectClass: organizationalUnit\nou: group\nEOF")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("操作过程如下：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-it")]),s._v(" ldap-service "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v("\nroot@ldap-server:/"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# cat << EOF | ldapadd -x -D "cn=admin,dc=eryajf,dc=net" -w 123465')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" dn: "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ou")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("People,dc"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("eryajf,dc"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("net\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" objectClass: organizationalUnit\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" ou: people\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" dn: "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ou")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Group,dc"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("eryajf,dc"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("net\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" objectClass: organizationalUnit\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" ou: group\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" EOF\nadding new entry "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ou=People,dc=eryajf,dc=net"')]),s._v("\nadding new entry "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ou=Group,dc=eryajf,dc=net"')]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("p",[s._v("如果没有报错，则说明创建成功了，这个时候可以去看一下页面上的情况：")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://t.eryajf.net/imgs/2021/09/d42fca5654b967c8.jpg",alt:"image"}})]),s._v(" "),a("p",[s._v("可以看到刚刚说明的创建两个最外层目录已经完成了。")]),s._v(" "),a("p",[s._v("如果报错如下信息：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("ldapadd: attributeDescription "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dn"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("possible missing newline after line "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(", entry "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ou=People,dc=eryajf,dc=net"')]),s._v("?"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nadding new entry "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ou=People,dc=eryajf,dc=net"')]),s._v("\nldap_add: Type or value exists "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    additional info: objectClass: value "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#0 provided more than once")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("这种报错有两种可能，一种是的确里边有了对应记录，我们可以查一下，是否有"),a("code",[s._v("ou=People,dc=eryajf,dc=net")]),s._v("这条记录，如果没有，那么应该就是另外一种情况："),a("code",[s._v("从上边复制下来的配置中间少了一个换行，每个独立的条目之间应该以换行隔开")]),s._v("。")]),s._v(" "),a("h2",{attrs:{id:"_3-创建用户"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-创建用户"}},[s._v("#")]),s._v(" 3，创建用户")]),s._v(" "),a("p",[s._v("有一些操作是创建一些模拟用户，比较不给力，这里直接模拟真实，创建三个用户，操作如下。")]),s._v(" "),a("p",[a("code",[s._v("创建一个liqilong用户：")])]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF"),a("span",{pre:!0,attrs:{class:"token bash punctuation"}},[s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" ldapadd "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-x")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-D")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("cn")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("admin,dc"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("eryajf,dc"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("net "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-w")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("123465")])]),s._v("\ndn: uid=liqilong,ou=People,dc=eryajf,dc=net\nuid: liqilong\ncn: liqilong\nsn: liqilong\ndisplayName: liqilong\nobjectClass: posixAccount\nobjectClass: top\nobjectClass: person\nobjectClass: shadowAccount\nobjectClass: inetOrgPerson\ngecos: System Manager\nloginShell: /bin/bash\nhomeDirectory: /home/liqilong\nuserPassword: liqilong\nuidNumber: 1000\ngidNumber: 1009\nmobile: 15638888888\nmail: liqilong@eryajf.net\npostalAddress: Hangzhou\nEOF")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br")])]),a("p",[a("code",[s._v("创建一个zhangsan用户")])]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF"),a("span",{pre:!0,attrs:{class:"token bash punctuation"}},[s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" ldapadd "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-x")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-D")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("cn")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("admin,dc"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("eryajf,dc"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("net "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-w")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("123465")])]),s._v("\ndn: uid=zhangsan,ou=People,dc=eryajf,dc=net\nuid: zhangsan\ncn: zhangsan\nsn: zhangsan\ndisplayName: zhangsan\nobjectClass: posixAccount\nobjectClass: top\nobjectClass: person\nobjectClass: shadowAccount\nobjectClass: inetOrgPerson\ngecos: System Manager\nloginShell: /bin/bash\nhomeDirectory: /home/zhangsan\nuserPassword: zhangsan\nuidNumber: 1000\ngidNumber: 1009\nmobile: 15638888888\nmail: zhangsan@eryajf.net\npostalAddress: Hangzhou\nEOF")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br")])]),a("p",[a("code",[s._v("创建一个zhaosi用户：")])]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF"),a("span",{pre:!0,attrs:{class:"token bash punctuation"}},[s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" ldapadd "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-x")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-D")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("cn")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("admin,dc"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("eryajf,dc"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("net "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-w")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("123465")])]),s._v("\ndn: uid=zhaosi,ou=People,dc=eryajf,dc=net\nuid: zhaosi\ncn: zhaosi\nsn: zhaosi\ndisplayName: zhaosi\nobjectClass: posixAccount\nobjectClass: top\nobjectClass: person\nobjectClass: shadowAccount\nobjectClass: inetOrgPerson\ngecos: System Manager\nloginShell: /bin/bash\nhomeDirectory: /home/zhaosi\nuserPassword: zhaosi\nuidNumber: 1000\ngidNumber: 1009\nmobile: 15638888888\nmail: zhaosi@eryajf.net\npostalAddress: Hangzhou\nEOF")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br")])]),a("p",[s._v("注意这里为了变更全局的内容方便，用户名密码是一致的。")]),s._v(" "),a("h2",{attrs:{id:"_4-创建组"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-创建组"}},[s._v("#")]),s._v(" 4，创建组")]),s._v(" "),a("p",[s._v("组的概念帮助我们大大减轻很多人员权限配置的工作量，它是与用户平行的目录等级，至于创建什么样的组，以哪个维度进行划分，都是可以的，只要实际需求合理，都是可以的。")]),s._v(" "),a("p",[s._v("这里就以常见配置环境中的分组维度，分如下几个组：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF"),a("span",{pre:!0,attrs:{class:"token bash punctuation"}},[s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" ldapadd "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-x")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-D")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("cn")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("admin,dc"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("eryajf,dc"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("net "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-w")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("123465")])]),s._v("\ndn: cn=ops,ou=Group,dc=eryajf,dc=net\ncn: ops\ngidNumber: 66\nobjectClass: top\nobjectClass: posixGroup\n\ndn: cn=dev,ou=Group,dc=eryajf,dc=net\ncn: dev\ngidNumber: 66\nobjectClass: top\nobjectClass: posixGroup\n\ndn: cn=jenkins,ou=Group,dc=eryajf,dc=net\ncn: jenkins\ngidNumber: 66\nobjectClass: top\nobjectClass: posixGroup\nEOF")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br")])]),a("p",[s._v("创建了三个组，两个是组织上的概念，一个是应用层面的概念，创建之后效果如下：")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://t.eryajf.net/imgs/2021/09/05bdb647659c5f0c.jpg",alt:"image"}})]),s._v(" "),a("h2",{attrs:{id:"_5-各就各位"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-各就各位"}},[s._v("#")]),s._v(" 5，各就各位")]),s._v(" "),a("p",[s._v("前边已经创建了一些用户， 一些组，现在就来对这些用户进行分组，我称之为各就各位。")]),s._v(" "),a("p",[s._v("通过如下方式可以将一个用户加入到某个组内：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF"),a("span",{pre:!0,attrs:{class:"token bash punctuation"}},[s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" ldapmodify "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-x")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-D")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("cn")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("admin,dc"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("eryajf,dc"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("net "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-w")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("123465")])]),s._v("\ndn: cn=ops,ou=Group,dc=eryajf,dc=net\nchangetype: modify\nadd: memberuid\nmemberuid: liqilong\n\ndn: cn=ops,ou=Group,dc=eryajf,dc=net\nchangetype: modify\nadd: memberuid\nmemberuid: zhaosi\nEOF")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[s._v("如上意思表示将 "),a("code",[s._v("liqilong")]),s._v("和 "),a("code",[s._v("zhaosi")]),s._v("加入到 ops 这个组，操作之后现在可以看下 web 页面：")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://t.eryajf.net/imgs/2021/09/97fc5525b6a34b2f.jpg",alt:"image"}})]),s._v(" "),a("p",[s._v("可以看到用户已经在对应组内了，这个时候如果需要添加更多用户，可以直接通过下边 "),a("code",[s._v("add value")]),s._v("进行添加。")]),s._v(" "),a("p",[s._v("到现在，基本上的用户日常管理都差不多都介绍到了，接下来介绍一下数据的备份问题。")]),s._v(" "),a("h2",{attrs:{id:"_6-备份的操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-备份的操作"}},[s._v("#")]),s._v(" 6，备份的操作")]),s._v(" "),a("p",[s._v("备份是非常有必要的，任何一个说备份没必要的，都不必与他抬杠。")]),s._v(" "),a("p",[s._v("ldap 通过 slapcat 命令进行备份，可以在容器内部执行，但是如果我们想将备份的指令放入到定时任务的话，就需要通过如下方式进行备份了：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /data/ldap/bak\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-it")]),s._v(" ldap-service /bin/bash "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'slapcat -v -l 20191220.ldif'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" ldap-service:/20191220.ldif  /data/ldap/bak\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-it")]),s._v(" ldap-service /bin/bash "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'rm -f /20191220.ldif'")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("这样就把备份之后的文件放置到宿主机上了。")]),s._v(" "),a("p",[s._v("如果 cat 一下文件的内容，发现都是定义各个角色的语句，这个语句是完整版的，可以通过如下操作进行精简。")]),s._v(" "),a("p",[s._v("先指定过滤策略：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" openldap-backup.synax "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF\n/^creatorsName: /d\n/^modifiersName: /d\n/^modifyTimestamp: /d\n/^structuralobjectClass: /d\n/^createTimestamp: /d\n/^entryUUID: /d\n/^entryCSN: /d\nEOF")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("然后通过 sed 对文件进行处理：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20191220")]),s._v(".ldif "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" openldap-backup.synax "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" new.ldif\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ops-eryajf-test-2 bak"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$cat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20191220")]),s._v(".ldif "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wc")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("178")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ops-eryajf-test-2 bak"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$cat")]),s._v(" new.ldif "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wc")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("118")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("这个时候，有了备份文件在手，就算直接把 ldap 给干了，也不用发愁，因为随时可以通过备份文件进行恢复。刚刚已经写了如何通过命令行备份，那么放入定时任务就不赘述了。")]),s._v(" "),a("h2",{attrs:{id:"_7-恢复演练"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-恢复演练"}},[s._v("#")]),s._v(" 7，恢复演练")]),s._v(" "),a("p",[s._v("未经恢复测试的备份都不能叫完整的备份。")]),s._v(" "),a("p",[s._v("现在直接将 docker 启动的两个容器干掉，因为并没有将数据目录往外挂载，所以再次启动的时候数据将会清空，一切都回到第一步时候的状态。")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://t.eryajf.net/imgs/2021/09/d7b83a519feded65.jpg",alt:"image"}})]),s._v(" "),a("p",[s._v("现在就利用刚刚保留的备份来进行一波恢复。")]),s._v(" "),a("p",[s._v("先将备份文件拷贝到容器之内：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" new.ldif ldap-service:/opt\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("接着进入容器进行恢复，这个时候发现报了错：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("ldapadd "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-x")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-D")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cn=admin,dc=eryajf,dc=net"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-w")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("123465")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" new.ldif\nadding new entry "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dc=eryajf,dc=net"')]),s._v("\nldap_add: Constraint violation "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    additional info: structuralObjectClass: no user modification allowed\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("这是因为存在一些系统规则，如下操作去掉这些规则：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("slapcat.regex "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF\n/^creatorsName: /d\n/^createTimestamp: /d\n/^modifiersName: /d\n/^modifyTimestamp: /d\n/^structuralObjectClass: /d\n/^entryUUID: /d\n/^entryCSN: /d\nEOF")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("过滤规则，重写文件内容：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("cat new.ldif | sed -f slapcat.regex > neww.ldif\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("然后进行恢复，发现又报错了：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("ldapadd "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-x")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-D")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cn=admin,dc=eryajf,dc=net"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-w")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("123465")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" neww.ldif\nadding new entry "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dc=eryajf,dc=net"')]),s._v("\nldap_add: Already exists "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("68")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("这个报错说有内容已经存在了，我们应该想起一开始启动的时候创建了 admin 这个用户，所以备份文件里边就应该去掉，现在编辑一下备份文件，将头上的内容删除：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("head")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-15")]),s._v(" new.ldif\ndn: "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dc")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("eryajf,dc"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("net\nobjectClass: "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("top")]),s._v("\nobjectClass: dcObject\nobjectClass: organization\no: WPT-Group\ndc: eryajf\nstructuralObjectClass: organization\n\ndn: "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("cn")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("admin,dc"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("eryajf,dc"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("net\nobjectClass: simpleSecurityObject\nobjectClass: organizationalRole\ncn: admin\ndescription: LDAP administrator\nuserPassword:: "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("e1NTSEF9amplNk43SVp3VkFSSkRRM01pUCszbGU3RURqNVFSMEg")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\nstructuralObjectClass: organizationalRole\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("p",[s._v("这部分删除之后，再次导入，发现执行成功了：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("ldapadd "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-x")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-D")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cn=admin,dc=eryajf,dc=net"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-w")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("123465")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" neww.ldif\n\nadding new entry "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ou=People,dc=eryajf,dc=net"')]),s._v("\n\nadding new entry "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ou=Group,dc=eryajf,dc=net"')]),s._v("\n\nadding new entry "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"uid=liqilong,ou=People,dc=eryajf,dc=net"')]),s._v("\n\nadding new entry "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"uid=zhangsan,ou=People,dc=eryajf,dc=net"')]),s._v("\n\nadding new entry "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"uid=zhaosi,ou=People,dc=eryajf,dc=net"')]),s._v("\n\nadding new entry "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cn=ops,ou=Group,dc=eryajf,dc=net"')]),s._v("\n\nadding new entry "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cn=dev,ou=Group,dc=eryajf,dc=net"')]),s._v("\n\nadding new entry "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cn=jenkins,ou=Group,dc=eryajf,dc=net"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])]),a("p",[s._v("再到界面刷一下，看到数据恢复到了干掉之前的样子了。")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://t.eryajf.net/imgs/2021/09/97fc5525b6a34b2f.jpg",alt:"image"}})]),s._v(" "),a("p",[s._v("到这里，基本上 ldap 相关的日常使用管理就足够了。")])])}),[],!1,null,null,null);a.default=e.exports}}]);