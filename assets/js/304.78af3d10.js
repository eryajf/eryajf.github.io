(window.webpackJsonp=window.webpackJsonp||[]).push([[304],{646:function(s,a,t){"use strict";t.r(a);var e=t(0),n=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[s._v("公司已经有 harbor 作为 docker 的镜像仓库，但 Harbor 只能作为私有仓库，当需要 Docker Hub 或其他远程仓库上的镜像时，他就无能为力了。我们就只能手动到远程仓库上进行下载，再重新打标签，然后在推到 harbor 上，才能使用。")]),s._v(" "),a("p",[s._v("我们想要的仓库应该是既能充当私有仓库，又能在你拉取本地没有的镜像时，同步远程的公共镜像仓库，说了这些，就想起，java 项目的日常依赖解决，大概也是这么一个思路。")]),s._v(" "),a("p",[s._v("而为 java 项目提供私有仓库服务的 nexus3，正好也支持 docker 仓库，不仅如此，他还支持 yum, apt, npm, ruby gems, pypi 等诸多类型的仓库功能。因此，我们大概可以感受到，"),a("code",[s._v("学会nexus3，走遍天下都不怕！")])]),s._v(" "),a("p",[s._v("那么今天，就先来讲解研究一下，如何使用 nexus3 来配置成 docker 的私有仓库。")]),s._v(" "),a("h2",{attrs:{id:"_1-安装-nexus3。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-安装-nexus3。"}},[s._v("#")]),s._v(" 1，安装 nexus3。")]),s._v(" "),a("p",[s._v("这个地方略了，安装部署可以参考："),a("a",{attrs:{href:"https://wiki.eryajf.net/pages/1803.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("nexus3 安装配置。"),a("OutboundLink")],1)]),s._v(" "),a("h2",{attrs:{id:"_2-配置走起。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-配置走起。"}},[s._v("#")]),s._v(" 2，配置走起。")]),s._v(" "),a("h3",{attrs:{id:"_1-创建-blob-存储。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-创建-blob-存储。"}},[s._v("#")]),s._v(" 1，创建 blob 存储。")]),s._v(" "),a("p",[s._v("登陆之后，先创建一个用于存储镜像的空间。")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://t.eryajf.net/imgs/2021/09/20ca7b326a81abf2.jpg",alt:"image"}})]),s._v(" "),a("p",[s._v("定义一个 name，下边的内容会自动补全。")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://t.eryajf.net/imgs/2021/09/055d4e72601f74ae.jpg",alt:"image"}})]),s._v(" "),a("p",[s._v("然后保存。")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://t.eryajf.net/imgs/2021/09/b6ec8c6bbc513cd5.jpg",alt:"image"}})]),s._v(" "),a("p",[s._v("这里因为我用的测试服务器演示，因此存储没有那么大，实际生产中使用，建议服务器存储 500G 或以上。")]),s._v(" "),a("h3",{attrs:{id:"_2-创建一个-hosted-类型的-docker-仓库。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-创建一个-hosted-类型的-docker-仓库。"}},[s._v("#")]),s._v(" 2，创建一个 hosted 类型的 docker 仓库。")]),s._v(" "),a("p",[s._v("Hosted 类型仓库用作我们的私有仓库，替代 harbor 的功能。")]),s._v(" "),a("p",[s._v("点击步骤如下：")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://t.eryajf.net/imgs/2021/09/e1e0444469942b4c.jpg",alt:"image"}})]),s._v(" "),a("p",[s._v("而后可见：")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://t.eryajf.net/imgs/2021/09/ae9fbbf56a55ca8b.jpg",alt:"image"}})]),s._v(" "),a("p",[s._v("所支持种类之丰富，可见一斑。")]),s._v(" "),a("p",[s._v("这里我们看到 docker 类型有三种：")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("hosted")]),s._v(" : 本地存储，即同 docker 官方仓库一样提供本地私服功能。")]),s._v(" "),a("li",[a("code",[s._v("proxy")]),s._v(" : 提供代理其他仓库的类型，如 docker 中央仓库。")]),s._v(" "),a("li",[a("code",[s._v("group")]),s._v(" : 组类型，实质作用是组合多个仓库为一个地址。")])]),s._v(" "),a("hr"),s._v(" "),a("p",[s._v("我们先来创建一个 hosted 类型的私有仓库。")]),s._v(" "),a("p",[s._v("点击 "),a("code",[s._v("Repository")]),s._v("下面的"),a("code",[s._v("Repositories")]),s._v(" – Create repository – "),a("code",[s._v("docker(hosted)")]),s._v(" :")]),s._v(" "),a("ul",[a("li",[a("p",[a("code",[s._v("Name")]),s._v(": 定义一个名称 docker-local")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("Online")]),s._v(": 勾选。这个开关可以设置这个 Docker repo 是在线还是离线。")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("Repository Connectors")])])]),s._v(" "),a("li",[a("p",[s._v("下面包含 HTTP 和 HTTPS 两种类型的 port。")])]),s._v(" "),a("li",[a("p",[s._v("有什么用呢？说明讲得很清楚：")])]),s._v(" "),a("li",[a("p",[s._v("连接器允许 docker 客户端直接连接到 docker 仓库，并实现一些请求操作，如 docker pull, docker push, API 查询等。但这个连接器并不是一定需要配置的，尤其是我们后面会用 group 类型的 docker 仓库来聚合它。")])])]),s._v(" "),a("p",[s._v("我们把 HTTP 这里勾选上，然后设置端口为 8083。")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("Force basic authentication")])])]),s._v(" "),a("p",[s._v("勾选。这样的话就不允许匿名访问了，执行 docker pull 或 docker push 之前，都要先登录：docker login")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("Docker Registry API Support")])])]),s._v(" "),a("p",[s._v("Docker registry 默认使用的是 API v2, 但是为了兼容性，我们可以勾选启用 API v1。")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("Storage")])])]),s._v(" "),a("p",[a("code",[s._v("Blob store")]),s._v("：我们下拉选择前面创建好的专用 blob：idocker-hub。")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("Hosted")])])]),s._v(" "),a("p",[s._v("开发环境，我们运行重复发布，因此 Delpoyment policy 我们选择 Allow redeploy。")]),s._v(" "),a("p",[s._v("整体配置截图如下：")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://t.eryajf.net/imgs/2021/09/4f066113177f7a6a.jpg",alt:"image"}})]),s._v(" "),a("div",{staticClass:"custom-block note"},[a("p",{staticClass:"custom-block-title"},[s._v("申明")]),s._v(" "),a("p",[a("strong",[s._v("原创文章"),a("Badge",{attrs:{text:"eryajf"}}),s._v("，未经授权，严禁转载，侵权必究！此乃文中随机水印，敬请读者谅解。")],1)]),s._v(" "),a("div",{staticClass:"custom-block right"},[a("p",[s._v("Copyright "),a("a",{attrs:{href:"https://wiki.eryajf.net",target:"_blank",rel:"noopener noreferrer"}},[s._v("二丫讲梵"),a("OutboundLink")],1),s._v(" 版权所有")])])]),s._v(" "),a("h3",{attrs:{id:"_3-创建一个-proxy-类型的-docker-仓库。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-创建一个-proxy-类型的-docker-仓库。"}},[s._v("#")]),s._v(" 3，创建一个 proxy 类型的 docker 仓库。")]),s._v(" "),a("p",[s._v("proxy 类型仓库，可以帮助我们访问不能直接到达的网络，如另一个私有仓库，或者国外的公共仓库，如官方的 dockerhub 镜像库。")]),s._v(" "),a("p",[s._v("创建一个 proxy 类型的仓库")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("Name")]),s._v(": proxy-docker-hub")])]),s._v(" "),a("p",[a("code",[s._v("Repository Connectors")]),s._v(": 不设置。")]),s._v(" "),a("ul",[a("li",[a("p",[a("code",[s._v("Proxy")])]),s._v(" "),a("p",[a("code",[s._v("Remote Storage")]),s._v(": docker hub 的 proxy，这里填写: "),a("a",{attrs:{href:"https://registry-1.docker.io/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://registry-1.docker.io"),a("OutboundLink")],1),s._v(" 这个是官方默认的一个链接，我这里配置使用"),a("a",{attrs:{href:"https://dashboard.daocloud.io/",target:"_blank",rel:"noopener noreferrer"}},[s._v("DaoCloud"),a("OutboundLink")],1),s._v("的容器加速："),a("a",{attrs:{href:"http://f1361db2.m.daocloud.io/",target:"_blank",rel:"noopener noreferrer"}},[s._v("http://f1361db2.m.daocloud.io"),a("OutboundLink")],1)])]),s._v(" "),a("li",[a("p",[a("code",[s._v("Docker Index")]),s._v("： Use Docker Hub")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("Storage")]),s._v("：idocker-hub")])])]),s._v(" "),a("p",[s._v("整体配置截图如下：")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://t.eryajf.net/imgs/2021/09/3642116fb21952be.jpg",alt:"image"}})]),s._v(" "),a("h3",{attrs:{id:"_4-创建一个-group-类型的-docker-仓库。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-创建一个-group-类型的-docker-仓库。"}},[s._v("#")]),s._v(" 4，创建一个 group 类型的 docker 仓库。")]),s._v(" "),a("p",[s._v("group 类型的 docker 仓库，是一个聚合类型的仓库。它可以将前面我们创建的 3 个仓库聚合成一个 URL 对外提供服务，可以屏蔽后端的差异性，实现类似透明代理的功能。")]),s._v(" "),a("ul",[a("li",[a("p",[a("code",[s._v("name")]),s._v("：docker-group")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("Repository Connectors")]),s._v("：启用了一个监听在 8082 端口的 http 连接器；")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("Storage")]),s._v("：选择专用的 blob 存储 idocker-hub。")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("group")]),s._v(" : 将左边可选的 3 个仓库，添加到右边的 members 下。")])])]),s._v(" "),a("p",[s._v("整体配置截图如下：")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://t.eryajf.net/imgs/2021/09/be432d8061a6c14f.jpg",alt:"image"}})]),s._v(" "),a("p",[s._v("到这儿，nexus3 的配置算是完成了，接下来就是使用方面的事情了。")]),s._v(" "),a("h2",{attrs:{id:"_3-小插曲。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-小插曲。"}},[s._v("#")]),s._v(" 3，小插曲。")]),s._v(" "),a("p",[s._v("大家也看到了上边的截图都是比较长的，这几张图来的并不容易。在获取这些图的过程中，我尝试过自己御用的截图工具，也尝试过 Chrome 的网页截图，还尝试过其他的各种截图工具，无论是截全屏，还是滚动截图，无所不用其极，却无一能够截出令自己满意的图，哎，都是完美主义（强迫症）做的怪，于是，趁着公司已经夜深无人，我最终通过如下方式截到了心仪的长图。")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://t.eryajf.net/imgs/2021/09/40812c3eeee27b73.jpg",alt:"2018101612290696"}})]),s._v(" "),a("p",[s._v("不为别的，只为把所分享的东西做的足够精致。当然，各位观众朋友如果有更好的截图工具，并且在 nexus3 这个界面里截出了像我截的那么长的图的话，欢迎在评论区留言分享。")]),s._v(" "),a("h2",{attrs:{id:"_4-常规方式使用。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-常规方式使用。"}},[s._v("#")]),s._v(" 4，常规方式使用。")]),s._v(" "),a("p",[s._v("请注意，这种方式经我测试，总是失败，原因还没查出来。如果有人知道原因是什么，麻烦留言区告知一下。")]),s._v(" "),a("h3",{attrs:{id:"_1-配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-配置"}},[s._v("#")]),s._v(" 1，配置")]),s._v(" "),a("p",[s._v("配置"),a("code",[s._v("/etc/docker/daemon.json")]),s._v("， 由于不是 https，所以要在 daemon.json 中配置一下：")]),s._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"insecure-registries"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.157.110:8082"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"_2-重启-docker。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-重启-docker。"}},[s._v("#")]),s._v(" 2，重启 docker。")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$systemctl")]),s._v(" daemon-reload\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$systemctl")]),s._v(" restart "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h3",{attrs:{id:"_3-pull-镜像。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-pull-镜像。"}},[s._v("#")]),s._v(" 3，pull 镜像。")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" pull redis\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"_4-登陆私服。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-登陆私服。"}},[s._v("#")]),s._v(" 4，登陆私服。")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" login "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-u")]),s._v(" admin "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" admin123 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".157.110:8082\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"_5-打标签。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-打标签。"}},[s._v("#")]),s._v(" 5，打标签。")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" tag docker.io/redis "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".157.110:8082/redis\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"_6-push-镜像。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-push-镜像。"}},[s._v("#")]),s._v(" 6，push 镜像。")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@docker ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$docker")]),s._v(" push "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".157.110:8082/redis\n\n然后报错：\n\nThe push refers to a repository "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".157.110:8082/redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n902afb26cfff: Layer already exists\n21497520b817: Layer already exists\na3514b4102be: Layer already exists\n714e32c05337: Layer already exists\nd98fb630fb3b: Layer already exists\n8b15606a9e3e: Layer already exists\nerror parsing HTTP "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("404")]),s._v(" response body: unexpected end of JSON input: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("暂时不知这个报错问题的原因是什么，因为最终没有采用这种方式，所以没有深入探究。")]),s._v(" "),a("h2",{attrs:{id:"_5-nginx-代理方式。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-nginx-代理方式。"}},[s._v("#")]),s._v(" 5，nginx 代理方式。")]),s._v(" "),a("p",[s._v("以下内容参考张戈博客，中有删改。")]),s._v(" "),a("p",[s._v("在部署 Nginx 部分，我们先需要生成自签名 SSL 证书，因为后面不想在 docker pull 的时候还要带一个端口！这里我们需要 2 个域名，一个用来展示 nexus 前台，另一个用做 docker 仓库，比如：")]),s._v(" "),a("ul",[a("li",[s._v("nexus 前台："),a("code",[s._v("repo.ald.com")])]),s._v(" "),a("li",[s._v("docker 仓库："),a("code",[s._v("idocker.io")])])]),s._v(" "),a("h3",{attrs:{id:"_1-安装-nginx。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-安装-nginx。"}},[s._v("#")]),s._v(" 1，安装 nginx。")]),s._v(" "),a("p",[s._v("先通过"),a("code",[s._v("curl 192.168.106.10/a | sh")]),s._v("安装 nginx。")]),s._v(" "),a("h3",{attrs:{id:"_2-生成证书。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-生成证书。"}},[s._v("#")]),s._v(" 2，生成证书。")]),s._v(" "),a("p",[s._v("生成自签名 SSL 证书的方法网上很多，这里推荐一个一键生成工具，大家可以尝试使用：")]),s._v(" "),a("div",{staticClass:"cardListContainer"},[a("div",{staticClass:"card-list"},[a("a",{staticClass:"card-item row-1",staticStyle:{"background-color":"#0074ff","--randomColor":"#0074ff",color:"#fff"},attrs:{href:"https://github.com/Fishdrowned/ssl",target:"_blank"}},[a("img",{staticClass:"no-zoom",attrs:{src:"https://avatars2.githubusercontent.com/u/416130?s=460&u=8753e86600e300a9811cdc539aa158deec2e2724&v=4"}}),s._v(" "),a("div",[a("p",{staticClass:"name"},[s._v("ssl")]),s._v(" "),a("p",{staticClass:"desc"},[s._v("ssl生成工具")])])])]),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ssl\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("desc")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ssl生成工具\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("avatar")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" https"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//avatars2.githubusercontent.com/u/416130"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("?")]),s._v("s=460"),a("span",{pre:!0,attrs:{class:"token important"}},[s._v("&u=8753e86600e300a9811cdc539aa158deec2e2724&v=4")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可选")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("link")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" https"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//github.com/Fishdrowned/ssl "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可选")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("bgColor")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"#0074ff"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可选，默认var(--bodyBg)。颜色值有#号时请添加单引号")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("textColor")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"#fff"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可选，默认var(--textColor)")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])])]),a("p",[s._v("这个工具。")]),s._v(" "),a("p",[s._v("创建方式如下：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#直接切换到应用目录。")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@nexus ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$cd")]),s._v(" /usr/local/nginx/conf\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#下载工具。")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@nexus conf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$git")]),s._v(" clone https://github.com/Fishdrowned/ssl.git\nCloning into "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ssl'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nremote: Enumerating objects: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("106")]),s._v(", done.\nremote: Total "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("106")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("delta "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", reused "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("delta "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", pack-reused "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("106")]),s._v("\nReceiving objects: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("% "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("106")]),s._v("/106"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("171.53")]),s._v(" KiB "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("286.00")]),s._v(" KiB/s, done.\nResolving deltas: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("% "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("48")]),s._v("/48"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", done.\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#生成证书。")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@nexus ssl"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("$./gen.cert.sh idocker.io\nUsing configuration from ./ca.cnf\nCheck that the request matches the signature\nSignature ok\nThe Subject"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s Distinguished Name is as follows\ncountryName           :PRINTABLE:'")]),s._v("CN"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'\nstateOrProvinceName   :ASN.1 12:'")]),s._v("Guangdong"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'\nlocalityName          :ASN.1 12:'")]),s._v("Guangzhou"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'\norganizationName      :ASN.1 12:'")]),s._v("Fishdrowned"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'\norganizationalUnitName:ASN.1 12:'")]),s._v("idocker.io"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'\ncommonName            :ASN.1 12:'")]),s._v("*.idocker.io'\nCertificate is to be certified "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("until")]),s._v(" Oct "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(" 06:18:13 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v(" GMT "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1461")]),s._v(" days"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nWrite out database with "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" new entries\nData Base Updated\n\nCertificates are located in:\nlrwxrwxrwx "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("37")]),s._v(" Oct "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":18 /usr/local/nginx/conf/ssl/out/idocker.io/idocker.io.bundle.crt -"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" ./20181016-1418/idocker.io.bundle.crt\nlrwxrwxrwx "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v(" Oct "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":18 /usr/local/nginx/conf/ssl/out/idocker.io/idocker.io.crt -"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" ./20181016-1418/idocker.io.crt\nlrwxrwxrwx "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(" Oct "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":18 /usr/local/nginx/conf/ssl/out/idocker.io/idocker.io.key.pem -"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/cert.key.pem\nlrwxrwxrwx "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(" Oct "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":18 /usr/local/nginx/conf/ssl/out/idocker.io/root.crt -"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/root.crt\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br")])]),a("h3",{attrs:{id:"_3-配置-nginx。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-配置-nginx。"}},[s._v("#")]),s._v(" 3，配置 nginx。")]),s._v(" "),a("p",[s._v("将如下配置写入"),a("code",[s._v("nginx.conf")]),s._v("。")]),s._v(" "),a("div",{staticClass:"language-nginx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("upstream")]),s._v(" nexus_docker_get")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" 192.168.157.110:8082")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("upstream")]),s._v(" nexus_docker_put")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" 192.168.157.110:8083")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v(" ssl")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v(" idocker.io")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("access_log")]),s._v(" /var/log/nginx/idocker.io.log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 证书")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ssl_certificate")]),s._v(" /usr/local/nginx/conf/ssl/out/idocker.io/idocker.io.crt")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ssl_certificate_key")]),s._v(" /usr/local/nginx/conf/ssl/out/cert.key.pem")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ssl_protocols")]),s._v(" TLSv1.1 TLSv1.2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ssl_ciphers")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'!aNULL:kECDH+AESGCM:ECDH+AESGCM:RSA+AESGCM:kECDH+AES:ECDH+AES:RSA+AES:'")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ssl_prefer_server_ciphers")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("on")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ssl_session_cache")]),s._v(" shared:SSL:10m")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# disable any limits to avoid HTTP 413 for large image uploads")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("client_max_body_size")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# required to avoid HTTP 411: see Issue #1486 (https://github.com/docker/docker/issues/1486)")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("chunked_transfer_encoding")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("on")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置默认使用推送代理")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$upstream")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nexus_docker_put"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 当请求是GET，也就是拉取镜像的时候，这里改为拉取代理，如此便解决了拉取和推送的端口统一")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" ( "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$request_method")]),s._v(" ~* "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'GET'")]),s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$upstream")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nexus_docker_get"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),s._v(" index.html index.htm index.php")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" /")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" http://"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$upstream")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" Host "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$host")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_connect_timeout")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3600")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_send_timeout")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3600")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_read_timeout")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3600")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" X-Real-IP "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_addr")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_buffering")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("off")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_request_buffering")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("off")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" X-Forwarded-For "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$proxy_add_x_forwarded_for")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" X-Forwarded-Proto http")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br")])]),a("p",[s._v("如果有一些操作与本文不一致，那么请根据自己实际情况进行修改。")]),s._v(" "),a("p",[a("code",[s._v("nginx -t")]),s._v("检查没有问题的话，就可以启动 nginx 了。")]),s._v(" "),a("h3",{attrs:{id:"_4-客户端配置。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-客户端配置。"}},[s._v("#")]),s._v(" 4，客户端配置。")]),s._v(" "),a("p",[s._v("部署完成之后，我们就可以找一台测试机器进行测试了，不过因为我们刚刚定义的是内部使用的域名，所以需要在测试机器上写 hosts 解析，并将证书拷贝过去，否则会报报不信任的错误。")]),s._v(" "),a("p",[s._v("在上文介绍的一键生成自签名工具中，会生成一个根证书，名称为"),a("code",[s._v("/usr/local/nginx/conf/ssl/out/root.crt")]),s._v("，我们将这个文件上传到客户端服务器的 "),a("code",[s._v("/etc/docker/certs.d/idocker.io")]),s._v(" 目录即可（注意目录需要创建，最后的文件夹名称和仓库域名保持一致："),a("code",[s._v("idocker.io")]),s._v("）。")]),s._v(" "),a("p",[s._v("现在到一台新主机上测试：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@docker ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.157.110 idocker.io"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /etc/hosts\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@docker ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$mkdir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" /etc/docker/certs.d/idocker.io\n\n然后去nexus主机上，将刚才的证书拷过来：\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("scp")]),s._v(" /usr/local/nginx/conf/ssl/out/root.crt root@192.168.157.106:/etc/docker/certs.d/idocker.io/ca.crt\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("接下来，就可以开始真正的使用了。")]),s._v(" "),a("h2",{attrs:{id:"_6-正式验证。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-正式验证。"}},[s._v("#")]),s._v(" 6，正式验证。")]),s._v(" "),a("h3",{attrs:{id:"_1-pull-镜像。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-pull-镜像。"}},[s._v("#")]),s._v(" 1，pull 镜像。")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@docker ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$docker")]),s._v(" pull docker.io/nginx\nUsing default tag: latest\nTrying to pull repository docker.io/library/nginx "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nlatest: Pulling from docker.io/library/nginx\nf17d81b4b692: Pull complete\nd5c237920c39: Pull complete\na381f92f36de: Pull complete\nDigest: sha256:4ddaf6043a77aa145ce043d4c662e3768556421d6c0a65d303e89977ad3c9636\nStatus: Downloaded newer image "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" docker.io/nginx:latest\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@docker ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$docker")]),s._v(" images\nREPOSITORY          TAG                 IMAGE ID            CREATED             SIZE\ndocker.io/nginx     latest              dbfc48660aeb        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("45")]),s._v(" minutes ago      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("109")]),s._v(" MB\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("h3",{attrs:{id:"_2-登陆私服。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-登陆私服。"}},[s._v("#")]),s._v(" 2，登陆私服。")]),s._v(" "),a("p",[s._v("这个地方也可能在登陆的时候会报错，说证书过期什么的，如下：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@moban idocker.io"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$docker")]),s._v(" login "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-u")]),s._v(" admin "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" admin123 idocker.io\nError response from daemon: Get https://idocker.io/v1/users/: x509: certificate has expired or is not yet valid\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("报这个错的情况下，大概原因只有一个，那就是，两台服务器的时间不一致，只需要将两台服务器时间保持一致即可。")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("yum "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" ntpdate "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" ntpdate "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-u")]),s._v(" cn.pool.ntp.org\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("分别在两台主机执行之后，发现登陆就成功了。")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@docker ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$docker")]),s._v(" login "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-u")]),s._v(" admin "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" admin123 idocker.ioLogin Succeeded\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"_3-打标签。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-打标签。"}},[s._v("#")]),s._v(" 3，打标签。")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@docker ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$docker")]),s._v(" tag docker.io/nginx idocker.io/nginx\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@docker ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$docker")]),s._v(" images\nREPOSITORY          TAG                 IMAGE ID            CREATED             SIZE\ndocker.io/nginx     latest              dbfc48660aeb        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("49")]),s._v(" minutes ago      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("109")]),s._v(" MB\nidocker.io/nginx    latest              dbfc48660aeb        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("49")]),s._v(" minutes ago      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("109")]),s._v(" MB\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("h3",{attrs:{id:"_4-push-镜像。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-push-镜像。"}},[s._v("#")]),s._v(" 4，push 镜像。")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@docker ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$docker")]),s._v(" push idocker.io/nginx\nThe push refers to a repository "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("idocker.io/nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n86df2a1b653b: Pushed\nbc5b41ec0cfa: Pushed\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("237472299760")]),s._v(": Pushed\nlatest: digest: sha256:d98b66402922eccdbee49ef093edb2d2c5001637bd291ae0a8cd21bb4c36bebe size: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("948")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("这里上传成功了，再去 nexus3 里边看看是有上去了。")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://t.eryajf.net/imgs/2021/09/9fe8c014103e0e4e.jpg",alt:"image"}})]),s._v(" "),a("h3",{attrs:{id:"_5-测试从私服拉镜像。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-测试从私服拉镜像。"}},[s._v("#")]),s._v(" 5，测试从私服拉镜像。")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@docker ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$docker")]),s._v(" images\nREPOSITORY          TAG                 IMAGE ID            CREATED             SIZE\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@docker ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$docker")]),s._v(" pull idocker.io/nginx\nUsing default tag: latest\nTrying to pull repository idocker.io/nginx "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nlatest: Pulling from idocker.io/nginx\nf17d81b4b692: Pull complete\nd5c237920c39: Pull complete\na381f92f36de: Pull complete\nDigest: sha256:d98b66402922eccdbee49ef093edb2d2c5001637bd291ae0a8cd21bb4c36bebe\nStatus: Downloaded newer image "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" idocker.io/nginx:latest\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@docker ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$docker")]),s._v(" images\nREPOSITORY          TAG                 IMAGE ID            CREATED             SIZE\nidocker.io/nginx    latest              dbfc48660aeb        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("59")]),s._v(" minutes ago      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("109")]),s._v(" MB\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("h2",{attrs:{id:"_7-代理的功能展示。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-代理的功能展示。"}},[s._v("#")]),s._v(" 7，代理的功能展示。")]),s._v(" "),a("p",[s._v("当某一个镜像在我们本地仓库没有的时候，就需要从远程仓库拉取了，其他的私有仓库的操作大概都是要从远程拉取，然后在重复如上操作推到本地私有仓库，而 nexus 因为有了 proxy 功能，因此，当我们在 pull 远程镜像的时候，本地就会自动同步下来了，这，就是其核心竞争力，也是与其他几款产品本质上的区别。")]),s._v(" "),a("p",[s._v("下边，我以拉取 gitlab 镜像为例：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@docker ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$docker")]),s._v(" pull idocker.io/gitlab/gitlab-ce\nUsing default tag: latest\nTrying to pull repository docker.io/gitlab/gitlab-ce "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nlatest: Pulling from docker.io/gitlab/gitlab-ce\n3b37166ec614: Pull complete\n504facff238f: Pull complete\nebbcacd28e10: Pull complete\nc7fb3351ecad: Pull complete\n2e3debadcbf7: Pull complete\n8e5e9b12009c: Pull complete\n0720fffe6e22: Pull complete\n2f336a213238: Pull complete\n1656ee3e1127: Pull complete\n25fa5248fd38: Pull complete\n36b8c1d869a0: Pull complete\nDigest: sha256:0dd22880358959d9a9233163147adc4c8f1f5d5af90097ff8dfa383c6be7e25a\nStatus: Downloaded newer image "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" docker.io/gitlab/gitlab-ce:latest\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])]),a("p",[s._v("因为本地没有这个镜像，所以从远程仓库拉取，然后去仓库里看看啥情况：")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://t.eryajf.net/imgs/2021/09/982dec78645c3122.jpg",alt:"image"}})]),s._v(" "),a("p",[s._v("这里可以看到，在我们创建的 proxy 分组中有一个 library 目录，已经自动缓存下来了这个镜像。")]),s._v(" "),a("p",[s._v("接着去我们用的 group 里边看看。")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://t.eryajf.net/imgs/2021/09/681d0fc81bbc94a2.jpg",alt:"image"}})]),s._v(" "),a("p",[s._v("我们看到 group 里边也已经有了 gitlab 这个镜像，如果以后再有人拉取 gitlab 这个镜像，直接就可以从本地私服进行拉取了，而不用再到公网去下了，事实上，使用 nexus3 作为 maven 的私服其实也是这样一个原理，从而实现节约带宽，节约时间，等等优势。")]),s._v(" "),a("p",[s._v("至此，基本上关于使用 nexus3 搭建 docker 私有仓库的知识点，基本上已经知无不言，言无不尽的分享完毕了。")]),s._v(" "),a("h2",{attrs:{id:"_8-参考地址。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-参考地址。"}},[s._v("#")]),s._v(" 8，参考地址。")]),s._v(" "),a("p",[s._v("感恩前行者的付出，让我们能够走得如此顺畅，感谢自己认真钻研，从而能够把好东西用更好的方式分享出去！")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("https://zhangge.net/5139.html")])]),s._v(" "),a("li",[a("p",[s._v("https://segmentfault.com/a/1190000015629878#articleHeader5")])])])])}),[],!1,null,null,null);a.default=n.exports}}]);