(window.webpackJsonp=window.webpackJsonp||[]).push([[381],{744:function(s,a,t){"use strict";t.r(a);var e=t(0),n=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[s._v("苦心人天不负，有志者事竟成。")]),s._v(" "),a("p",[s._v("这是第二次对这个东东发起配置冲击，对于 Python 项目，真心地是这辈子都不想再沾手，尽管它搞出了不少优秀的项目来。第一次冲击的时候，在多个主机多个环境反反复复尝试了十多次，最终均以失败告终，要么是应用需要的 Python 版本已经变更，而没有说明，要么是 Python 环境错乱，无法使用，总之，一言难尽。")]),s._v(" "),a("p",[s._v("但也不能算全无益处，至少积累了一些坑点，能够提前避开，比如一些模块的版本问题，以及软件大概从 2.0 之后，就已经完全依赖 Python3.6 了，凡此种种，都是需要后期注意的，今天看到一篇不错的文章，掐指一算，日子不错，于是开始配置之路。")]),s._v(" "),a("p",[s._v("破釜沉舟，这次新开机器，不搞定这个，誓不罢休。")]),s._v(" "),a("h2",{attrs:{id:"_1-安装-elastalert-0-1-37。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-安装-elastalert-0-1-37。"}},[s._v("#")]),s._v(" 1，安装 elastalert-0.1.37。")]),s._v(" "),a("h3",{attrs:{id:"_1-环境。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-环境。"}},[s._v("#")]),s._v(" 1，环境。")]),s._v(" "),a("ul",[a("li",[s._v("CentOS：7.4")]),s._v(" "),a("li",[s._v("Python：2.7.5(系统自带)")]),s._v(" "),a("li",[s._v("pip：19.3")]),s._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/Yelp/elastalert",target:"_blank",rel:"noopener noreferrer"}},[s._v("elastalert"),a("OutboundLink")],1),s._v("：0.1.37")]),s._v(" "),a("li",[s._v("elk：6.5.4")])]),s._v(" "),a("h3",{attrs:{id:"_2-依赖。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-依赖。"}},[s._v("#")]),s._v(" 2，依赖。")]),s._v(" "),a("p",[s._v("安装依赖包。")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("yum "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" gcc libffi-devel python-devel openssl-devel4 ca-certificates openssl-dev openssl python2-dev python2 py2-pip py2-yaml libffi-dev gcc musl-dev "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("安装 pip。")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("yum "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" epel-release\nyum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" python-pip "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("升级 pip。")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("pip "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--upgrade")]),s._v(" pip\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"_3-下载包。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-下载包。"}},[s._v("#")]),s._v(" 3，下载包。")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://github.com/Yelp/elastalert/archive/v0.1.37.zip\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"_4-开始配置。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-开始配置。"}},[s._v("#")]),s._v(" 4，开始配置。")]),s._v(" "),a("p",[s._v("入坑开始。")]),s._v(" "),a("p",[s._v("其实最原始的操作，就是两条命令即可，但是由于版本古老，可能会有许多依赖包版本不符合要求的情况，所以需要在安装过程中进行一波又一波解决。")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("unzip")]),s._v(" v0.1.37.zip\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" elastalert-0.1.37\npython setup.py "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("\npip "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-r")]),s._v(" requirements.txt\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("解决报错所需要操作的：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("pip2 "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"thehive4py>=1.4.4"')]),s._v("\npip2 "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"mock>=2.0.0"')]),s._v("\npip2 "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"jsonschema>=2.6.0,<3.0.0"')]),s._v("\npip "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--upgrade")]),s._v(" setuptools\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/jira>=1.0.10/jira>=1.0.10,<1.0.15/g'")]),s._v(" setup.py\npip "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"idna==2.7"')]),s._v("\npip "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" --ignore-installed six\npip "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" --ignore-installed cryptography\npip "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"elasticsearch<7,>6"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("到这里应该才把需要的依赖都解决完，然后再次：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("python setup.py "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("接着才能进行下一步：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("pip "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-r")]),s._v(" requirements.txt\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("报错继续，解决继续：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("pip "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" --ignore-installed requests\npip "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" PyYAML --ignore-installed  PyYAML\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("然后再次执行：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("pip "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-r")]),s._v(" requirements.txt\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("要确保过程没有报错，所有步骤，均以 "),a("code",[s._v("echo $?")]),s._v("的判断为依据，有时候可能看见红色的错误，仍旧可以忽略， 然后就安装配置完成了。")]),s._v(" "),a("h2",{attrs:{id:"_1-安装-elastalert-0-2-1。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-安装-elastalert-0-2-1。"}},[s._v("#")]),s._v(" 1，安装 elastalert-0.2.1。")]),s._v(" "),a("p",[s._v("当我真正熟悉了这些步骤之后，发现最新版本的安装也并不复杂了，现在想想之所以之前没有成功，就是因为太多网上的文章都是七七八八说了一堆，跟着他做的时候就失败接着失败，下边就再记录一下最新版本安装的过程。")]),s._v(" "),a("h3",{attrs:{id:"_1-环境。-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-环境。-2"}},[s._v("#")]),s._v(" 1，环境。")]),s._v(" "),a("ul",[a("li",[s._v("CentOS：7.4")]),s._v(" "),a("li",[s._v("Python：3.6.9")]),s._v(" "),a("li",[s._v("pip：19.3")]),s._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/Yelp/elastalert",target:"_blank",rel:"noopener noreferrer"}},[s._v("elastalert"),a("OutboundLink")],1),s._v("：0.2.1")]),s._v(" "),a("li",[s._v("elk：6.5.4")])]),s._v(" "),a("h3",{attrs:{id:"_2-配置-python3-6-9-环境。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-配置-python3-6-9-环境。"}},[s._v("#")]),s._v(" 2，配置 Python3.6.9 环境。")]),s._v(" "),a("p",[s._v("安装依赖包。")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("yum "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" openssl openssl-devel gcc gcc-c++\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("下载包。")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" https://www.python.org/ftp/python/3.6.9/Python-3.6.9.tgz\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("安装。")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" xf Python-3.6.9.tgz\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" Python-3.6.9\n./configure "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--prefix")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/python --with-openssl\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("配置。")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" /usr/bin/python /usr/bin/python_old\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" /usr/local/python/bin/python3 /usr/bin/python\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" /usr/local/python/bin/pip3 /usr/bin/pip\npip "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--upgrade")]),s._v(" pip\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'1s/python/python2.7/g'")]),s._v(" /usr/bin/yum\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'1s/python/python2.7/g'")]),s._v(" /usr/libexec/urlgrabber-ext-down\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("验证。")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ python "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-V")]),s._v("\nPython "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.6")]),s._v(".9\n$ pip "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-V")]),s._v("\npip "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19.3")]),s._v(" from /usr/local/python/lib/python3.6/site-packages/pip "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("python "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.6")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h3",{attrs:{id:"_3-安装-elastalert。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-安装-elastalert。"}},[s._v("#")]),s._v(" 3，安装 elastalert。")]),s._v(" "),a("p",[s._v("下载包。")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://github.com/Yelp/elastalert/archive/v0.2.1.tar.gz\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" xf v0.2.1.tar.gz\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" elastalert-0.2.1\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("安装。")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("pip "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"elasticsearch<7,>6"')]),s._v("\npip "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-r")]),s._v(" requirements.txt\npython setup.py "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("如果如上两步都没有报错，则说明安装成功，如果环境与我一致，网络通畅，那么基本上应该不会报错。")]),s._v(" "),a("p",[s._v("配置。")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("ll /usr/local/python/bin/elastalert*  可以看到生成的几个命令。\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" /usr/local/python/bin/elastalert* /usr/bin\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("然后就安装成功了，接下来的操作，两个版本里边就是一样的了。")]),s._v(" "),a("h2",{attrs:{id:"_3-使用。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-使用。"}},[s._v("#")]),s._v(" 3，使用。")]),s._v(" "),a("p",[s._v("官方文档："),a("a",{attrs:{href:"https://elastalert.readthedocs.io/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://elastalert.readthedocs.io"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("规则文档：https://elastalert.readthedocs.io/en/latest/ruletypes.html#include")]),s._v(" "),a("p",[s._v("以下的配置，就在 elastalert-0.1.37 版本下进行了。")]),s._v(" "),a("h3",{attrs:{id:"_1-主配置文件。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-主配置文件。"}},[s._v("#")]),s._v(" 1，主配置文件。")]),s._v(" "),a("p",[s._v("首先是主配置文件：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("egrep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"^$|^#"')]),s._v(" config.yaml\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 用来加载rule的目录，默认是example_rules")]),s._v("\nrules_folder: rules\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 用来设置定时向elasticsearch发送请求，也就是告警执行的频率")]),s._v("\nrun_every:\n  minutes: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 用来设置请求里时间字段的范围")]),s._v("\nbuffer_time:\n  minutes: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# elasticsearch的host地址")]),s._v("\nes_host: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.3")]),s._v(".0.41\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# elasticsearch的端口")]),s._v("\nes_port: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9200")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# elastalert产生的日志在elasticsearch中的创建的索引")]),s._v("\nwriteback_index: elastalert_status\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 失败重试的时间限制")]),s._v("\nalert_time_limit:\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#days: 2")]),s._v("\n  minutes: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br")])]),a("h3",{attrs:{id:"_2-创建告警所用索引。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-创建告警所用索引。"}},[s._v("#")]),s._v(" 2，创建告警所用索引。")]),s._v(" "),a("p",[s._v("可以在"),a("code",[s._v("/usr/bin/")]),s._v("目录下看到以下四个命令：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ elastalert-create-index\n/usr/lib/python2.7/site-packages/elastalert-0.1.37-py2.7.egg/elastalert/create_index.py:65: YAMLLoadWarning: calling yaml.load"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" without "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Loader")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(". is deprecated, as the default Loader is unsafe. Please "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v(" https://msg.pyyaml.org/load "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" full details.\n  data "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" yaml.load"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("config_file"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nElastic Version:6\nMapping used "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" string:"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'type'")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'keyword'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nNew index elastalert_status created\nDone"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("ul",[a("li",[a("code",[s._v("elastalert-create-index")]),s._v("会创建一个索引，"),a("code",[s._v("ElastAlert")]),s._v(" 会把执行记录存放到这个索引中，默认情况下，索引名叫 "),a("code",[s._v("elastalert_status")]),s._v("。其中有"),a("code",[s._v("4")]),s._v("个"),a("code",[s._v("_type")]),s._v("，都有自己的"),a("code",[s._v("@timestamp")]),s._v(" 字段，所以同样也可以用"),a("code",[s._v("kibana")]),s._v("来查看这个索引的日志记录情况。")]),s._v(" "),a("li",[a("code",[s._v("elastalert-rule-from-kibana")]),s._v("从"),a("code",[s._v("Kibana3")]),s._v("已保存的仪表盘中读取"),a("code",[s._v("Filtering")]),s._v(" 设置，帮助生成"),a("code",[s._v("config.yaml")]),s._v("里的配置。不过注意，它只会读取 "),a("code",[s._v("filtering")]),s._v("，不包括"),a("code",[s._v("queries")]),s._v("。")]),s._v(" "),a("li",[a("code",[s._v("elastalert-test-rule")]),s._v("测试自定义配置中的"),a("code",[s._v("rule")]),s._v("设置。")])]),s._v(" "),a("p",[s._v("执行"),a("code",[s._v("elastalert-create-index")]),s._v("命令在"),a("code",[s._v("ES")]),s._v("创建索引，这不是必须的步骤，但是强烈建议创建。因为对于审计和测试很有用，并且重启"),a("code",[s._v("ES")]),s._v("不影响计数和发送"),a("code",[s._v("alert")]),s._v(".")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ elastalert-create-index\n/usr/lib/python2.7/site-packages/elastalert-0.1.37-py2.7.egg/elastalert/create_index.py:65: YAMLLoadWarning: calling yaml.load"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" without "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Loader")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(". is deprecated, as the default Loader is unsafe. Please "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v(" https://msg.pyyaml.org/load "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" full details.\n  data "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" yaml.load"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("config_file"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nElastic Version:6\nMapping used "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" string:"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'type'")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'keyword'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nNew index elastalert_status created\nDone"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("看到这个输出，就说明创建成功了，也可以请求一下看看：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$curl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:9200/_cat/indices?v\nhealth status index                     uuid                   pri rep docs.count docs.deleted store.size pri.store.size\nyellow "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("open")]),s._v("   elastalert_status         Xo0DIGytQVGNSMU0jUVw7A   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("            "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".1kb          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".1kb\nyellow "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("open")]),s._v("   elastalert_status_silence iMUPdsQIQX2OwTmyWB01DQ   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("            "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".1kb          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".1kb\nyellow "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("open")]),s._v("   elastalert_status_status  ydUfZk1NRYy1OWPxIoFsOQ   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("            "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".1kb          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".1kb\nyellow "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("open")]),s._v("   elastalert_status_past    chY98B7-QfmTMPC9R5RfvQ   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("            "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".1kb          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".1kb\nyellow "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("open")]),s._v("   elastalert_status_error   zXu-UaTJSmyCemkl6hz5uQ   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("            "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".1kb          "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".1kb\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("h3",{attrs:{id:"_3-rule-配置。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-rule-配置。"}},[s._v("#")]),s._v(" 3，Rule 配置。")]),s._v(" "),a("p",[s._v("所有的告警规则，通过在 rule 目下创建配置文件进行定义，这里简单创建一个来作为演示。")]),s._v(" "),a("p",[s._v("首先我已经在 elk 集群中配置了一个 NGINX 日志采集的流水线，现在去 kibana 中利用检索规则，过滤出我想要的告警内容，比如我想让状态码是 404 的请求，触发告警通知，就用如下语句进行查询：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("groups: nginx AND response: 404\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("其中 group 是 kafka 里边定义的组，后边是状态码，还可以写更多条件进行匹配。")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://t.eryajf.net/imgs/2021/09/d63e8411b48d787f.jpg",alt:"20191018172445"}})]),s._v(" "),a("p",[s._v("然后来到服务器添加一条规则：")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[s._v("$ cat nginx.yaml\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("es_host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 10.3.0.41\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("es_port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9200")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("use_ssl")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("False")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Nginx.\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("use_strftine_index")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("index")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" logstash"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("nginx*\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" any\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("aggregation")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("seconds")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("run_every")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("minutes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("buffer_time")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("minutes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("filter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("query")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("query_string")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("query")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"groups: nginx AND response: 404"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("alert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"email"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("email")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"liql@eryajf.net"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("smtp_host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" smtp.163.com\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("smtp_port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("smtp_auth_file")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /data/elastalert"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("0.1.37/smtp_auth_file.yaml\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("from_addr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Linuxlql@163.com\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("email_reply_to")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Linuxlql@163.com\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br")])]),a("p",[s._v("注意里边在配置邮件通知的时候，还需要引用外部的一个文件，这个文件里用于存放对应邮箱的用户名密码。")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[s._v("$cat /data/elastalert"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("0.1.37/smtp_auth_file.yaml\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("user")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Linuxlql@163.com"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("password")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"xxxxxxx"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 注意这个地方是授权码，而非邮箱密码，如果是运维老司机，肯定能明白我说的意思")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h3",{attrs:{id:"_4-规则测试。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-规则测试。"}},[s._v("#")]),s._v(" 4，规则测试。")]),s._v(" "),a("p",[s._v("刚刚已经添加了一条规则，现在可以用自身的命令测试一下刚刚添加的规则。")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ elastalert-test-rule nginx.yaml\n/usr/lib/python2.7/site-packages/elastalert-0.1.37-py2.7.egg/elastalert/config.py:29: YAMLLoadWarning: calling yaml.load"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" without "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Loader")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(". is deprecated, as the default Loader is unsafe. Please "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v(" https://msg.pyyaml.org/load "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" full details.\n  rule_schema "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" jsonschema.Draft4Validator"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("yaml.load"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("open"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("os.path.join"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("os.path.dirname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("__file__"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'schema.yaml'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),s._v("\nSuccessfully loaded Nginx.\nINFO:elastalert:Note: In debug mode, alerts will be logged to console but NOT actually sent.\n                To send them but remain verbose, use "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--verbose")]),s._v(" instead.\nINFO:elastalert:Queried rule Nginx. from "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2019")]),s._v("-10-14 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":40 CST to "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2019")]),s._v("-10-14 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":50 CST: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" / "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" hits\nINFO:elastalert:Queried rule Nginx. from "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2019")]),s._v("-10-14 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":50 CST to "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2019")]),s._v("-10-14 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v(":00 CST: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" / "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" hits\nINFO:elastalert:Queried rule Nginx. from "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2019")]),s._v("-10-14 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v(":00 CST to "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2019")]),s._v("-10-14 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v(":10 CST: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" / "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" hits\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n中间输出省略\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\nINFO:elastalert:Queried rule Nginx. from "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2019")]),s._v("-10-15 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":30 CST to "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2019")]),s._v("-10-15 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":40 CST: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" / "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" hits\nWould have written the following documents to writeback index "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("default is elastalert_status"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(":\nelastalert_status - "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'hits'")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'matches'")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'@timestamp'")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" datetime.datetime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2019")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("40")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("36")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("145240")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("tzinfo")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("tzutc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'rule_name'")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Nginx.'")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'starttime'")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" datetime.datetime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2019")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("40")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("33")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("228045")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("tzinfo")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("tzutc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'endtime'")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" datetime.datetime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2019")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("40")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("33")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("228045")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("tzinfo")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("tzutc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'time_taken'")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.9058749675750732")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("p",[s._v("如果没有报错，则说明可用。")]),s._v(" "),a("h3",{attrs:{id:"_5-启动。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-启动。"}},[s._v("#")]),s._v(" 5，启动。")]),s._v(" "),a("p",[s._v("使用如下命令可以直接启动应用：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("python "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" elastalert.elastalert "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--verbose")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--config")]),s._v(" /data/elastalert-0.1.37/config.yaml\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("如果前边都没毛病，那么这里启动应该也不会报错，而是处于前台监听状态。")]),s._v(" "),a("h3",{attrs:{id:"_6-验证。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-验证。"}},[s._v("#")]),s._v(" 6，验证。")]),s._v(" "),a("p",[s._v("服务启动之后，日志能够很清晰看到整个过程，此时可以在刚刚的索引原点请求几个不存在的接口，造一些 404 状态，过一会儿应该可以看到日志中的说明，有告警发出，邮箱应该也能收到了。")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://t.eryajf.net/imgs/2021/09/d3eb338e3906e380.jpg",alt:"20191018172523"}})]),s._v(" "),a("h2",{attrs:{id:"_4-优化。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-优化。"}},[s._v("#")]),s._v(" 4，优化。")]),s._v(" "),a("h3",{attrs:{id:"_1-启动方式。"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-启动方式。"}},[s._v("#")]),s._v(" 1，启动方式。")]),s._v(" "),a("p",[s._v("上边的启动命令只是在前台启动，并不给力，现在将应用加入到 supervisord 管理，会更加方便。")]),s._v(" "),a("p",[s._v("supervisord 如何安装就不说了，可以"),a("a",{attrs:{href:"https://wiki.eryajf.net/pages/1903.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("参考这里。"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("创建配置文件：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$cat")]),s._v(" /etc/supervisord.d/elastalert1.ini\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("program:elastalert1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("directory")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/data/elastalert1/\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("command")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("python "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" elastalert.elastalert "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--verbose")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--config")]),s._v(" /data/elastalert1/config.yaml\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("process_name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("elastalert1\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("autorestart")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("startsecs")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("stopsignal")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("INT\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("stopasgroup")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("killasgroup")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("redirect_stderr")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("stdout_logfile")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/data/log/elastalert1.log\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("stdout_logfile_maxbytes")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("5MB\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("p",[s._v("然后启动即可。")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("supervisorctl update\nsupervisorctl start elastalert1\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h3",{attrs:{id:"_2-避免重复告警"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-避免重复告警"}},[s._v("#")]),s._v(" 2，避免重复告警")]),s._v(" "),a("p",[s._v("避免一定时间段中重复告警，可以配置"),a("code",[s._v("realert")]),s._v("和"),a("code",[s._v("exponential_realert")]),s._v("这两个选项：")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 5分钟内相同的报警不会重复发送")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("realert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("minutes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指数级扩大 realert 时间，中间如果有报警，")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 则按照5->10->20->40->60不断增大报警时间到制定的最大时间，")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果之后报警减少，则会慢慢恢复原始realert时间")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("exponential_realert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hours")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h3",{attrs:{id:"_3-聚合相同告警"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-聚合相同告警"}},[s._v("#")]),s._v(" 3，聚合相同告警")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 根据报警的内容将相同的报警按照 name 来聚合")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("aggregation_key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" name\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 聚合报警的内容，只展示 name 与 message")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("summary_table_fields")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" name\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" message\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("h3",{attrs:{id:"_4-告警内容格式化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-告警内容格式化"}},[s._v("#")]),s._v(" 4，告警内容格式化")]),s._v(" "),a("p",[s._v("可以自定义告警内容，内部是使用"),a("code",[s._v("Python")]),s._v("的"),a("code",[s._v("format")]),s._v("来实现的。")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("alert_subject")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Error {} @{}"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("alert_subject_args")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" name\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"@timestamp"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("alert_text_type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" alert_text_only\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("alert_text")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token scalar string"}},[s._v("\n  ### Error frequency exceeds\n  > Name: {}\n  > Message: {}\n  > Host: {} ({})")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("alert_text_args")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" name\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" message\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" hostname\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" host\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("p",[s._v("报错参考：")]),s._v(" "),a("ul",[a("li",[s._v("关于 setuptools 报错\n"),a("ul",[a("li",[a("a",{attrs:{href:"https://github.com/s3tools/s3cmd/issues/979",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://github.com/s3tools/s3cmd/issues/979"),a("OutboundLink")],1)])])]),s._v(" "),a("li",[s._v("关于 idna 报错\n"),a("ul",[a("li",[a("a",{attrs:{href:"https://github.com/Yelp/elastalert/issues/2019",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://github.com/Yelp/elastalert/issues/2019"),a("OutboundLink")],1)])])]),s._v(" "),a("li",[s._v("关于启动报错\n"),a("ul",[a("li",[a("a",{attrs:{href:"https://github.com/Yelp/elastalert/issues/2314",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://github.com/Yelp/elastalert/issues/2314"),a("OutboundLink")],1)])])]),s._v(" "),a("li",[s._v("关于 six 报错\n"),a("ul",[a("li",[a("a",{attrs:{href:"https://github.com/pypa/pip/issues/3165",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://github.com/pypa/pip/issues/3165"),a("OutboundLink")],1)])])]),s._v(" "),a("li",[s._v("关于 PyYAML 报错\n"),a("ul",[a("li",[a("a",{attrs:{href:"https://blog.csdn.net/jiangjiang_jian/article/details/80286220",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://blog.csdn.net/jiangjiang_jian/article/details/80286220"),a("OutboundLink")],1)])])])]),s._v(" "),a("p",[s._v("可能报错远不止如上所示的几个，但是这里记录下来，算是提供一个方法。")]),s._v(" "),a("p",[s._v("文章参考：")]),s._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://www.tony-yin.site/2018/11/15/ES-ElastAlert/#",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://www.tony-yin.site/2018/11/15/ES-ElastAlert/#"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://www.jianshu.com/p/7507da419230",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://www.jianshu.com/p/7507da419230"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://www.codetd.com/article/7308084",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://www.codetd.com/article/7308084"),a("OutboundLink")],1)])])])}),[],!1,null,null,null);a.default=n.exports}}]);