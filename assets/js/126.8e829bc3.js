(window.webpackJsonp=window.webpackJsonp||[]).push([[126],{470:function(s,t,a){"use strict";a.r(t);var n=a(0),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("p",[s._v("fileinfo 这个扩展是 php 自带的，但是使用 lnmp 一键安装脚本部署的时候并没有启用这个扩展，今天想要部署一个图床服务需要安装这个扩展。")]),s._v(" "),t("p",[s._v("在网上看了不少的文章，基本上都没有效果。这里记录下。")]),s._v(" "),t("p",[s._v("先来看一下是什么状态：")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@eryajf ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$php")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" fileinfo\nConfigure Command "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./configure'")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'--prefix=/usr/local/php'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'--with-config-file-path=/usr/local/php/etc'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'--with-config-file-scan-dir=/usr/local/php/conf.d'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'--enable-fpm'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'--with-fpm-user=www'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'--with-fpm-group=www'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'--enable-mysqlnd'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'--with-mysqli=mysqlnd'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'--with-pdo-mysql=mysqlnd'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'--with-iconv-dir'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'--with-freetype-dir=/usr/local/freetype'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'--with-jpeg-dir'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'--with-png-dir'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'--with-zlib'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'--with-libxml-dir=/usr'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'--enable-xml'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'--disable-rpath'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'--enable-bcmath'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'--enable-shmop'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'--enable-sysvsem'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'--enable-inline-optimization'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'--with-curl'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'--enable-mbregex'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'--enable-mbstring'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'--enable-intl'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'--with-mcrypt'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'--enable-ftp'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'--with-gd'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'--enable-gd-native-ttf'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'--with-openssl'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'--with-mhash'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'--enable-pcntl'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'--enable-sockets'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'--with-xmlrpc'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'--enable-zip'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'--enable-soap'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'--with-gettext'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'--disable-fileinfo'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'--enable-opcache'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'--with-xsl'")]),s._v("\nfileinfo\nfileinfo support "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" enabled\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("然后去到源码目录进行重新编译添加：")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@eryajf ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$cd")]),s._v(" /mnt/lnmp1.4-full/src/php-7.1.5/ext/fileinfo/\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("这时这个目录是无法直接编译的，需要执行以下命令生成编译文件：")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@eryajf fileinfo"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$phpize")]),s._v("\nConfiguring for:\nPHP Api Version:         "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20160303")]),s._v("\nZend Module Api No:      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20160303")]),s._v("\nZend Extension Api No:   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("320160303")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("然后进行编译即可：")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("./configure --with-php-config"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/php/bin/php-config --enable-fileinfo\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("如果执行无误，则会在最后输出一个目录。")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@eryajf min-wiki"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$ls")]),s._v(" /usr/local/php/lib/php/extensions/no-debug-non-zts-20160303\nfileinfo.so  opcache.a  opcache.so\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("可以看到这里已经生成了需要的 so 文件。")]),s._v(" "),t("div",{staticClass:"custom-block note"},[t("p",{staticClass:"custom-block-title"},[s._v("申明")]),s._v(" "),t("p",[t("strong",[s._v("原创文章"),t("Badge",{attrs:{text:"eryajf"}}),s._v("，未经授权，严禁转载，侵权必究！此乃文中随机水印，敬请读者谅解。")],1)]),s._v(" "),t("div",{staticClass:"custom-block right"},[t("p",[s._v("Copyright "),t("a",{attrs:{href:"https://wiki.eryajf.net",target:"_blank",rel:"noopener noreferrer"}},[s._v("二丫讲梵"),t("OutboundLink")],1),s._v(" 版权所有")])])]),s._v(" "),t("p",[s._v("接着配置"),t("code",[s._v("php.ini")]),s._v("进行引用：")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("extension "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/local/php/lib/php/extensions/no-debug-non-zts-20160303/fileinfo.so"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("将如上内容添加在文件当中。然后重启即可。")]),s._v(" "),t("p",[t("img",{attrs:{src:"http://t.eryajf.net/imgs/2021/09/758a1ffb0b4614d5.jpg",alt:"image"}})]),s._v(" "),t("p",[s._v("不过在重启的时候可能会遇到下边的报错：")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("NOTICE: PHP message: PHP Warning: PHP Startup: Invalid library "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("maybe not a PHP library"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" ‘fileinfo.so’ "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" Unknown on line "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("解决办法是回到上边添加一条命令：")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-rf")]),s._v(" /usr/local/php/lib/php/extensions/no-debug-non-zts-20160303/fileinfo.so\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" clean\n$ ./configure --with-php-config"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/php/bin/php-config --enable-fileinfo\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("然后再重启就能够看到添加成功了。")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@eryajf fileinfo"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$php")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" fileinfo\nfileinfo\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])])])}),[],!1,null,null,null);t.default=e.exports}}]);